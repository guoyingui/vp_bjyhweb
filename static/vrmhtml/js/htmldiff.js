!function(){var a=self,b=function(a,b,c){this.size=c,this.startInOld=a,this.startInNew=b,this.endInOld=this.startInOld+this.size,this.endInNew=this.startInNew+this.size},c=function(a,b,c,d,e){this.action=a,this.endInOld=c,this.endInNew=e,this.startInOld=b,this.startInNew=d},d=function(a){return a.match(/<[^>]+>|[^<|>|\w]|\w+\b|\s+/gm)},e=function(a,b){this.oldVersion=a,this.newVersion=b,this.operation=null,this.wordIndices={},this.oldWords=[],this.newWords=[],this.content=[]};e.prototype={build:function(){return new Date,this.splitInputs2Words(),this.indexNewWords(),this.operations=this.getOperations(),this.performOperation(),this.content.join("")},performOperation:function(){var a,b,c;for(b=0,c=this.operations.length;c>b;b++)a=this.operations[b],this.operation=a,a.action.call(this,a)},splitInputs2Words:function(){this.oldWords=d(this.oldVersion),this.newWords=d(this.newVersion)},indexNewWords:function(){var c,f,a=this.newWords,b=this.wordIndices,d=a.length,e=Object.prototype.toString;for(f=0;d>f;f++)c=a[f],"[object Array]"!==e.call(b[c])&&(b[c]=[]),b[c].push(f)},getOperations:function(){var f,g,h,i,k,l,a=0,d=0,e=[],j=this.matchingBlocks();for(j.push(new b(this.oldWords.length,this.newWords.length,0)),k=0,l=j.length;l>k;k++)g=null,f=j[k],h=a===f.startInOld,i=d===f.startInNew,h||i?h&&!i?g=this.insert:!h&&i&&(g=this.del):g=this.replace,g&&e.push(new c(g,a,f.startInOld,d,f.startInNew)),f.size&&e.push(new c(this.equal,f.startInOld,f.endInOld,f.startInNew,f.endInNew)),a=f.endInOld,d=f.endInNew;return e},matchingBlocks:function(){var a=[];return this.findMatchingBlocks(0,this.oldWords.length,0,this.newWords.length,a),a},findMatchingBlocks:function(a,b,c,d,e){var f=this.findMatch(a,b,c,d);f&&(a<f.startInOld&&c<f.startInNew&&this.findMatchingBlocks(a,f.startInOld,c,f.startInNew,e),e.push(f),f.endInOld<b&&f.endInNew<d&&this.findMatchingBlocks(f.endInOld,b,f.endInNew,d,e))},findMatch:function(a,c,d,e){var j,k,l,m,n,o,p,f=a,g=d,h=0,i={};for(o=a;c>o;o++){for(j={},l=this.wordIndices[this.oldWords[o]],n=l?l.length:0,p=0;n>p;p++)if(m=l[p],!(d>m)){if(m>=e)break;k=(i[m-1]||0)+1,j[m]=k,k>h&&(f=o-k+1,g=m-k+1,h=k)}i=j}return h?new b(f,g,h):null},insert:function(a,b){this.insertTag("ins",b||"diffins",this.newWords.slice(a.startInNew,a.endInNew))},del:function(a,b){this.insertTag("del",b||"diffdel",this.oldWords.slice(a.startInOld,a.endInOld))},equal:function(a){this.content=this.content.concat(this.newWords.slice(a.startInNew,a.endInNew))},replace:function(a){this.del(a,"diffmod"),this.insert(a,"diffmod")},insertTag:function(a,b,c){for(var d;c.length;)d=this.extractConsecutiveWords(c,!0),d.length&&this.content.push(this.warpText(d.join(""),a,b)),c.length&&(this.content=this.content.concat(this.extractConsecutiveWords(c,!1)))},extractConsecutiveWords:function(a,b){var d,e,c=null;for(d=0,e=a.length;e>d;d++)if(this.isTag(a[d])==b){c=d;break}return a.splice(0,null!==c?c:a.length)},warpText:function(a,b,c){return"<"+b+' class="'+c+'">'+a+"</"+b+">"},isOpeningTag:function(a){return/^\s*<[^>]+>\s*$/gi.test(a)},isClosingTag:function(a){return/^\s*<\/[^>]+>\s*$/gi.test(a)},isTag:function(a){return this.isOpeningTag(a)?1:this.isClosingTag(a)?2:0}},a.getHTMLDiff=function(a,b){return new e(a,b).build()},"function"==typeof postMessage&&(onmessage=function(a){var b=a.data,c=getHTMLDiff(b.oldVersion,b.newVersion);postMessage(c)})}();