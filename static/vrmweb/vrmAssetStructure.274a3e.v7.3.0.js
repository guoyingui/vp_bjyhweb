webpackJsonp([17],{1010:function(e,t,a){e.exports={"default":a(1011),__esModule:!0}},1011:function(e,t,a){a(75),a(63),e.exports=a(1012)},1012:function(e,t,a){var l=a(25),s=a(370);e.exports=a(20).getIterator=function(e){var t=s(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return l(t.call(e))}},1030:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(14),n=l(s),r=a(363),i=l(r),o=a(796),d=l(o),u=a(1010),c=l(u),p=a(687),f=l(p),m=a(54),v=l(m),h=a(55),y=l(h),g=a(59),E=l(g),L=a(93),T=l(L),x=a(8),A=l(x),b=a(4),V=a(652),S=a(784);a(1031);var k=function(e){function t(e){(0,v["default"])(this,t);var a=(0,E["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this,e));return a.initPanel=function(){a.getTree(function(e){a.firstLoadRightContent(e[0]),a.setState({treeData:e})})},a.reloadTreeAndPanel=function(){var e=a.structTree;a.getTree(function(t){a.firstLoadRightContent(t[0]),e.setNewData(t)})},a.getTree=function(e){(0,b.vpQuery)(a.getStructTreeUrl).then(function(t){t.data&&e&&e(t.data)})},a.getLevelTableData=function(){(0,b.vpQuery)(a.getAssetLvListUrl).then(function(e){a.setState({levelTableData:e.data})}),(0,b.vpQuery)(S.entitylistGroupDataUrl,{groupname:"需求资产类型"}).then(function(e){a.setState({assetTypeList:e.data})})},a.openRightBox=function(){a.getLevelTableData(),a.setState({rightBox_status:!0})},a.closeRightBox=function(){a.setState({rightBox_status:!1})},a.toAddLevel=function(){a.setState({addLevel_status:!0,add_status:!0})},a.closeAddLevel=function(){a.props.form.resetFields(),a.setState({addLevel_status:!1,assetLevel:""})},a.submitLevelForm=function(){a.props.form.validateFieldsAndScroll(function(e,t){e||(a.state.add_status?(0,b.vpAdd)(a.saveAssetLvUrl,t).then(function(e){"VP000000"==e.infocode&&(a.closeAddLevel(),a.getLevelTableData(),(0,b.VpAlertMsg)({message:"消息提示",description:"添加成功！",type:"success",closeText:"关闭",showIcon:!0},3))}):(t.reqAssetLevelId=a.state.assetLevel.reqAssetLevelId,(0,b.vpEdit)(a.editAssetLvUrl,t).then(function(e){"VP000000"==e.infocode&&(a.closeAddLevel(),a.getLevelTableData(),(0,b.VpAlertMsg)({message:"消息提示",description:"修改成功！",type:"success",closeText:"关闭",showIcon:!0},3))})))})},a.deleteLevel=function(e,t){(0,b.vpRemove)(a.deleteAssetLvUrl,{levelId:t.reqAssetLevelId}).then(function(e){"VP000000"==e.infocode&&(a.getLevelTableData(),(0,b.VpAlertMsg)({message:"消息提示",description:"删除成功！",type:"success",closeText:"关闭",showIcon:!0},3))})},a.toEditLevel=function(e,t){(0,b.vpQuery)(a.getAssetLvUrl,{levelId:t.reqAssetLevelId}).then(function(e){a.setState({assetLevel:e.data,add_status:!1,addLevel_status:!0})})},a.toAddTree=function(){(0,b.vpQuery)(a.getFirstLevelUrl,{levelIndex:1}).then(function(e){if(e.data){var t=e.data,l=!0,s=!1,n=undefined;try{for(var r,i=(0,c["default"])(t);!(l=(r=i.next()).done);l=!0){var o=r.value;o.reqAssetType=o.reqAssetType.toString()}}catch(d){s=!0,n=d}finally{try{!l&&i["return"]&&i["return"]()}finally{if(s)throw n}}a.setState({assetOptionsData:t,position:"",selectNode:"",isStructAdd:!0,rightContant:"",show_status:!0})}})},a.toAddNode=function(e){(0,b.vpQuery)(a.getOtherLevelUrl,{structId:a.state.selectNode.tid,position:e.position,levelIndex:a.state.selectNode.treeDepth}).then(function(t){t.data&&a.setState({assetOptionsData:t.data,position:e.position,isStructAdd:!0,rightContant:"",show_status:!0})})},a.changeAssetType=function(e,t){(0,b.vpQuery)(S.entityFormDataUrl,{entityid:e}).then(function(t){a.setState({rightContant:t.data.form,chooseEntityId:e})})},a.firstLoadRightContent=function(e){a.loadRightContent({entityid:e.attributes.reqAssetType,iid:e.attributes.iid},function(t){a.setState({rightContant:t,isStructAdd:!1,selectNode:e,show_status:!1})})},a.selectTreeNode=function(e,t){var l=(t.selected,t.selectedNodes,t.node);t.event;a.loadRightContent({entityid:l.props.item.attributes.reqAssetType,iid:l.props.item.attributes.iid},function(e){a.setState({rightContant:e,isStructAdd:!1,selectNode:l.props.item,show_status:!1})})},a.loadRightContent=function(e,t){(0,b.vpQuery)(S.entityFormDataUrl,e).then(function(e){t&&t(e.data.form)})},a.saveEntityData=function(e){a.state.isStructAdd?(0,b.vpAdd)(a.saveStructUrl,{position:a.state.position||"",assetStructId:a.state.selectNode.tid||"",entityid:a.state.chooseEntityId,sparam:(0,d["default"])(e)}).then(function(e){a.reloadTreeAndPanel(),(0,b.VpAlertMsg)({message:"消息提示",description:"添加成功！",type:"success",closeText:"关闭",showIcon:!0},3)}):(0,b.vpEdit)(a.updateStructUrl,{assetStructId:a.state.selectNode.tid,sparam:(0,d["default"])(e)}).then(function(e){a.reloadTreeAndPanel(),(0,b.VpAlertMsg)({message:"消息提示",description:"添加成功！",type:"success",closeText:"关闭",showIcon:!0},3)})},a.deleteStruct=function(){(0,b.vpRemove)(a.deleteStructUrl,{assetStructId:a.state.selectNode.tid}).then(function(e){a.reloadTreeAndPanel(),(0,b.VpAlertMsg)({message:"消息提示",description:"删除成功！",type:"success",closeText:"关闭",showIcon:!0},3)})},a.onDrop=function(e){(0,b.vpEdit)(a.moveNodeUrl,{position:e.dropPosition,dragNodeId:e.dragNode.props.item.tid,nodeId:e.node.props.item.tid}).then(function(e){a.reloadTreeAndPanel(),(0,b.VpAlertMsg)({message:"消息提示",description:"移动成功！",type:"success",closeText:"关闭",showIcon:!0},3)})},a.clickMenu=function(e){var t=(e.item,e.key);e.keyPath;"1"===t?a.structTree.expandedAll():"2"===t?a.structTree.closeAll():console.log("未知的参数值")},a.closeImportModal=function(){a.setState({import_status:!1})},a.importExcel=function(){a.inputStructUpload.upload.upload()},a.uploadSuccess=function(e,t){a.setState({import_status:!1},a.reloadTreeAndPanel())},a.downLoadTpl=function(){(0,b.vpDownLoad)(a.downloadTplUrl)},a.onRightClick=function(e){var t=(e.event,e.node);a.setState({selectNode:t.props.item})},a.handleClick=function(e){"1"===e.key?a.toAddNode({position:"1"}):"2"===e.key?a.toAddNode({position:"2"}):"3"===e.key?a.toAddNode({position:"3"}):"4"===e.key?a.deleteStruct():"5"===e.key?a.setState({import_status:!0}):"6"===e.key?(0,b.vpDownLoad)(a.exportNodeUrl,{structId:a.state.selectNode.tid}):console.log("参数值错误")},a.getRightItemList=function(e){var t=(e.event,e.node),a=t.props.item.treeDepth,l=[{key:"1",title:"添加节点（同级上）"},{key:"2",title:"添加节点（同级下）"},{key:"3",title:"添加子节点"},{key:"4",title:"删除节点"}];return 1==a&&(l=[].concat((0,i["default"])(l),[{key:"5",title:"导入节点"},{key:"6",title:"导出节点"}])),l},a.titleNode=function(e){return A["default"].createElement("div",null,A["default"].createElement(b.VpIcon,{className:"tree-icon",type:e.icon||"book text-primary"}),e.name,e.propertys.assetTypeName?A["default"].createElement("span",{style:{background:"#2db7f5",margin:"0px 2px",padding:" 0 3px",color:"#fff"}},e.propertys.assetTypeName):"",e.attributes.cntncount>0?A["default"].createElement("span",{style:{background:"#FF6461",margin:"0px 2px",padding:" 0 3px",color:"#fff"}},"有内容"):"")},a.state={treeData:[],selectId:[],rightBox_status:!1,assetTypeList:[],levelTableData:[],addLevel_status:!1,assetLevel:"",add_status:!0,assetOptionsData:[],rightContant:"",chooseEntityId:"",params:{},selectNode:"",position:"",isStructAdd:!0,show_status:!1,import_status:!1},a.getAssetLvListUrl="/{vpvrm}/vrm/assetLevel/list",a.saveAssetLvUrl="/{vpvrm}/vrm/assetLevel/save",a.deleteAssetLvUrl="/{vpvrm}/vrm/assetLevel/delete",a.editAssetLvUrl="/{vpvrm}/vrm/assetLevel/update",a.getAssetLvUrl="/{vpvrm}/vrm/assetLevel/getById",a.getFirstLevelUrl="/{vpvrm}/vrm/assetLevel/getLevels",a.saveStructUrl="/{vpvrm}/vrm/assetStruct/saveAndEntity",a.updateStructUrl="/{vpvrm}/vrm/assetStruct/updateAndEntity",a.getStructTreeUrl="/{vpvrm}/vrm/assetStruct/tree",a.deleteStructUrl="/{vpvrm}/vrm/assetStruct/delete",a.getOtherLevelUrl="/{vpvrm}/vrm/assetStruct/getLevels",a.uploadUrl="/{vpvrm}/vrm/assetStruct/import",a.downloadTplUrl="/{vpvrm}/vrm/assetStruct/downloadTpl",a.exportNodeUrl="/{vpvrm}/vrm/assetStruct/export",a.moveNodeUrl="/{vpvrm}/vrm/assetStruct/move",a}return(0,T["default"])(t,e),(0,y["default"])(t,[{key:"componentWillMount",value:function(){this.initPanel()}},{key:"stopEvent",value:function(e){var t=e;t&&t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&(t.cancelBubble=!0,t.returnValue=!1)}},{key:"render",value:function(){var e=this;console.log("渲染次数");var t=[{title:"层次",dataIndex:"reqAssetLevelIndex",key:"reqAssetLevelIndex",width:80,render:function(e,t,a){return A["default"].createElement("div",null,"第 ",e," 层")}},{title:"资产类型",dataIndex:"reqAssetType",key:"reqAssetType",width:100,render:function(t,a,l){var s="",n=!0,r=!1,i=undefined;try{for(var o,d=(0,c["default"])(e.state.assetTypeList);!(n=(o=d.next()).done);n=!0){var u=o.value;if(u.iid==t){s=u.sname;break}}}catch(p){r=!0,i=p}finally{try{!n&&d["return"]&&d["return"]()}finally{if(r)throw i}}return s}},{title:"下级可添加资产类型",dataIndex:"acceptAssetType",key:"acceptAssetType",width:300,render:function(t,a,l){if(!t)return"";var s=new Array,n=t.split(","),r=!0,i=!1,o=undefined;try{for(var d,u=(0,c["default"])(n);!(r=(d=u.next()).done);r=!0){var p=d.value,f=!0,m=!1,v=undefined;try{for(var h,y=(0,c["default"])(e.state.assetTypeList);!(f=(h=y.next()).done);f=!0){var g=h.value;if(g.iid==p){s.push(g.sname);break}}}catch(E){m=!0,v=E}finally{try{!f&&y["return"]&&y["return"]()}finally{if(m)throw v}}}}catch(E){i=!0,o=E}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw o}}return A["default"].createElement("div",null,s.join(","))}},{title:"创建人",dataIndex:"creUserName",key:"creUserName",width:80},{title:"创建时间",dataIndex:"creDttm",key:"creDttm",width:150,render:function(e,t,a){return A["default"].createElement("div",null,e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)+" "+e.substring(8,10)+":"+e.substring(10,12))}},{title:"操作",dataIndex:"_opt_",key:"_opt_",width:80,render:function(t,a,l){return A["default"].createElement("div",null,A["default"].createElement(b.VpTooltip,{placement:"top",title:"删除","data-id":a.iid},A["default"].createElement(b.VpPopconfirm,{title:"确定删除?",onConfirm:function(t){return e.deleteLevel(t,a)}},A["default"].createElement(b.VpIcon,{type:"vpicon-shanchu",onClick:function(t){return e.stopEvent(t)},className:"cursor m-lr-xs f16 text-danger"})))," ",A["default"].createElement(b.VpTooltip,{placement:"top",title:"编辑","data-id":a.iid},A["default"].createElement(b.VpIcon,{type:"vpicon-edit",onClick:function(t){return e.toEditLevel(t,a)},className:"cursor m-r-xs f16 text-primary"})))}}],a=this.props.form,l=a.getFieldProps,s=(a.getFieldValue,{labelCol:{span:6},wrapperCol:{span:14}}),r=A["default"].createElement(b.VpMenu,{onClick:this.clickMenu},A["default"].createElement(b.VpMenuItem,{key:"1"},"展开树"),A["default"].createElement(b.VpMenuItem,{key:"2"},"合并树"));return A["default"].createElement("div",{className:"full-height"},A["default"].createElement(b.VpRow,{gutter:10,className:"full-height"},A["default"].createElement(b.VpCol,{span:8,className:"full-height"},A["default"].createElement("div",{className:"bg-white p-sm full-height pr"},A["default"].createElement("div",{className:"struct-title"},A["default"].createElement("div",{style:{"float":"left"}},A["default"].createElement("h3",{className:"struct-title-h3"},"需求资产结构")),A["default"].createElement("div",{style:{"float":"right"}},A["default"].createElement(b.VpTooltip,{placement:"top",title:"新增资产结构树"},A["default"].createElement(b.VpButton,{onClick:this.toAddTree,type:"primary"},A["default"].createElement(b.VpIcon,{type:"plus"}))),"   ",A["default"].createElement(b.VpTooltip,{placement:"top",title:"维护资产结构层次信息"},A["default"].createElement(b.VpButton,{onClick:this.openRightBox,type:"primary"},A["default"].createElement(b.VpIcon,{type:"setting"}))),"   ",A["default"].createElement(b.VpDropdown,{trigger:["click"],overlay:r,type:"ghost"},A["default"].createElement(b.VpIcon,{type:"bars"})))),A["default"].createElement("div",{style:{height:"95%"}},A["default"].createElement(b.VpTree,{hasSearch:!0,ref:function(t){return e.structTree=t},titleNode:this.titleNode,treeData:this.state.treeData,onRightClick:this.onRightClick,rightItemList:this.getRightItemList,rightMenuClick:this.handleClick,onSelect:this.selectTreeNode,draggable:!0,onDrop:this.onDrop})))),A["default"].createElement(b.VpCol,{span:16,className:"full-height"},A["default"].createElement("div",{className:"bg-white p-sm full-height pr"},A["default"].createElement("div",{className:"struct-title"},A["default"].createElement("h3",{className:"struct-title-h3"},"需求资产结构属性")),A["default"].createElement("br",null),this.state.show_status?A["default"].createElement(b.VpRow,null,A["default"].createElement(b.VpCol,{span:16},A["default"].createElement(b.VpFSelect,{label:"需求资产类型",labelCol:{span:6},wrapperCol:{span:10}},A["default"].createElement(b.VpSelect,{getPopupContainer:function(){return document.body},placeholder:"请选择需求资产类型",style:{width:"100%"},onChange:this.changeAssetType},this.state.assetOptionsData.map(function(e,t){return A["default"].createElement(b.VpOption,{key:"req-asset-s"+e.reqAssetType,value:e.reqAssetType},e.levelNameDto," ")}))))):"",A["default"].createElement(b.VpRow,null,this.state.rightContant?A["default"].createElement(V.VpDynamicForm,{ref:function(t){return e.dynamic=t},bindThis:this,className:"p-sm full-height scroll p-b-xxlg",formData:this.state.rightContant,handleOk:this.saveEntityData,okText:"保 存",params:this.state.params}):"")))),A["default"].createElement(b.VpModal,{title:"导入模型结构",visible:this.state.import_status,onCancel:this.closeImportModal,height:"300px",width:"600px",maskClosable:!1,onOk:this.importExcel},this.state.import_status?A["default"].createElement("div",null,A["default"].createElement("div",null,A["default"].createElement(b.VpInputUploader,(0,n["default"])({ref:function(t){return e.inputStructUpload=t},onUploadAccept:this.uploadSuccess,form:this.props.form,item:{auto:!1,field_name:"xls",widget_type:"inputupload",validator:{required:!0},field_label:"选择excel文件",all_line:2,tips:"请选择文档(excel)",widget:{accept:{title:"Excel",extensions:"xls,xlsx",mimeTypes:".xls,.xlsx"},upload_url:this.uploadUrl?structId:this.state.selectNode.tid}},placeholder:"请输入描述内容"},s))),A["default"].createElement("div",{className:"ant-row ant-form-item"},A["default"].createElement("div",{className:"ant-col-6 ant-form-item-label"},A["default"].createElement("label",null,"文件模板")),A["default"].createElement("div",{className:"ant-col-14"},A["default"].createElement(b.VpTooltip,{placement:"top",title:"下载模板"},A["default"].createElement("a",{onClick:this.downLoadTpl},A["default"].createElement(b.VpIcon,{type:"vpicon-download",size:"large"}),A["default"].createElement("span",{style:{fontSize:"12px"}},"下载模板")))))):""),A["default"].createElement(V.RightBox,{show:this.state.rightBox_status,destroyOnClose:!0,mask:!0,onClose:this.closeRightBox},this.state.rightBox_status?A["default"].createElement(b.VpTabs,{defaultActiveKey:"0"},A["default"].createElement(b.VpTabPane,{tab:"维护需求资产结构层次关系",key:"0"},A["default"].createElement("div",{style:{width:"95%",marginLeft:"2%"}},A["default"].createElement(b.VpRow,null,A["default"].createElement(b.VpButton,{onClick:this.toAddLevel,type:"primary",className:"vp-btn-br-lg"},"新增层次")),A["default"].createElement("br",null),A["default"].createElement(b.VpRow,null,A["default"].createElement(b.VpTable,{ref:function(t){return e.assetLevelTable=t},pagination:!1,useFixedHeader:!0,bordered:!0,scroll:{x:500,y:600},dataSource:this.state.levelTableData,className:"assetLevelTable",columns:t}))),A["default"].createElement("div",null,A["default"].createElement(b.VpModal,{title:"新增层次信息",visible:this.state.addLevel_status,onCancel:this.closeAddLevel,height:"450px",width:"600px",maskClosable:!1,onOk:this.submitLevelForm},this.state.addLevel_status?A["default"].createElement(b.VpForm,{horizontal:!0},A["default"].createElement(b.VpFInputNumber,(0,n["default"])({label:"层次信息"},s,l("reqAssetLevelIndex",{initialValue:this.state.assetLevel?this.state.assetLevel.reqAssetLevelIndex:"",rules:[{required:!0,message:"请填写需求层次,且只能填1到100的整数"}]}),{min:1,max:100,style:{width:"100%"}})),A["default"].createElement(b.VpFSelect,(0,n["default"])({label:"需求资产类型",placeholder:"请选择需求资产类型"},s),A["default"].createElement(b.VpSelect,(0,n["default"])({getPopupContainer:function(){return document.body}},l("reqAssetType",{initialValue:this.state.assetLevel?this.state.assetLevel.reqAssetTypeVal:"",rules:[{required:!0,message:"请选择需求资产类型"}]})),this.state.assetTypeList.map(function(e,t){return A["default"].createElement(b.VpOption,{key:"req-asset-"+e.iid,value:e.iid},e.sname," ")}))),A["default"].createElement(b.VpFSelect,(0,n["default"])({label:"下一级可添加类型",placeholder:"请选择需求资产类型"},s),A["default"].createElement(b.VpSelect,(0,n["default"])({multiple:!0,getPopupContainer:function(){return document.body}},l("acceptAssetType",{initialValue:this.state.assetLevel?this.state.assetLevel.acceptAssetTypeList:[]})),this.state.assetTypeList.map(function(e,t){return A["default"].createElement(b.VpOption,{key:"accept-"+e.iid,value:e.iid},e.sname," ")})))):"")))):null))}}]),t}(A["default"].Component);t["default"]=k=(0,b.VpFormCreate)(k)},1031:function(e,t,a){var l=a(1032);"string"==typeof l&&(l=[[e.id,l,""]]);var s={hmr:!0};s.transform=void 0;a(439)(l,s);l.locals&&(e.exports=l.locals)},1032:function(e,t){}});