webpackJsonp([9],{992:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(796),s=n(l),i=a(687),r=n(i),o=a(54),c=n(o),d=a(55),u=n(d),h=a(59),f=n(h),p=a(93),m=n(p),v=a(8),y=n(v),g=a(4),b=a(652),k=a(784),S=a(813),E=a(786),w=a(993),C=n(w),V=a(999),x=n(V),_=a(1e3),N=n(_);a(1004);var D=function(e){function t(e){(0,c["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.renderHeight=function(e,t){var n=vp.computedHeight(t.length,".rsreqTable");a.setState({maxHeight:n,spinStatus:!1})},a.handleClick=function(e){a.state.filtervalue!=e.key&&a.setState({filtervalue:e.key,openKeys:e.keyPath.slice(1),currentkey:e.keyPath.slice(1)[0],spinStatus:!0,rightbox_type:"changeAudit"})},a.changeAudit=function(e,t){e.stopPropagation();a.state.entityid;a.setState({iid:t.iid,record:t,showWorkSpace:!0,rightbox_type:"changeAudit"})},a.onToggle=function(e){a.setState({openKeys:e.open?e.keyPath:e.keyPath.slice(1)})},a.shrinkLeft=function(e){a.setState({shrinkShow:!a.state.shrinkShow})},a.handleWhse=function(e,t){e.stopPropagation();a.state.entityid;a.setState({iid:t.iid,record:t,showWorkSpace:!0,rightbox_type:"audit"})},a.rowClick=function(e,t){a.setState({record:e}),a.setState({iid:e.iid,showWorkSpace:!0},function(){a.props.setBreadCrumb(e.sname)})},a.querySearchFormData=function(){(0,g.vpQuery)("/{vpplat}/vfrm/entity/searchForm",{entityid:a.state.entityid,scode:"search"}).then(function(e){a.setState({SearchFormData:e.data.form})})},a.handleSelectChange=function(e){a.setState({auditStatus:e}),a.handleSearchForm(a.state.searchData)},a.state={table_headers:[],spinStatus:!1,url:k.entityDataUrl,showWorkSpace:!1,operType:"",loading:!1,searchStr:"",increaseData:"",entityid:56,iid:"",filtervalue:"0",currentkey:"filter",openKeys:["filter"],filters:[],statusFilters:[],classFilters:[],shrinkShow:!0,SearchFormData:{},searchData:[],s_visible:!1,maxHeight:"auto",rightbox_type:"audit",auditStatus:"1"},a.handlesearch=a.handlesearch.bind(a),a.handleChange=a.handleChange.bind(a),a.saveRowData=a.saveRowData.bind(a),a.handleClick=a.handleClick.bind(a),a.getFilter=a.getFilter.bind(a),a.handleWhse=a.handleWhse.bind(a),a.shrinkLeft=a.shrinkLeft.bind(a),a.getHeader=a.getHeader.bind(a),a.handleMenuClick=a.handleMenuClick.bind(a),a.handleDownload=a.handleDownload.bind(a),a.handleVisibleChange=a.handleVisibleChange.bind(a),a.chooseModalVisible=a.chooseModalVisible.bind(a),a.cancelSearch=a.cancelSearch.bind(a),a.handleSearchForm=a.handleSearchForm.bind(a),a.closeWorkSpace=a.closeWorkSpace.bind(a),a.handleSelectChange=a.handleSelectChange.bind(a),a}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.getHeader(),this.getFilter(),this.querySearchFormData(),this.components={},this.components.SearchForm=(0,S.requireFile)("vfm/DynamicForm/SearchForm")}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){return""}}},{key:"getHeader",value:function(){var e=this;(0,g.vpQuery)(k.entityHeaderUrl,{entityid:this.state.entityid,viewtype:"list",scode:"auditList"}).then(function(t){var a=e.initHeaders(t.data.grid.fields);e.setState({table_headers:a})})}},{key:"getFilter",value:function(){var e=this;(0,g.vpQuery)(k.entityFilterConfigUrl,{entityid:e.state.entityid}).then(function(t){if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("search")){var a=t.data.search.filters,n=t.data.search.statusFilters,l=t.data.search.classFilters;e.setState({filters:a,statusFilters:n||[],classFilters:l||[]})}})}},{key:"initHeaders",value:function(e){var t=this,a=e.map(function(e,t){var a={title:e.field_label,dataIndex:e.field_name,key:e.field_name,sorter:!0,width:e.iwidth};return"istatusid"==e.field_name&&(a.render=function(e,t){return y["default"].createElement("div",{className:"indic-wrapper"},y["default"].createElement(g.VpIconFont,{type:"vpicon-circle-o text-primary",className:"m-r-xs"}),e)}),a}),n={title:"操作",key:"operation",fixed:"right",width:"100",render:function(e,a,n){return y["default"].createElement("div",null,1==a.iaudit_statusvpval?y["default"].createElement("span",null,y["default"].createElement(g.VpTooltip,{placement:"top",title:"入库审核"},y["default"].createElement(g.VpIconFont,{onClick:function(e){return t.handleWhse(e,a)},className:"text-primary m-lr-xs cursor",type:"vpicon-implement-tool"})),y["default"].createElement(g.VpTooltip,{placement:"top",title:"变更审核人"},y["default"].createElement(g.VpIconFont,{onClick:function(e){return t.changeAudit(e,a)},className:"text-primary m-lr-xs cursor",type:"vpicon-user"}))):"")}};return a.push(n),a}},{key:"saveRowData",value:function(){alert(1)}},{key:"stopEvent",value:function(e){var t=e;t&&t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&(t.cancelBubble=!0,t.returnValue=!1)}},{key:"handleMenuClick",value:function(e){(0,g.vpDownLoad)(k.entityExportfileUrl,{filtervalue:this.state.filtervalue,currentkey:this.state.currentkey,quickvalue:this.state.searchStr,ientityid:this.state.entityid,type:"expdata"})}},{key:"handleDownload",value:function(e){e.stopPropagation(),this.setState({showWorkSpace:!0,rightbox_type:"download"})}},{key:"getBoxContent",value:function(){return this.state.showWorkSpace?"audit"==this.state.rightbox_type?y["default"].createElement(C["default"],{entityid:this.state.entityid,iid:this.state.iid,onClose:this.closeWorkSpace,iframeShow:!1}):"changeAudit"==this.state.rightbox_type?y["default"].createElement(x["default"],{entityid:this.state.entityid,iid:this.state.iid,onClose:this.closeWorkSpace,iframeShow:!1}):"download"==this.state.rightbox_type?y["default"].createElement(N["default"],{entityid:this.state.entityid,iid:this.state.iid,onClose:this.closeWorkSpace,iframeShow:!1}):null:null}},{key:"handlesearch",value:function(){this.setState({searchData:[],searchStr:this.searchValue,s_visible:!1})}},{key:"handleChange",value:function(e){this.searchValue=e.target.value}},{key:"closeWorkSpace",value:function(e){var t=this;this.setState({showWorkSpace:!1,iid:""},function(){t.props.setBreadCrumb()})}},{key:"handleVisibleChange",value:function(){if(!this.chooseVisible){this.state.SearchFormData.groups.length>0?this.setState({s_visible:!this.state.s_visible}):E.RestAlertMsg.showWarning({msg:"暂无可搜索项，请配置搜索表单！"})}}},{key:"chooseModalVisible",value:function(e){this.chooseVisible=e}},{key:"cancelSearch",value:function(){this.setState({s_visible:!1})}},{key:"handleSearchForm",value:function(e){var t=this;null!=this.state.auditStatus&&e.concat([{field_name:"iaudit_status",field_value:this.state.auditStatus}]),this.setState({searchData:e,searchStr:this.searchValue,s_visible:!1},function(){t.VpTable.getTableData()})}},{key:"render",value:function(){var e=this,t=this.components.SearchForm,a=y["default"].createElement("div",{className:"search-form bg-white ant-dropdown-menu"},y["default"].createElement(t,{chooseModalVisible:this.chooseModalVisible,cancelSearch:this.cancelSearch,handleSearchForm:this.handleSearchForm,formData:this.state.SearchFormData}));return y["default"].createElement("div",{className:"business-container pr full-height entity-docart"},y["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},y["default"].createElement(g.VpRow,{gutter:10},y["default"].createElement(g.VpCol,{className:"gutter-row text-right",span:4},y["default"].createElement("div",{className:"m-b-sm search"},y["default"].createElement(b.VpSearchInput,{onPressEnter:this.handlesearch,searchButton:this.handlesearch,onChange:this.handleChange,placeholder:"请输入名称或编号搜索..."}))),y["default"].createElement(g.VpCol,{className:"gutter-row ",span:4},y["default"].createElement(g.VpSelect,{defaultValue:"1",placeholder:"请选择",style:{width:"100%"},onChange:this.handleSelectChange},y["default"].createElement(g.VpOption,{value:"1"},"待审核"),y["default"].createElement(g.VpOption,{value:"2"},"已入库"),y["default"].createElement(g.VpOption,{value:"3"},"审核不通过"))),y["default"].createElement(g.VpCol,{className:"gutter-row text-right",span:16},y["default"].createElement(g.VpTooltip,{placement:"top",title:"导出"},y["default"].createElement(g.VpButton,{type:"primary",shape:"circle",icon:"cloud-download",className:"m-l-xs",onClick:this.handleMenuClick})),y["default"].createElement(g.VpTooltip,{placement:"top",title:"导出需求资产"},y["default"].createElement(g.VpButton,{type:"primary",shape:"circle",icon:"cloud-download",className:"m-l-xs",onClick:this.handleDownload})),y["default"].createElement(g.VpDropdown,{onClick:this.handleVisibleChange,trigger:["click"],overlay:a,onVisibleChange:this.handleVisibleChange,visible:this.state.s_visible},y["default"].createElement("div",{style:{display:"inline-block"},id:"searchbox"},y["default"].createElement(b.FindCheckbox,null)))))),y["default"].createElement("div",{className:"business-wrapper p-t-sm full-height"},y["default"].createElement("div",{className:"bg-white p-sm full-height entity-rsreqlist"},y["default"].createElement(g.VpRow,{gutter:16,className:"full-height"},y["default"].createElement(g.VpCol,{className:"full-height scroll-y"},this.state.shrinkShow?"":y["default"].createElement("div",{className:"shrink p-tb-sm cursor text-center",onClick:this.shrinkLeft},y["default"].createElement(g.VpIconFont,{type:"vpicon-navopen"})),y["default"].createElement(g.VpTable,{ref:function(t){return e.VpTable=t},resize:!0,className:"docArtTable",columns:this.state.table_headers,loading:this.state.spinStatus,controlAddButton:this.renderHeight,scroll:{y:this.state.maxHeight},onRowClick:this.rowClick,dataUrl:"{vpvrm}/vrm/reqWhseAudit/listPage",params:{condition:(0,s["default"])(this.state.searchData.concat([{field_name:"idata_status",field_value:"1"}]).concat([{field_name:"iaudit_status",field_value:this.state.auditStatus}])),quickSearch:this.state.searchStr,viewtype:"list",viewcode:"auditList",entityid:this.state.entityid,filtervalue:this.state.filtervalue,currentkey:this.state.currentkey}}))))),this.getBoxContent(),this.state.showDownload)}}]),t}(y["default"].Component);t["default"]=D=(0,g.VpFormCreate)(D)},993:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(14),s=n(l),i=a(687),r=n(i),o=a(54),c=n(o),d=a(55),u=n(d),h=a(59),f=n(h),p=a(93),m=n(p),v=a(8),y=n(v),g=a(4),b=a(804),k=n(b),S=a(652),E=a(813),w=a(784);a(994);var C=a(786),V=a(996),x=n(V),_=function(e){function t(e){(0,c["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.handleSubmit=function(e){e.preventDefault();var t=a;t.props.form.validateFields(function(e,n,l){e||(0,g.vpAdd)("{vpvrm}/vrm/reqWhseAudit/saveArtWhseInfo",{reqAssetId:t.state.reqAssetId,reqAssetNodeId:t.state.reqAssetId,docArtId:t.state.iid,auditRemark:n.auditRemark,auditStatus:n.auditStatus},"",5e9).then(function(e){C.RestAlertMsg.showSuccess({msg:"保存成功！"}),a.closeRightModal()})})},a.getFormData=function(e,t){a.getDynamicTabs(t,e),(0,g.vpQuery)("{vpvrm}/vrm/assetStruct/getPath",{docArtId:e}).then(function(e){var t=e.data.map(function(e){return y["default"].createElement(g.VpOption,{value:e.reqAssetId+"_"+e.reqAssetStructId+"_"+e.path,key:e.reqAssetStructId},e.path)});a.setState({recommendData:t})})},a.handleModal=function(){a.setState({whseNode:!0})},a.cancelChoosen=function(){a.setState({whseNode:!1})},a.submitChoosen=function(e){var t=a;e.map(function(e,a){t.setState({reqAssetId:e.props.item.attributes.reqAssetId,reqAssetNode:e.props.item.tid}),t.props.form.setFieldsValue({reqAssetNode:e.props.item.name})}),a.cancelChoosen()},a.handleChange=function(e){console.log("selected "+e);var t=e.split("_");a.setState({reqAssetId:t[0],reqAssetNode:t[1]}),a.props.form.setFieldsValue({reqAssetNode:t[2]})},a.state={tabs_array:[],node_id:"",increaseData:[],showRightBox:!0,type:"undefined"==typeof a.props.type||a.props.type,iid:a.props.iid||a.props.params.iid,onClose:a.props.onClose||function(){},defaultActiveKey:"0",entityid:a.props.entityid||a.props.params.entityid||56,iframeShow:"undefined"==typeof a.props.iframeShow||a.props.iframeShow,reqAssetId:"110",reqAssetNode:"110",chooseReqAssetTree:!1,whseNode:!1,recommendData:[]},a.closeRightModal=a.closeRightModal.bind(a),a.getDynamicTabs=a.getDynamicTabs.bind(a),a.getFormData=a.getFormData.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleChange=a.handleChange.bind(a),a}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.getFormData(this.state.iid,!0)}},{key:"getDynamicTabs",value:function(e,t){var a=this;e?(0,g.vpAdd)(w.entityDynamicTabsUrl,{entityid:this.state.entityid,iid:t}).then(function(e){var t=e.data.tabs;a.setState({tabs_array:t})}):this.setState({tabs_array:[]})}},{key:"closeRightModal",value:function(){var e=this;this.state.iframeShow||this.setState({showRightBox:!1},function(){e.state.onClose()})}},{key:"render",value:function(){var e=this,t={};this.state.iframeShow?t.className="pr full-height vrmfixrightbox":t.className="full-height";var a=this.props.form,n=a.getFieldProps,l=(a.getFieldValue,{labelCol:{span:4},wrapperCol:{span:12}});return y["default"].createElement("div",t,y["default"].createElement(S.RightBox,{max:"true",button:this.state.iframeShow?y["default"].createElement("div",null):y["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},y["default"].createElement(g.VpTooltip,{placement:"top",title:k["default"].drawerSpinIcon[window.LOCALE]},y["default"].createElement(g.VpIcon,{type:"right"}))),show:this.state.showRightBox},y["default"].createElement("div",null,this.state.tabs_array.length?y["default"].createElement("div",null,y["default"].createElement("div",{className:"ibox-title p-b-sm  clearfix m-l-lg p-t-sm"},y["default"].createElement("h5",{className:"fl fw f14  m-l-sm"},"需求资产入库")),y["default"].createElement(g.VpForm,{horizontal:!0,onSubmit:this.handleSubmit},y["default"].createElement("div",null,y["default"].createElement(g.VpFSelect,(0,s["default"])({label:"推荐入库位置",placeholder:"推荐入库位置"},l),y["default"].createElement(g.VpSelect,{placeholder:"推荐入库位置",onChange:this.handleChange},this.state.recommendData)),y["default"].createElement(g.VpFInput,(0,s["default"])({label:"选择入库位置"},l,{id:"reqAssetNode",style:{width:"100%"},placeholder:"选择入库位置"},n("reqAssetNode",{rules:[{required:!0,message:"选择入库位置"}]}),{suffix:y["default"].createElement(g.VpIcon,{type:"search",style:{marginTop:7}}),onClick:function(){return e.handleModal(e.state.idepartmentid)}}))),y["default"].createElement("div",{className:"ibox-title p-b-sm  clearfix m-l-lg p-t-sm b-b"},y["default"].createElement("h5",{className:"fl fw f14  m-l-sm"},"审核信息")),y["default"].createElement("div",null,y["default"].createElement(g.VpRow,{className:"p-b-sm p-t-sm b-b"},y["default"].createElement(g.VpCol,{span:4,className:"text-right p-lr-sm"},y["default"].createElement(g.VpFRadio,null,y["default"].createElement(g.VpRadioGroup,n("auditStatus",{initialValue:4}),y["default"].createElement(g.VpRadio,{key:"a",value:4,checked:"true"},"通过"),y["default"].createElement(g.VpRadio,{key:"b",value:3},"未通过")))),y["default"].createElement(g.VpCol,{span:4,className:"text-right p-lr-sm"},"备注说明:"),y["default"].createElement(g.VpCol,{span:10},y["default"].createElement(g.VpInput,(0,s["default"])({type:"textarea"},n("auditRemark",{rules:[{required:!0,message:"选择入库位置"}]})))))),y["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},y["default"].createElement(g.VpButton,{className:"vp-btn-br",type:"primary",htmlType:"submit"},"提交"),y["default"].createElement(g.VpButton,{className:"vp-btn-br",style:{marginLeft:"10px"},type:"ghost",onClick:function(){return e.closeRightModal()}},"返回"))),y["default"].createElement("div",{className:"ibox-title p-b-sm  clearfix m-l-lg p-t-sm b-b"},y["default"].createElement("h5",{className:"fl fw f14  m-l-sm"},"需求条目信息")),y["default"].createElement("div",{className:"ibox-content doc-art-info"},y["default"].createElement(g.VpTabs,{destroyInactiveTabPane:!0},this.state.tabs_array.map(function(t,a){if(t.staburl){if("1"==t.ilinktype)return y["default"].createElement(g.VpTabPane,{tab:t.sname,key:t.skey},y["default"].createElement(g.VpIframe,{url:t.staburl+"?entityid="+e.state.entityid+"&iid="+e.state.record.iid}));var n=t.staburl.split("?"),l=n[0],s="";n.length>1&&(s=n[1]);var i=(0,E.requireFile)(l);return y["default"].createElement(g.VpTabPane,{tab:t.sname,key:t.skey},i?y["default"].createElement(i,{skey:t.skey,stabparam:s,isflow:!1,entityid:e.state.entityid,iid:e.state.iid,row_id:e.state.iid,row_entityid:e.state.entityid,form:e.props.form,iaccesslevel:t.iaccesslevel,entityrole:"1"==t.iaccesslevel,closeRightModal:e.closeRightModal}):"")}return y["default"].createElement(g.VpTabPane,{tab:t.sname,key:a+"tabs"})})))):null)),y["default"].createElement(g.VpModal,{title:"入库位置选择",visible:this.state.whseNode,width:"80%",footer:null,wrapClassName:"modal-no-footer",onCancel:function(){return e.cancelChoosen()}},y["default"].createElement(x["default"],{item:{irelationentityid:this.state.irelationentity,irelid:this.state.irelationid},initValue:this.state.initValue,params:{},onCancel:function(){return e.cancelChoosen()},onOk:function(t){return e.submitChoosen(t)}})))}}]),t}(y["default"].Component);t["default"]=_=(0,g.VpFormCreate)(_)},994:function(e,t,a){var n=a(995);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},995:function(e,t){},996:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(687),s=n(l),i=a(54),r=n(i),o=a(55),c=n(o),d=a(59),u=n(d),h=a(93),f=n(h),p=a(8),m=n(p),v=a(4);a(997);var y=function(e){function t(e){(0,r["default"])(this,t);var a=(0,u["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.selectNode=function(e,t){var n=(t.selected,t.selectedNodes,t.node);t.event;console.log("选择的节点"+n.props.item.name+"---tid="+n.props.item.tid),a.setState({selectItem:[n]})},a.getStructTree=function(){(0,v.vpQuery)("/{vpvrm}/vrm/assetStruct/tree").then(function(e){a.setState({treeData:e.data})})},a.handleClick=function(e){var t=e.key;1==t?a.structTree.expandedAll():2==t&&a.structTree.closeAll()},a.state={data:[],table_headers:[],selectItem:[],table_array:[],cur_page:1,page:1,pagination:{},limit:10,quickvalue:"",idepartmentid:"",item:a.props.item,params:a.props.params||{},treeData:[]},a.onOk=a.onOk.bind(a),a.onCancel=a.onCancel.bind(a),a}return(0,f["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){}},{key:"componentWillMount",value:function(){this.getStructTree()}},{key:"onOk",value:function(){this.props.onOk(this.state.selectItem),this.setState({selectItem:[]})}},{key:"onCancel",value:function(){this.props.onCancel(),this.setState({selectItem:this.props.initValue})}},{key:"render",value:function(){var e=this,t=this.state.selectedRowKeys,a="selectmodel"==this.props.item.widget_type?"radio":"checkbox";this.handleSelect,this.handleSelectAll,this.onSelectChange;return m["default"].createElement("div",{className:"bg-gray full-height vpselectentity"},m["default"].createElement("div",{className:"full-height"},m["default"].createElement(v.VpRow,{gutter:16,className:"full-height"},m["default"].createElement(v.VpCol,{span:"4",className:"full-height menuleft"},m["default"].createElement(v.VpMenu,{className:"full-height",onClick:this.handleClick,defaultOpenKeys:["setting"],mode:"inline"},m["default"].createElement(v.VpSubMenu,{key:"setting",title:m["default"].createElement("span",null,m["default"].createElement(v.VpIcon,{type:"setting"}),m["default"].createElement("span",null,"操作"))},m["default"].createElement(v.VpMenuItem,{key:"1"},"展开树"),m["default"].createElement(v.VpMenuItem,{key:"2"},"合并树")))),m["default"].createElement(v.VpCol,{span:"20",className:"full-height"},m["default"].createElement("div",{style:{height:"80%"}},m["default"].createElement(v.VpTree,{hasSearch:!0,ref:function(t){return e.structTree=t},titleNode:this.titleNode,treeData:this.state.treeData,onSelect:this.selectNode}))))),m["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{position:"absolute"}},m["default"].createElement(v.VpButton,{type:"primary",className:"vp-btn-br",onClick:this.onOk},"确定"),m["default"].createElement(v.VpButton,{type:"ghost",className:"vp-btn-br",onClick:this.onCancel},"取消")))}}]),t}(m["default"].Component);t["default"]=y},997:function(e,t,a){var n=a(998);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},998:function(e,t){},999:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(796),s=n(l),i=a(687),r=n(i),o=a(54),c=n(o),d=a(55),u=n(d),h=a(59),f=n(h),p=a(93),m=n(p),v=a(8),y=n(v),g=a(4),b=a(804),k=n(b),S=a(652),E=a(784);a(994);var w=a(786),C=function(e){function t(e){(0,c["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.handleSubmit=function(e){var t=a;t.props.form.validateFields(function(e,n,l){e||(0,g.vpAdd)("{vpvrm}/vrm/reqWhseAudit/changeAuditor",{docArtId:t.state.iid,sparam:(0,s["default"])(n)},"",5e9).then(function(e){w.RestAlertMsg.showSuccess({msg:"保存成功！"}),a.closeRightModal()})})},a.getFormData=function(e,t){var n=a;(0,g.vpQuery)(E.entityFormDataUrl,{entityid:n.state.entityid,iid:e,viewcode:"changeAudit"}).then(function(e){n.setState({increaseData:e.data.form})})},a.state={tabs_array:[],node_id:"",increaseData:[],showRightBox:!0,type:"undefined"==typeof a.props.type||a.props.type,iid:a.props.iid||a.props.params.iid,onClose:a.props.onClose||function(){},defaultActiveKey:"0",entityid:a.props.entityid||a.props.params.entityid||56,iframeShow:"undefined"==typeof a.props.iframeShow||a.props.iframeShow},a.closeRightModal=a.closeRightModal.bind(a),a.getFormData=a.getFormData.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.getFormData(this.state.iid,!0)}},{key:"closeRightModal",value:function(){var e=this;this.state.iframeShow||this.setState({showRightBox:!1},function(){e.state.onClose()})}},{key:"render",value:function(){var e={};this.state.iframeShow?e.className="pr full-height vrmfixrightbox":e.className="full-height";var t=this.props.form;t.getFieldProps,t.getFieldValue;return y["default"].createElement("div",e,y["default"].createElement(S.RightBox,{max:"true",button:this.state.iframeShow?y["default"].createElement("div",null):y["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},y["default"].createElement(g.VpTooltip,{placement:"top",title:k["default"].drawerSpinIcon[window.LOCALE]},y["default"].createElement(g.VpIcon,{type:"right"}))),show:this.state.showRightBox},y["default"].createElement(g.VpTabs,{defaultActiveKey:"0"},y["default"].createElement(g.VpTabPane,{tab:"变更审核人",key:0},y["default"].createElement(S.VpDynamicForm,{formData:this.state.increaseData,form:this.props.form,okText:"提交",handleOk:this.handleSubmit,loading:this.state.loading,bindThis:this})))))}}]),t}(y["default"].Component);t["default"]=C=(0,g.VpFormCreate)(C)},1e3:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(687),s=n(l),i=a(54),r=n(i),o=a(55),c=n(o),d=a(59),u=n(d),h=a(93),f=n(h),p=a(8),m=n(p),v=a(4),y=a(1001),g=n(y),b=a(652),k=a(786),S=a(804),E=n(S),w=function(e){function t(e){(0,r["default"])(this,t);var a=(0,u["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.cancelChoosen=function(){a.setState({showRightBox:!1})},a.getData=function(e){var t=a;t.setState({spinStatus:!0});t.props.docId;(0,v.vpQuery)("{vpvrm}/vrm/assetStruct/tree",{},"",5e6).then(function(e){var t=e.data;a.setState({treeData:t,spinStatus:!1})})["catch"](function(e){a.setState({spinStatus:!1})})},a.unCheckedAll=function(){a.treeRef.unCheckedAll(),a.checkedKeys=[]},a.handleClick=function(e){var t=e.key;1==t?a.treeRef.expandedAll():2==t?a.treeRef.closeAll():3==t?a.treeRef.checkedAll():4==t?a.unCheckedAll():console.log("no operate")},a.onCheck=function(e,t){var n=t.halfCheckedKeys.concat(e);a.checkedKeys=n},a.exportOutline=function(e){var t=a,n=a.refs.downloadModal,l=t.checkedKeys;if(l.length<=0&&a.treeRef.checkedKeys.length>0)l=a.treeRef.checkedKeys;else if(l.length<=0&&a.treeRef.checkedKeys.length<=0)return void k.RestAlertMsg.showWarning({msg:"请选择要需求资产！"});n.startDownload(l.join(","),function(e){(0,v.vpDownLoad)("{vpvrm}/odm/doc/download",{opertaskId:e},"",6e4)})},a.state={treeData:[],docId:null,spinStatus:!1,openKeys:["setting"],showRightBox:!0,onClose:a.props.onClose||function(){}},a.checkedKeys=[],a.closeRightModal=a.closeRightModal.bind(a),a}return(0,f["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.getData()}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({docId:e.docId},function(){t.getData()})}},{key:"closeRightModal",value:function(){var e=this;this.state.iframeShow||this.setState({showRightBox:!1},function(){e.state.onClose()})}},{key:"render",value:function(){var e=this;return m["default"].createElement("div",null,m["default"].createElement(b.RightBox,{max:"true",button:m["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},m["default"].createElement(v.VpTooltip,{placement:"top",title:E["default"].drawerSpinIcon[window.LOCALE]},m["default"].createElement(v.VpIcon,{type:"right"}))),show:this.state.showRightBox},m["default"].createElement(v.VpTabs,{defaultActiveKey:"0"},m["default"].createElement(v.VpTabPane,{tab:this.props.docname,key:"0"},m["default"].createElement(v.VpSpin,{spinning:this.state.spinStatus},m["default"].createElement("div",{className:"p-b-sm fw b-b"},m["default"].createElement("span",null,"需求资产下载")),m["default"].createElement("div",{className:"full-height"},m["default"].createElement(v.VpRow,{gutter:16,className:"full-height"},m["default"].createElement(v.VpCol,{span:"4",className:"full-height menuleft"},m["default"].createElement(v.VpMenu,{className:"full-height",onClick:this.handleClick,defaultOpenKeys:["setting"],mode:"inline"},m["default"].createElement(v.VpSubMenu,{key:"setting",title:m["default"].createElement("span",null,m["default"].createElement(v.VpIcon,{type:"setting"}),m["default"].createElement("span",null,"操作"))},m["default"].createElement(v.VpMenuItem,{key:"1"},"展开树"),m["default"].createElement(v.VpMenuItem,{key:"2"},"合并树"),m["default"].createElement(v.VpMenuItem,{key:"3"},"勾选全部"),m["default"].createElement(v.VpMenuItem,{key:"4"},"取消勾选")))),m["default"].createElement(v.VpCol,{span:"20",className:"full-height"},m["default"].createElement("div",{style:{height:"80%"}},m["default"].createElement(v.VpTree,{checkable:!0,hasSearch:!0,textCheck:!0,onCheck:this.onCheck.bind(this),ref:function(t){return e.treeRef=t},treeData:this.state.treeData}))))),m["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},m["default"].createElement(v.VpButton,{className:"vp-btn-br",type:"primary",onClick:this.exportOutline.bind(this)},"导出"),m["default"].createElement(v.VpButton,{className:"vp-btn-br",style:{marginLeft:"10px"},type:"ghost",onClick:function(){return e.closeRightModal()}},"返回"))),m["default"].createElement(g["default"],{ref:"downloadModal"})))))}}]),t}(m["default"].Component);t["default"]=w=(0,v.VpFormCreate)(w)},1001:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(687),s=n(l),i=a(54),r=n(i),o=a(55),c=n(o),d=a(59),u=n(d),h=a(93),f=n(h),p=a(8),m=n(p),v=a(4);a(1002);var y=a(831),g=n(y),b=a(833),k=n(b),S=a(834),E=n(S),w=function(e){function t(e){(0,r["default"])(this,t);var a=(0,u["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.state={percent:0,processStatusText:"文件正在生成...",complete:!1,socket:null,visible:!1},a.startDownload=a.startDownload.bind(a),a.isFunction=a.isFunction.bind(a),a}return(0,f["default"])(t,e),(0,c["default"])(t,[{key:"startDownload",value:function(e,t){var a=this,n=this.state.socket;n&&!n.connected?n.open():(n=k["default"].connect(vp.config.URL.odm_websocket+"/reqasset",{query:{token:vp.cookie.getToken()}}),n.open()),n.removeAllListeners(),n.on("connect",function(){(0,E["default"])(a.refs.processText).append("<li>数据载入中...</li>"),console.log("Open ParseDoc Window")}),n.on("disconnect",function(e){console.log("Close ParseDoc Window")}),n.on("connect_error",function(e){(0,E["default"])(a.refs.processText).append("<li>网络连接中断...</li>"),(0,v.VpAlertMsg)({message:"提示",description:"连接或认证websokect失败，请联系维护人员",type:"error",closeText:"关闭",showIcon:!0},3)}),n.on("download msg",function(e,t){(0,E["default"])(a.refs.processText).append("<li>"+t+"</li>"),(0,E["default"])(a.refs.processCurText).text("当前位置："+t)}),n.on("download percent",function(e,t){a.setState({percent:t})}),n.on("download start",function(e,t){var n=(0,E["default"])(a.refs.processText).append("<li>"+t+"</li>");n.scrollTop(n[0].scrollHeight)}),n.on("download end",function(e,l){var s=(0,E["default"])(a.refs.processText).append("<li>文件生成完成</li>");s.scrollTop(s[0].scrollHeight),setTimeout(function(){a.setState({visible:!1,complete:!0,processStatusText:"文件生成完成"},function(){n.close(),a.isFunction(t)&&t(l)})},1e3)}),n.on("download error",function(e,t){(0,E["default"])(a.refs.processText).append("<li>文件生成失败</li>");var e=/^VP(\d{1})/.exec(e)[1];a.setState({complete:!0,processStatusText:"文件生成失败"},function(){n.close(),2==e?(0,v.VpAlertMsg)({message:"提示",description:"文件生成失败:"+e+"-"+t,type:"warning",closeText:"关闭",showIcon:!0},3):(0,v.VpAlertMsg)({message:"提示",description:"文件生成失败:"+e+"-"+t,type:"error",closeText:"关闭",showIcon:!0},3)})}),(0,E["default"])(a.refs.processText).empty(),(0,E["default"])(a.refs.processCurText).text("当前位置："),a.setState({processStatusText:"文件正在生成...",complete:!1,socket:n,visible:!0,percent:0},function(){n.emit("reqassetdoc download",{reqAssetStructIds:e})})}},{key:"isFunction",value:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{key:"handleCancel",value:function(){if(this.state.complete){var e=this.state.socket;this.setState({visible:!1},function(){e.close()})}else(0,v.VpAlertMsg)({message:"提示",description:"正在下载中,不能关闭此窗口！",type:"warning",closeText:"关闭",showIcon:!0},3)}},{key:"render",value:function(){return m["default"].createElement(v.VpModal,{title:"下载提示",style:{height:500},maskClosable:!1,visible:this.state.visible,onCancel:this.handleCancel.bind(this),footer:null,wrapClassName:"modal-no-footer dynamic-modal"},m["default"].createElement("div",null,m["default"].createElement(g["default"],{percent:this.state.percent,style:{height:140,color:"#000"},format:function(e){return e+"%"}}),m["default"].createElement("p",{className:"text-center"},this.state.processStatusText),m["default"].createElement("p",{className:"text-cur-content",ref:"processCurText"},"当前位置：")),m["default"].createElement("div",{className:"text-content"},m["default"].createElement("ul",{ref:"processText"})))}}]),t}(m["default"].Component);t["default"]=w},1002:function(e,t,a){var n=a(1003);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},1003:function(e,t){},1004:function(e,t,a){var n=a(1005);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},1005:function(e,t){}});