webpackJsonp([8],{988:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(796),s=i(n),r=a(687),l=i(r),o=a(54),c=i(o),d=a(55),u=i(d),p=a(59),h=i(p),m=a(93),f=i(m),y=a(8),v=i(y),g=a(4),b=a(652),w=a(804),k=i(w),E=a(828),x=i(E),_=a(836),V=i(_),D=a(784),T=a(813);a(989);var S=a(786),R=a(991),A=function(e){function t(e){(0,c["default"])(this,t);var a=(0,h["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e));return a.renderHeight=function(e,t){var i=vp.computedHeight(t.length,".docTplTable");a.setState({maxHeight:i,res:t.length})},a.handleLike=function(e,t,i){a.stopEvent(e),(0,g.vpAdd)(D.entityHandLikeUrl,{ientityid:t,iid:i}).then(function(e){a.VpTable.getTableData()})},a.discuss=function(e,t){a.stopEvent(e);var i="entity"+a.state.entityid+"_discuss",n=e.target.getAttribute("data");a.record=t,a.setState({iid:t.iid,showRightBox:!0,operType:n,defaultActiveKey:i,rightBox_type:n}),a.getFormData(t.iid,!0)},a.closeParseWindow=function(){var e=a,t=e.operate,i=e.record;e.VpTable.getTableData(),1==t?((0,g.VpMsgLoading)("打开文件中...",1.5),setTimeout(function(){window.open("../vpword/index.html?busSceneCode=doctpl_edit&docId="+i.idoc_id)},1500)):2==t?((0,g.VpMsgLoading)("发布中...",1.5),setTimeout(function(){(0,g.vpEdit)("{vpvrm}/vrm/reqDocTpl/releaseReqDocTpl",{sparam:(0,s["default"])(i),entityid:e.state.entityid,iid:i.iid},"",5e9).then(function(t){e.VpTable.getTableData(),S.RestAlertMsg.showSuccess({msg:"发布成功！"})})},1500)):3==t?((0,g.VpMsgLoading)("打开文件中...",1.5),setTimeout(function(){window.open("../vpword/index.html?docId="+i.idoc_id)},1500)):4==t?((0,g.VpMsgLoading)("打开文件中...",1.5),setTimeout(function(){e.setState({showRightBox:!0,rightBox_type:"showDownload"})},1500)):console.log("operate is empty")},a.parseDoc=function(e,t){(0,a.refs.parseProgress.startParse)(t.idoc_id)},a.handleSubmit=function(e){a.props.form.validateFields(function(e,t){if(t.file_label&&!t.file)return void(0,g.VpAlertMsg)({message:"警告",description:"文件正在上传中...请稍后再次点击提交！",type:"warning",closeText:"关闭",showIcon:!0},3);e||(a.setState({loading:!0}),(0,g.vpAdd)("{vpvrm}/vrm/reqDocTpl/saveReqDocTpl",{sparam:(0,s["default"])(t),entityid:a.state.entityid},"",5e9).then(function(e){a.setState({showRightBox:!1,loading:!1}),a.VpTable.getTableData(),S.RestAlertMsg.showSuccess({msg:"保存成功！"})})["catch"](function(e){a.setState({loading:!1})}))})},a.getBoxContent=function(){return"add"==a.state.rightBox_type||"edit"==a.state.rightBox_type?a.editDom():"showDownload"==a.state.rightBox_type?a.listDownloadOutline():void console.log("rightBox_type is empty")},a.listDownloadOutline=function(){var e=a,t=e.record.sname+"-文档导出";return v["default"].createElement(V["default"],{docId:e.record.idoc_id,docname:t})},a.getFormData=function(e,t){a.getDynamicTabs(t,e),(0,g.vpQuery)(D.entityFormDataUrl,{entityid:a.state.entityid,iid:e}).then(function(e){a.setState({isAdd:!0,increaseData:e.data.form})})},a.onToggle=function(e){a.setState({openKeys:e.open?e.keyPath:e.keyPath.slice(1)})},a.shrinkLeft=function(e){a.setState({shrinkShow:!a.state.shrinkShow})},a.handleClick=function(e){a.setState({menuSelectKey:e.key,filtervalue:e.key,openKeys:e.keyPath.slice(1),currentkey:e.keyPath.slice(1)[0]})},a.rowClick=function(e,t){a.record=e;var i="entity"+a.state.entityid+"_attr";a.setState({showRightBox:!0,operType:"edit",rightBox_type:"edit",defaultActiveKey:i,readOrWrite:e&&1==e.istatusvpval?1:0},function(){a.props.setBreadCrumb(e.sname)}),a.getFormData(e.iid,!0)},a.state={table_headers:[],tabs_array:[],spinStatus:!1,rightBox_type:"",url:"{vpvrm}/vrm/reqDocTpl/listPage",item:"",operType:"",uploadUrl:D.uploadUrl,loading:!1,searchStr:"",increaseData:"",entityid:137,readOrWrite:0,filters:[],statusFilters:[],classFilters:[],shrinkShow:!0,openKeys:["filter"],currentkey:"filter",filtervalue:"0",menuSelectKey:"0",maxHeight:"auto",searchData:null,permisionVal:-1},a.handlesearch=a.handlesearch.bind(a),a.handleChange=a.handleChange.bind(a),a.editDocument=a.editDocument.bind(a),a.viewDocument=a.viewDocument.bind(a),a.handleDeletefunction=a.handleDeletefunction.bind(a),a.handleRelease=a.handleRelease.bind(a),a.handleUnRelease=a.handleUnRelease.bind(a),a.editTplDetail=a.editTplDetail.bind(a),a.handleDownload=a.handleDownload.bind(a),a.handleLike=a.handleLike.bind(a),a.discuss=a.discuss.bind(a),a.getPermisions=a.getPermisions.bind(a),a}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.getHeader(),this.getFilter(),this.getPermisions()}},{key:"componentDidMount",value:function(){this.operate="",this.record=""}},{key:"getEntityid",value:function(){return this.props.params.entityid?this.props.params.entityid:void RestAlterMsg.showError("实体ID丢失")}},{key:"getPermisions",value:function(){this.vrmAuthUtil||(this.vrmAuthUtil=new R.VrmAuthUtil(this.getEntityid())),this.vrmAuthUtil.getPermisions()}},{key:"getHeader",value:function(){var e=this;(0,g.vpQuery)(D.entityHeaderUrl,{entityid:this.state.entityid,viewcode:"list"}).then(function(t){var a=e.initHeaders(t.data.grid.fields);e.setState({table_headers:a})})}},{key:"getFilter",value:function(){var e=this;(0,g.vpQuery)(D.entityFilterConfigUrl,{entityid:e.state.entityid}).then(function(t){if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("search")){var a=t.data.search.filters;e.setState({filters:a})}})}},{key:"initHeaders",value:function(e){var t=this,a=this,i=e.map(function(e,t){var a="";return a="istatus"==e.field_name?{title:e.field_label,dataIndex:e.field_name,key:e.field_name,sorter:!0,width:e.iwidth,render:function(e,t,a){return t&&1==t.istatusvpval?v["default"].createElement(g.VpTag,{color:"blue",className:"vp-btn-br p-lr-lg"},"草稿"):v["default"].createElement(g.VpTag,{color:"green",className:"vp-btn-br p-lr-lg"},"已发布")}}:{title:e.field_label,dataIndex:e.field_name,key:e.field_name,sorter:!0,width:e.iwidth},"istatusid"==e.field_name&&(a.render=function(e,t){return v["default"].createElement("div",{className:"indic-wrapper"},v["default"].createElement("span",{key:0,className:indiclass[ischedule]}),v["default"].createElement(g.VpIconFont,{type:"vpicon-circle-o text-primary",className:"m-r-xs"}),e)}),a});i.push({title:"解析状态",dataIndex:"iextrac_status",key:"iextrac_status",width:"100",render:function(e,t,a){return t?0==t.iextrac_statusvpval?v["default"].createElement(g.VpTag,{color:"red",className:"vp-btn-br p-lr-lg"},"未解析"):1==t.iextrac_statusvpval?v["default"].createElement(g.VpTag,{color:"yellow",className:"vp-btn-br p-lr-lg"},"解析中"):2==t.iextrac_statusvpval?v["default"].createElement(g.VpTag,{color:"green",className:"vp-btn-br p-lr-lg"},"已解析"):"":""}});var n={title:"操作",key:"operation",fixed:"right",width:"120",render:function(e,i,n){return v["default"].createElement("div",null,v["default"].createElement(g.VpTooltip,{placement:"top",title:0==i.ilike?"关注":"取消关注"},v["default"].createElement(g.VpIconFont,{onClick:function(e){return t.handleLike(e,i.ientityid,i.iid)},className:"text-primary m-lr-xs cursor",type:1==i.ilike?"vpicon-star":"vpicon-star-o"})),a.vrmAuthUtil.isDiscussRead()?v["default"].createElement(g.VpTooltip,{placement:"top",title:"评论"},v["default"].createElement(g.VpIconFont,{onClick:function(e){return t.discuss(e,i)},data:"edit",className:"text-primary m-lr-xs cursor",type:"vpicon-pinglun"})):null,a.vrmAuthUtil.isAttWrite()?i&&1==i.istatusvpval?v["default"].createElement(g.VpTooltip,{placement:"top",title:"发布"},v["default"].createElement(g.VpIconFont,{onClick:function(e){return t.handleRelease(e,i)},className:"text-primary m-lr-xs cursor",type:"vpicon-check-circle-o"})):v["default"].createElement(g.VpTooltip,{placement:"top",title:"取消发布"},v["default"].createElement(g.VpIconFont,{onClick:function(e){return t.handleUnRelease(e,i)},className:"text-danger m-lr-xs cursor",type:"vpicon-close-circle"})):null,a.vrmAuthUtil.isAttRead()?v["default"].createElement(g.VpTooltip,{placement:"top",title:"更多"},v["default"].createElement("span",{className:"m-lr-xs cursor"},v["default"].createElement(g.VpDropdown,{overlay:v["default"].createElement(g.VpMenu,null,v["default"].createElement(g.VpMenuItem,{key:"0"},v["default"].createElement("div",{onClick:function(e){return t.viewDocument(e,i)}},v["default"].createElement(g.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:"vpicon-see-o"}),"查看文档")),a.vrmAuthUtil.isAttWrite()&&1==i.istatusvpval?v["default"].createElement(g.VpMenuItem,{key:"1"},v["default"].createElement("div",{onClick:function(e){return t.editDocument(e,i)}},v["default"].createElement(g.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:"vpicon-edit"}),"编辑文档")):null,v["default"].createElement(g.VpMenuItem,{key:"3"},v["default"].createElement("div",{onClick:function(e){return t.handleDownload(e,i)}},v["default"].createElement(g.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:"vpicon-download"}),"下载")),a.vrmAuthUtil.isAttWrite()&&1==i.istatusvpval?v["default"].createElement(g.VpMenuItem,{key:"2"},v["default"].createElement(g.VpPopconfirm,{title:"确定删除?",onConfirm:function(e){return t.handleDeletefunction(e,i)}},v["default"].createElement("div",null,v["default"].createElement(g.VpIconFont,{className:"cursor m-r-xs f16 text-danger",type:"vpicon-shanchu"}),"删除"))):null),trigger:["click"],getPopupContainer:function(e){return document.getElementById("table")}},v["default"].createElement(g.VpIcon,{"data-id":i.iid,className:"cursor",type:"ellipsis",onClick:function(e){return e.stopPropagation()}})))):null)}};return i.push(n),i}},{key:"handleDownload",value:function(e,t){this.operate=4,this.record=t,2==t.iextrac_statusvpval?this.setState({showRightBox:!0,rightBox_type:"showDownload"}):1==t.iextrac_statusvpval?S.RestAlertMsg.showWarning({msg:"文件正在解析,请稍等刷新页面重试！"}):0==t.iextrac_statusvpval?this.parseDoc(e,t):console.log("record.iextrac_statusvpval is error")}},{key:"handleRelease",value:function(e,t){var a=this;a.stopEvent(e),a.operate=2,a.record=t,2==t.iextrac_statusvpval?(0,g.vpEdit)("{vpvrm}/vrm/reqDocTpl/releaseReqDocTpl",{sparam:(0,s["default"])(t),entityid:a.state.entityid,iid:t.iid},"",5e9).then(function(e){a.VpTable.getTableData(),S.RestAlertMsg.showSuccess({msg:"发布成功！"})}):1==t.iextrac_statusvpval?S.RestAlertMsg.showWarning({msg:"文件正在解析,请稍等刷新页面重试！"}):0==t.iextrac_statusvpval?a.parseDoc(e,t):console.log("record.iextrac_statusvpval is error")}},{key:"editDocument",value:function(e,t){this.operate=1,this.record=t,2==t.iextrac_statusvpval?window.open("../vpword/index.html?busSceneCode=doctpl_edit&docId="+t.idoc_id):1==t.iextrac_statusvpval?S.RestAlertMsg.showWarning({msg:"文件正在解析,请稍等刷新页面重试！"}):0==t.iextrac_statusvpval?this.parseDoc(e,t):console.log("record.iextrac_statusvpval is error")}},{key:"viewDocument",value:function(e,t){this.operate=3,this.record=t,2==t.iextrac_statusvpval?window.open("../vpword/index.html?busSceneCode=doctpl_view&docId="+t.idoc_id):1==t.iextrac_statusvpval?S.RestAlertMsg.showWarning({msg:"文件正在解析,请稍等刷新页面重试！"}):0==t.iextrac_statusvpval?this.parseDoc(e,t):console.log("record.iextrac_statusvpval is error")}},{key:"handleUnRelease",value:function(e,t){this.stopEvent(e);var a=this;(0,g.vpEdit)("{vpvrm}/vrm/reqDocTpl/unReleaseReqDocTpl",{sparam:(0,s["default"])(t),entityid:a.state.entityid,iid:t.iid},"",5e9).then(function(e){a.VpTable.getTableData(),S.RestAlertMsg.showSuccess({msg:"撤消发布成功！"})})}},{key:"editTplDetail",value:function(e,t,a,i){this.stopEvent(e),this.record=t,this.setState({showRightBox:!0,operType:i,rightBox_type:i,defaultActiveKey:"0",readOrWrite:a}),"add"==i?this.getFormData("",!1):"edit"==i&&this.getFormData(t.iid,!0)}},{key:"handleDeletefunction",value:function(e,t){var a=this;a.setState({spinStatus:!0}),(0,g.vpRemove)("{vpvrm}/vrm/reqDocTpl/deleteReqDocTpl",{iid:t.iid,entityid:a.state.entityid,docId:t.idoc_id},"",5e9).then(function(e){a.setState({spinStatus:!1}),a.VpTable.getTableData(),S.RestAlertMsg.showSuccess({msg:"删除成功！"})})["catch"](function(e){_this.setState({spinStatus:!1})})}},{key:"stopEvent",value:function(e){var t=e;t&&t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&(t.cancelBubble=!0,t.returnValue=!1)}},{key:"editDom",value:function(){var e=this;if(this.state.showRightBox){var t=this.props.form,a=(t.getFieldProps,t.getFieldValue,v["default"].createElement(g.VpCol,{key:"0",span:12},v["default"].createElement(g.VpInputUploader,{form:this.props.form,item:{field_name:"file",widget_type:"inputupload",field_label:"选择文档模板",all_line:2,tips:"请选择文档（*.doc,*.docx)",widget:{accept:{title:"Doc",extensions:"docx,doc"},upload_url:this.state.uploadUrl}},placeholder:"请选择文档",className:"vrm-VpInputUploader"})));return v["default"].createElement(g.VpTabs,{defaultActiveKey:this.state.defaultActiveKey,onChange:this.tabsChange},this.state.tabs_array.length?this.state.tabs_array.map(function(t,a){if(t.staburl){if("1"==t.ilinktype)return v["default"].createElement(g.VpTabPane,{tab:t.sname,key:t.skey},v["default"].createElement(VpIframe,{url:t.staburl+"?entityid="+e.state.entityid+"&iid="+e.state.entityiid}));var i=t.staburl.split("?"),n=(i[0],"");i.length>1&&(n=i[1]);var s=(0,T.requireFile)(t.staburl);return v["default"].createElement(g.VpTabPane,{tab:t.sname,key:t.skey},v["default"].createElement(s,{skey:t.skey,stabparam:n,isflow:!1,formData:e.state.increaseData,entityid:e.state.entityid,iid:e.record.iid,entityrole:"1"==t.iaccesslevel&&"1"==e.state.readOrWrite,add:!1,row_id:e.record.iid,row_entityid:e.state.entityid,closeRightModal:function(){return e.closeRightModal()},refreshList:function(){return e.VpTable.getTableData()},docid:e.record.idoc_id,busObjType:1}))}return v["default"].createElement(g.VpTabPane,{tab:t.sname,key:a+"tabs"})}):v["default"].createElement(g.VpTabPane,{tab:"属性",key:0},v["default"].createElement(b.VpDynamicForm,{formData:this.state.increaseData,form:this.props.form,okText:"提交",handleOk:this.handleSubmit,loading:this.state.loading,extraComponent:[v["default"].createElement("div",{className:"accessory bg-white full-height"},v["default"].createElement(g.VpRow,{style:{padding:"0 16px"}},a))]})))}return""}},{key:"handlesearch",value:function(){this.setState({searchStr:this.searchValue})}},{key:"handleChange",value:function(e){this.searchValue=e.target.value}},{key:"addNewAttr",value:function(){this.state.rightBox_type="addDoc",this.setState({showRightBox:!0,increaseData:{}})}},{key:"closeRightModal",value:function(e){var t=this;this.setState({showRightBox:!1,rightBox_type:""},function(){t.props.setBreadCrumb()})}},{key:"getDynamicTabs",value:function(e,t){var a=this;e?(0,g.vpAdd)(D.entityDynamicTabsUrl,{entityid:this.state.entityid,iid:t}).then(function(e){var t=e.data.tabs;a.setState({tabs_array:t})}):this.setState({tabs_array:[]})}},{key:"render",value:function(){var e=this,t=this,a=this.props.form;a.getFieldProps,a.getFieldError,a.isFieldValidating,a.setFields;return v["default"].createElement("div",{className:"business-container pr full-height entity-reqdoc"},v["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},v["default"].createElement(g.VpRow,{className:"p-b-sm"},v["default"].createElement(g.VpCol,{span:4},v["default"].createElement("div",{className:"m-b-sm search"},v["default"].createElement(b.VpSearchInput,{onPressEnter:t.handlesearch,searchButton:t.handlesearch,onChange:t.handleChange,placeholder:"请输入名称或编号搜索..."}))),t.vrmAuthUtil.isAttWrite()?v["default"].createElement(g.VpCol,{span:20,className:"text-right"},v["default"].createElement(g.VpTooltip,{placement:"top",title:"快速创建"},v["default"].createElement(g.VpButton,{onClick:function(t){return e.editTplDetail(t,"",0,"add")},data:"add",type:"primary",className:"m-l-xs",shape:"circle"},v["default"].createElement(g.VpIcon,{data:"add",type:"plus"})))):null)),v["default"].createElement("div",{className:"content business-wrapper p-t-sm full-height"},v["default"].createElement("div",{className:"bg-white p-sm full-height entity-reqdoclist"},v["default"].createElement(g.VpRow,{gutter:16,className:"full-height"},v["default"].createElement(g.VpCol,{span:t.state.shrinkShow?"4":"0",className:"full-height pr menuleft"},v["default"].createElement(g.VpMenu,{className:"full-height scroll-y",onClick:t.handleClick,openKeys:t.state.openKeys,onOpen:t.onToggle,onClose:t.onToggle,mode:"inline",selectedKeys:[t.state.menuSelectKey]},v["default"].createElement(g.VpSubMenu,{key:"filter",title:v["default"].createElement("span",null,v["default"].createElement(g.VpIconFont,{type:"vpicon-filter",className:"m-r-xs"}),v["default"].createElement("span",null,"过滤器"))},t.state.filters.map(function(e,t){return v["default"].createElement(g.VpMenuItem,{key:e.value},e.name)}))),t.state.shrinkShow?v["default"].createElement("div",{className:"navswitch cursor text-center",onClick:t.shrinkLeft},v["default"].createElement(g.VpIconFont,{type:"vpicon-navclose"})):null),v["default"].createElement(g.VpCol,{span:t.state.shrinkShow?"20":"24",className:"full-height scroll-y",id:"table"},t.state.shrinkShow?"":v["default"].createElement("div",{className:"shrink p-tb-sm cursor text-center",onClick:t.shrinkLeft},v["default"].createElement(g.VpIconFont,{type:"vpicon-navopen"})),v["default"].createElement(g.VpSpin,{spinning:this.state.spinStatus},v["default"].createElement(g.VpTable,{ref:function(t){return e.VpTable=t},columns:this.state.table_headers,resize:!0,dataUrl:this.state.url,className:"docTplTable",scroll:{y:this.state.maxHeight},controlAddButton:this.renderHeight,onRowClick:t.rowClick,params:{condition:(0,s["default"])(t.state.searchData),entityid:this.state.entityid,quickSearch:this.state.searchStr,viewtype:"list",viewcode:"list",filtervalue:t.state.filtervalue,currentkey:t.state.currentkey}})))))),v["default"].createElement(b.RightBox,{max:!0,button:v["default"].createElement("div",{className:"icon p-xs",onClick:t.closeRightModal.bind(t)},v["default"].createElement(g.VpTooltip,{placement:"top",title:k["default"].drawerSpinIcon[window.LOCALE]},v["default"].createElement(g.VpIcon,{type:"right"}))),show:this.state.showRightBox},this.getBoxContent()),v["default"].createElement(x["default"],{ref:"parseProgress",closeFn:function(){e.closeParseWindow()}}))}}]),t}(v["default"].Component);t["default"]=A=(0,g.VpFormCreate)(A)},989:function(e,t,a){var i=a(990);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(439)(i,n);i.locals&&(e.exports=i.locals)},990:function(e,t){},991:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e){this.entityid=e,this.attrKey="entity"+e+"_attr",this.discussKey="entity"+e+"_discuss",this.summaryKey="entity"+e+"_summary",this.permisions=undefined,"function"!=typeof this.userId&&(n.prototype.userId=function(){return vp.cookie.getTkInfo().userid}),"function"!=typeof this.getPermisions&&(n.prototype.getPermisions=function(e){var t=this,a={};a[this.attrKey]="",a[this.discussKey]="",a[this.summaryKey]="",(0,c.vpQuery)(d.apiPrePointsUrl,{sparam:(0,o["default"])(a)}).then(function(a){a&&"object"==(void 0===a?"undefined":(0,r["default"])(a))&&(t.permisions=a.data,"function"==typeof e&&e(a.data))})}),"function"!=typeof this.isAttWrite&&(n.prototype.isAttWrite=function(){return this.permisions&&(1==this.permisions[this.attrKey]||1==this.permisions[this.summaryKey])}),"function"!=typeof this.isAttRead&&(n.prototype.isAttRead=function(){var e=this.permisions&&(0==this.permisions[this.attrKey]||0==this.permisions[this.summaryKey]);return e|=this.isAttWrite()}),"function"!=typeof this.isDiscussWrite&&(n.prototype.isDiscussWrite=function(){return this.permisions&&(1==this.permisions[this.discussKey]||1==this.permisions[this.summaryKey])}),"function"!=typeof this.isDiscussRead&&(n.prototype.isDiscussRead=function(){return this.permisions&&(0==this.permisions[this.discussKey]||1==this.permisions[this.discussKey])})}Object.defineProperty(t,"__esModule",{value:!0}),t.VrmAuthUtil=undefined;var s=a(60),r=i(s),l=a(796),o=i(l),c=a(4),d=a(784);t.VrmAuthUtil=n}});