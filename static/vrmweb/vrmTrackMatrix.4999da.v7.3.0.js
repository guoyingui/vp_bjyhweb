webpackJsonp([20],{1036:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(687),i=r(n),l=a(54),o=r(l),s=a(55),c=r(s),u=a(59),d=r(u),f=a(93),h=r(f),m=a(8),p=r(m),g=a(4),y=a(832),v=r(y);a(1037);var E=a(652),T=a(784),k=function(e){function t(e){(0,o["default"])(this,t);var a=(0,d["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e));return a.reloadPanel=function(){(0,g.vpQuery)(a.getTreeUrl,{}).then(function(e){e.data&&e.data.length>0&&a.setState({treeData:e.data,selectNode:e.data[0]},function(){a.getRightData(function(e){a.initEChartsTree(e)})})})},a.getRightData=function(e){var t=a,r=t.state,n=r.trackType,i=r.selectNode;i&&(0,g.vpQuery)(t.getGraphUrl,{trackType:n,reqId:i.tid.replace("sys",""),entityId:i.propertys.ientityid}).then(function(t){e instanceof Function&&e(t.data)})},a.initEChartsTree=function(e){var t=a,r=v["default"].init(t.refs.echartsTreePanel);r.setOption(a.setEChartsOption(e),!0),r.on("contextmenu",function(e){t.getFormData({iid:e.data.attributes.iid,entityid:e.data.attributes.ientityid})}),t.echartsTree=r},a.setEChartsOption=function(e){return{tooltip:{trigger:"item",triggerOn:"mousemove",position:[8,8],formatter:function(e){return e.data.attributes.sname}},series:[{type:"tree",data:[e],top:"5%",left:"2%",bottom:"5%",right:"20%",layerPadding:10,nodePadding:20,symbolSize:7,initialTreeDepth:1,label:{normal:{position:"top",verticalAlign:"middle",align:"bottom",fontSize:12}},leaves:{label:{normal:{position:"right",verticalAlign:"middle",align:"bottom"}}},expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750}]}},a.onclikReqLevel=function(){a.setState({trackType:1},function(){a.getRightData(function(e){a.echartsTree.setOption(a.setEChartsOption(e),!0),a.echartsTree.resize()})})},a.onclikEntryLevel=function(){a.setState({trackType:2},function(){a.getRightData(function(e){a.echartsTree.setOption(a.setEChartsOption(e),!0),a.echartsTree.resize()})})},a.selectTreeNode=function(e,t){var r=(t.selected,t.selectedNodes,t.node);t.event;a.setState({selectNode:r.props.item},function(){a.getRightData(function(e){a.echartsTree.setOption(a.setEChartsOption(e),!0),a.echartsTree.resize()})})},a.closeRightBox=function(){a.setState({showRightBox:!1})},a.getFormData=function(e){a.dynamic&&a.dynamic.resetFields(),(0,g.vpQuery)(T.entityFormDataUrl,e).then(function(t){a.setState({formData:t.data.form,formParams:e,showRightBox:!0})})},a.clickMenu=function(e){var t=(e.item,e.key);e.keyPath;"1"===t?a.trackTree.expandedAll():"2"===t?a.trackTree.closeAll():console.log("未知的参数值")},a.state={treeData:[],selectNode:"",trackType:1,echartsData:[],showRightBox:!1,formData:"",formParams:""},a.getTreeUrl="{vpvrm}/vrm/matrix/tree",a.getGraphUrl="{vpvrm}/vrm/matrix/graph",a}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.refs.echartsTreePanel.oncontextmenu=function(){return!1},this.reloadPanel()}},{key:"render",value:function(){var e=this,t=p["default"].createElement(g.VpMenu,{onClick:this.clickMenu},p["default"].createElement(g.VpMenuItem,{key:"1"},"展开树"),p["default"].createElement(g.VpMenuItem,{key:"2"},"合并树"));return p["default"].createElement("div",{className:"full-height"},p["default"].createElement(g.VpRow,{gutter:10,className:"full-height"},p["default"].createElement(g.VpCol,{span:6,className:"full-height"},p["default"].createElement("div",{className:"bg-white p-sm full-height pr"},p["default"].createElement("div",{style:{width:"100%",height:"35px",borderBottom:"1px solid #e9e9e9"}},p["default"].createElement("div",{style:{"float":"left"}},p["default"].createElement("h3",null,"需求跟踪树")),p["default"].createElement("div",{style:{"float":"right"}},p["default"].createElement(g.VpButtonGroup,null,p["default"].createElement(g.VpButton,{type:1==this.state.trackType?"primary":"",onClick:this.onclikReqLevel},"需求级跟踪"),p["default"].createElement(g.VpButton,{type:2==this.state.trackType?"primary":"",onClick:this.onclikEntryLevel},"条目级跟踪")),"   ",p["default"].createElement(g.VpDropdown,{trigger:["click"],overlay:t,type:"ghost"},p["default"].createElement(g.VpIcon,{type:"bars"})))),p["default"].createElement("div",{style:{height:"85%"}},p["default"].createElement(g.VpTree,{hasSearch:!0,ref:function(t){return e.trackTree=t},treeData:this.state.treeData,onSelect:this.selectTreeNode})))),p["default"].createElement(g.VpCol,{span:18,className:"full-height"},p["default"].createElement("div",{className:"bg-white p-sm full-height pr"},p["default"].createElement("div",{style:{width:"100%",height:"35px",borderBottom:"1px solid #e9e9e9"}},p["default"].createElement("div",{style:{"float":"left"}},p["default"].createElement("h3",null,"需求跟踪图"))),p["default"].createElement("div",{ref:"echartsTreePanel",style:{width:"98%",height:"90%"}})))),p["default"].createElement(E.RightBox,{mask:!0,destroyOnClose:!0,onClose:this.closeRightBox,show:this.state.showRightBox},p["default"].createElement(g.VpTabs,{defaultActiveKey:"0"},p["default"].createElement(g.VpTabPane,{tab:"基本信息",key:"0"},p["default"].createElement(E.VpDynamicForm,{ref:function(t){return e.dynamic=t},bindThis:this,className:"p-sm full-height scroll p-b-xxlg",formData:this.state.formData,params:this.state.formParams})))))}}]),t}(p["default"].Component);t["default"]=k=(0,g.VpFormCreate)(k)},1037:function(e,t,a){var r=a(1038);"string"==typeof r&&(r=[[e.id,r,""]]);var n={hmr:!0};n.transform=void 0;a(439)(r,n);r.locals&&(e.exports=r.locals)},1038:function(e,t){}});