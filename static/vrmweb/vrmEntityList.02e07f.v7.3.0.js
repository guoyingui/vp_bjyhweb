webpackJsonp([18],{991:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t){this.entityid=t,this.attrKey="entity"+t+"_attr",this.discussKey="entity"+t+"_discuss",this.summaryKey="entity"+t+"_summary",this.permisions=undefined,"function"!=typeof this.userId&&(n.prototype.userId=function(){return vp.cookie.getTkInfo().userid}),"function"!=typeof this.getPermisions&&(n.prototype.getPermisions=function(t){var e=this,i={};i[this.attrKey]="",i[this.discussKey]="",i[this.summaryKey]="",(0,d.vpQuery)(u.apiPrePointsUrl,{sparam:(0,o["default"])(i)}).then(function(i){i&&"object"==(void 0===i?"undefined":(0,r["default"])(i))&&(e.permisions=i.data,"function"==typeof t&&t(i.data))})}),"function"!=typeof this.isAttWrite&&(n.prototype.isAttWrite=function(){return this.permisions&&(1==this.permisions[this.attrKey]||1==this.permisions[this.summaryKey])}),"function"!=typeof this.isAttRead&&(n.prototype.isAttRead=function(){var t=this.permisions&&(0==this.permisions[this.attrKey]||0==this.permisions[this.summaryKey]);return t|=this.isAttWrite()}),"function"!=typeof this.isDiscussWrite&&(n.prototype.isDiscussWrite=function(){return this.permisions&&(1==this.permisions[this.discussKey]||1==this.permisions[this.summaryKey])}),"function"!=typeof this.isDiscussRead&&(n.prototype.isDiscussRead=function(){return this.permisions&&(0==this.permisions[this.discussKey]||1==this.permisions[this.discussKey])})}Object.defineProperty(e,"__esModule",{value:!0}),e.VrmAuthUtil=undefined;var s=i(60),r=a(s),l=i(796),o=a(l),d=i(4),u=i(784);e.VrmAuthUtil=n},1033:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var n=i(796),s=a(n),r=i(687),l=a(r),o=i(54),d=a(o),u=i(55),c=a(u),h=i(59),p=a(h),f=i(93),m=a(f),y=i(8),g=a(y),v=i(4),b=i(652),k=i(804),S=a(k),w=i(784);i(1034);var E=i(813),D=i(786),V=i(991),_=function(t){function e(t){(0,d["default"])(this,e);var i=(0,p["default"])(this,(e.__proto__||(0,l["default"])(e)).call(this,t));return i.onToggle=function(t){i.setState({openKeys:t.open?t.keyPath:t.keyPath.slice(1)})},i.shrinkLeft=function(t){i.setState({shrinkShow:!i.state.shrinkShow})},i.handleLike=function(t,e,a){t.stopPropagation(),(0,v.vpAdd)(w.entityHandLikeUrl,{ientityid:e,iid:a}).then(function(t){D.RestAlertMsg.showSuccess({msg:"关注成功！"}),i.VpTable.getTableData()})},i.discuss=function(t,e){t.preventDefault,i.record=e;var a="entity"+i.state.entityid+"_discuss";t.target.getAttribute("data");i.setState({entityiid:e.iid,record:e,showRightBox:!0,defaultActiveKey:a}),i.getFormData(e.iid,!0)},i.renderHeight=function(t,e){var a=vp.computedHeight(e.length,".entity-list-table");e.length>0?i.setState({maxHeight:a,spinStatus:!1}):i.setState({spinStatus:!1})},i.getFormData=function(t,e){i.getDynamicTabs(e,t),(0,v.vpQuery)(w.entityFormDataUrl,{entityid:i.state.entityid,iid:t}).then(function(t){i.setState({isAdd:!0,increaseData:t.data.form})})},i.closeRightModal=function(t){i.setState({showRightBox:!1,rightBox_type:""},function(){i.props.setBreadCrumb()})},i.handleSubmit=function(t){i.props.form.validateFields(function(t,e){t||(i.setState({loading:!0}),e.scode==undefined&&(e.scode=""),(0,v.vpAdd)(w.entitySaveFormDataUrl,{sparam:(0,s["default"])(e),entityid:i.state.entityid,viewcode:"form"},"",5e9).then(function(t){i.setState({showRightBox:!1,loading:!1}),i.VpTable.getTableData(),D.RestAlertMsg.showSuccess({msg:"保存成功！"})})["catch"](function(t){i.setState({loading:!1})}))})},i.handleCancel=function(t){i.closeRightModal(t)},i.destoryDom=function(t){i.setState({startflowFlag:!1}),"startflow"!=t&&i.props.closeRightModal()},i.handleClick=function(t){i.state.filtervalue!=t.key&&i.setState({filtervalue:t.key,openKeys:t.keyPath.slice(1),currentkey:t.keyPath.slice(1)[0],spinStatus:!0})},i.rowClick=function(t,e){i.record=t,i.setState({showRightBox:!0,operType:"edit",entityiid:t.iid,rightBox_type:"edit",defaultActiveKey:"0"},function(){i.props.setBreadCrumb(t.sname)}),i.getFormData(t.iid,!0)},i.handleModal=function(t,e){t.preventDefault,i.record=e;var a=t.target.getAttribute("data"),n=t.target.getAttribute("data-type");n=n||"1",i.setState({showRightBox:!0,operType:a,rightBox_type:a,defaultActiveKey:"0",createType:n,doctplDocId:"",buttonListVisiBle:!1}),"add"==a?i.getFormData("",!1):(a="edit")&&i.getFormData(e.iid,!0)},i.state={table_headers:[],tabs_array:[],spinStatus:!1,rightBox_type:"",url:w.entityDataUrl,item:"",entityiid:"",operType:"",uploadUrl:w.uploadUrl,loading:!1,searchStr:"",increaseData:"",filters:[],statusFilters:[],classFilters:[],shrinkShow:!0,openKeys:["filter"],currentkey:"filter",filtervalue:"0",showRightBox:!1,defaultActiveKey:"0",searchData:[],createType:1,doctplListData:[],doctplCheckedData:0,doctplListDataHtml:"",doctplDocId:"",doctplFilecode:"",doctplFilename:"",maxHeight:"auto",buttonListVisiBle:!1,entityid:i.props.params.entityid},i.fparam={ivrm_req_phase:"",ivrm_req_app_prj_type:"",ivrm_req_app_app_type:""},i.handlesearch=i.handlesearch.bind(i),i.handleChange=i.handleChange.bind(i),i.rowClick=i.rowClick.bind(i),i.getDynamicTabs=i.getDynamicTabs.bind(i),i.handleDelete=i.handleDelete.bind(i),i.getFilter=i.getFilter.bind(i),i.handleLike=i.handleLike.bind(i),i.discuss=i.discuss.bind(i),i.getPermisions=i.getPermisions.bind(i),i}return(0,m["default"])(e,t),(0,c["default"])(e,[{key:"componentWillReceiveProps",value:function(t){var e=this;t.params?t.params.entityid!=this.props.params.entityid&&this.setState({entityid:t.params.entityid},function(){e.getHeader(),e.getFilter(),e.getPermisions()}):this.setState({entityid:t.entityid},function(){e.getHeader(),e.getFilter(),e.getPermisions()})}},{key:"componentWillMount",value:function(){this.getHeader(),this.getFilter(),this.getPermisions()}},{key:"componentDidMount",value:function(){this.operate="",this.record=""}},{key:"getPermisions",value:function(){this.vrmAuthUtil||(this.vrmAuthUtil=new V.VrmAuthUtil(this.state.entityid)),this.vrmAuthUtil.getPermisions()}},{key:"getHeader",value:function(){var t=this;(0,v.vpQuery)(w.entityHeaderUrl,{entityid:this.state.entityid,viewcode:"list"}).then(function(e){var i=t.initHeaders(e.data.grid.fields);t.setState({table_headers:i})})}},{key:"initHeaders",value:function(t){var e=this,i=this,a=t.map(function(t,e){return{title:t.field_label,dataIndex:t.field_name,key:t.field_name,sorter:!0,width:t.iwidth}}),n={title:"操作",key:"operation",fixed:"right",width:"100",render:function(t,a,n){return g["default"].createElement("div",null,g["default"].createElement(v.VpTooltip,{placement:"top",title:0==a.ilike?"关注":"取消关注"},g["default"].createElement(v.VpIconFont,{onClick:function(t){return i.handleLike(t,a.ientityid,a.iid)},className:"text-primary m-lr-xs cursor",type:1==a.ilike?"vpicon-star":"vpicon-star-o"})),i.vrmAuthUtil.isDiscussRead()?g["default"].createElement(v.VpTooltip,{placement:"top",title:"评论"},g["default"].createElement(v.VpIconFont,{onClick:function(t){return e.discuss(t,a)},data:"edit",className:"text-primary m-lr-xs cursor",type:"vpicon-pinglun"})):null,!i.vrmAuthUtil.isAttWrite()||i.vrmAuthUtil.userId()!=a.icreatorvpval&&i.vrmAuthUtil.userId()!=a.inamerolevpval?null:g["default"].createElement(v.VpTooltip,{placement:"top",title:"删除","data-id":a.iid},g["default"].createElement(v.VpPopconfirm,{title:"确定删除?",onConfirm:function(t){return e.handleDelete(t,a)}},g["default"].createElement(v.VpIcon,{type:"vpicon-shanchu",onClick:function(t){return e.stopEvent(t)},className:"cursor m-lr-xs f16 text-danger"}))))}};return a.push(n),a}},{key:"getFilter",value:function(){var t=this;(0,v.vpQuery)(w.entityFilterConfigUrl,{entityid:t.state.entityid}).then(function(e){if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("search")){var i=e.data.search.filters;t.setState({filters:i})}})}},{key:"handlesearch",value:function(){this.setState({searchStr:this.searchValue})}},{key:"handleChange",value:function(t){this.searchValue=t.target.value}},{key:"stopEvent",value:function(t){var e=t;e&&e.stopPropagation?(e.stopPropagation(),e.preventDefault()):window.event&&(e.cancelBubble=!0,e.returnValue=!1)}},{key:"handleDelete",value:function(t,e){var i=this;i.setState({spinStatus:!0}),(0,v.vpAdd)(w.entityDeleteDataUrl,{iid:e.iid,entityid:i.state.entityid},5e9).then(function(t){i.setState({spinStatus:!1}),i.VpTable.getTableData(),D.RestAlertMsg.showSuccess({msg:"删除成功！"})})["catch"](function(t){_this.setState({spinStatus:!1})})}},{key:"getDynamicTabs",value:function(t,e){var i=this;t?(0,v.vpAdd)(w.entityDynamicTabsUrl,{entityid:this.state.entityid,iid:e}).then(function(t){var e=t.data.tabs;i.setState({tabs_array:e})}):this.setState({tabs_array:[]})}},{key:"editDom",value:function(){var t=this;return this.state.showRightBox?g["default"].createElement(v.VpTabs,{defaultActiveKey:this.state.defaultActiveKey,destroyInactiveTabPane:!0},this.state.tabs_array.length?this.state.tabs_array.map(function(e,i){if(e.staburl){if("1"==e.ilinktype)return g["default"].createElement(v.VpTabPane,{tab:e.sname,key:e.skey},g["default"].createElement(v.VpIframe,{url:e.staburl+"?entityid="+t.state.entityid+"&iid="+t.state.entityiid}));var a=e.staburl.split("?"),n=a[0],s="";a.length>1&&(s=a[1]);var r=(0,E.requireFile)(n);return g["default"].createElement(v.VpTabPane,{tab:e.sname,key:e.skey},g["default"].createElement(r,{skey:e.skey,stabparam:s,isflow:!1,formData:t.state.increaseData,entityid:t.state.entityid,iid:t.record.iid,entityrole:"1"==e.iaccesslevel,add:!1,row_id:t.record.iid,row_entityid:t.state.entityid,closeRightModal:function(){return t.closeRightModal()},refreshList:function(){return t.VpTable.getTableData()}}))}return g["default"].createElement(v.VpTabPane,{tab:e.sname,key:i+"tabs"})}):g["default"].createElement(v.VpTabPane,{tab:"属性",key:0},g["default"].createElement(b.VpDynamicForm,{formData:this.state.increaseData,form:this.props.form,add:!0,okText:"提交",handleOk:this.handleSubmit,handleCancel:this.handleCancel,loading:this.state.loading}))):""}},{key:"render",value:function(){var t=this;return g["default"].createElement("div",{className:"business-container pr full-height"},g["default"].createElement("div",{className:"subAssembly b-b bg-white",style:t.props.style},g["default"].createElement(v.VpRow,{className:"p-b-sm"},g["default"].createElement(v.VpCol,{className:"gutter-row",span:4},g["default"].createElement("div",{className:"m-b-sm search"},g["default"].createElement(b.VpSearchInput,{onPressEnter:t.handlesearch,searchButton:t.handlesearch,onChange:t.handleChange,placeholder:"请输入名称或编号搜索..."}))),t.vrmAuthUtil.isAttWrite()?g["default"].createElement(v.VpCol,{span:20,className:"text-right"},g["default"].createElement(v.VpTooltip,{placement:"top",title:"快速创建"},g["default"].createElement(v.VpButton,{onClick:this.handleModal,data:"add","data-type":"1",type:"primary",className:"m-l-xs",shape:"circle"},g["default"].createElement(v.VpIcon,{data:"add","data-type":"1",type:"plus"})))):null)),g["default"].createElement("div",{className:"business-wrapper p-t-sm full-height"},g["default"].createElement("div",{className:"bg-white p-sm full-height entity-list-table"},g["default"].createElement(v.VpRow,{gutter:16,className:"full-height"},g["default"].createElement(v.VpCol,{span:t.state.shrinkShow?"4":"0",className:"full-height pr menuleft"},g["default"].createElement("div",{className:"full-height scroll-y"},g["default"].createElement(v.VpMenu,{className:"full-height",onClick:t.handleClick,openKeys:t.state.openKeys,onOpen:t.onToggle,onClose:t.onToggle,mode:"inline",selectedKeys:[t.state.filtervalue],style:{fontSize:14}},g["default"].createElement(v.VpSubMenu,{key:"filter",title:g["default"].createElement("span",null,g["default"].createElement(v.VpIconFont,{type:"vpicon-filter",className:"m-r-xs"}),g["default"].createElement("span",null,"过滤器"))},t.state.filters.map(function(t,e){return g["default"].createElement(v.VpMenuItem,{key:t.value},t.name)})))),t.state.shrinkShow?g["default"].createElement("div",{className:"navswitch cursor text-center",onClick:t.shrinkLeft},g["default"].createElement(v.VpIconFont,{type:"vpicon-navclose"})):null),g["default"].createElement(v.VpCol,{span:t.state.shrinkShow?"20":"24",className:"full-height scroll-y",id:"table"},t.state.shrinkShow?null:g["default"].createElement("div",{className:"shrink p-tb-sm cursor text-center",onClick:t.shrinkLeft},g["default"].createElement(v.VpIconFont,{type:"vpicon-navopen"})),g["default"].createElement(v.VpTable,{ref:function(e){return t.VpTable=e},columns:t.state.table_headers,resize:!0,className:"entity-list-table",dataUrl:t.state.url,scroll:{y:t.state.maxHeight},controlAddButton:t.renderHeight,loading:this.state.spinStatus,onRowClick:t.rowClick,params:{condition:(0,s["default"])(t.state.searchData),entityid:t.state.entityid,quickSearch:t.state.searchStr,viewcode:"list",viewtype:"list",filtervalue:t.state.filtervalue,currentkey:t.state.currentkey}}))))),g["default"].createElement(b.RightBox,{max:!0,button:g["default"].createElement("div",{className:"icon p-xs",onClick:t.closeRightModal.bind(t)},g["default"].createElement(v.VpTooltip,{placement:"top",title:S["default"].drawerSpinIcon[window.LOCALE]},g["default"].createElement(v.VpIcon,{type:"right"}))),show:this.state.showRightBox},this.editDom()))}}]),e}(g["default"].Component);e["default"]=_=(0,v.VpFormCreate)(_)},1034:function(t,e,i){var a=i(1035);"string"==typeof a&&(a=[[t.id,a,""]]);var n={hmr:!0};n.transform=void 0;i(439)(a,n);a.locals&&(t.exports=a.locals)},1035:function(t,e){}});