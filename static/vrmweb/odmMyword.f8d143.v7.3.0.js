webpackJsonp([1],{960:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(14),o=n(l),r=a(687),i=n(r),s=a(54),c=n(s),d=a(55),u=n(d),m=a(59),p=n(m),h=a(93),f=n(h),g=a(8),v=n(g),V=a(4),E=a(652),y=a(804),b=n(y),x=a(872),w=n(x),k=a(836),C=n(k);a(961);var S=function(e){function t(e){(0,c["default"])(this,t);var a=(0,p["default"])(this,(t.__proto__||(0,i["default"])(t)).call(this,e));return a.handleVisibleChange=function(e,t){a.setState({record:t})},a.handleInput=function(e){a.props.form.setFieldsValue({docName:""}),a.setState({showRightBox:!1})},a.handleModalUploader=function(){a.setState({modal_visible:!0,uploader:v["default"].createElement(V.VpUploader,{server:a.getUploadUrl(),fileNumLimit:1,fileSizeLimit:1048576e3,accept:{title:"word",extensions:"doc,docx",mimeTypes:"/*"}})})},a.getUploadUrl=function(){return"{vpodm}/odm/doc/uploadAndExtractDoc"},a.handleModalCancel=function(e){a.setState({modal_visible:!1,uploader:""}),a.getData()},a.state={table_headers:[],table_array:[],cur_page:1,pagination:{},limit:10,docName:"",tabs_array:[],group:"",spinStatus:!1,uploader:"",rightBox_type:"",modal_visible:!1},a.handlesearch=a.handlesearch.bind(a),a.handleChange=a.handleChange.bind(a),a.tableChange=a.tableChange.bind(a),a.handleMenuClick=a.handleMenuClick.bind(a),a.VpPopconfirmfunction=a.VpPopconfirmfunction.bind(a),a.handleVisibleChange=a.handleVisibleChange.bind(a),a.newIframe=a.newIframe.bind(a),a.groupChange=a.groupChange.bind(a),a.saveRenameDoc=a.saveRenameDoc.bind(a),a}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"componentWillMount",value:function(){this.getData(),this.getColumns()}},{key:"getColumns",value:function(e){var t=this,a=v["default"].createElement(V.VpMenu,null,v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{target:"_blank",href:"javaScript:void(0)",onClick:this.newIframe},v["default"].createElement(V.VpIcon,{type:"file",className:"cursor f16 m-lr-xs text-primary"}),"新窗口打开")),v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{href:"javaScript:void(0)",onClick:this.docDownloadRightBox.bind(this)},v["default"].createElement(V.VpIcon,{type:"download",className:"cursor f16 m-lr-xs text-info"}),"下载")),v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{href:"javaScript:void(0)",onClick:this.VpPopconfirmfunction},v["default"].createElement(V.VpIcon,{type:"cross",className:"cursor text-danger f16 m-lr-xs"}),"删除")),v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{href:"javaScript:void(0)",onClick:this.saveDocVer.bind(this)},v["default"].createElement(V.VpIcon,{type:"tags-o",className:"cursor text-danger f16 m-lr-xs"}),"保存版本")),v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{href:"javaScript:void(0)",onClick:this.docVerRightBox.bind(this)},v["default"].createElement(V.VpIcon,{type:"scan",className:"cursor text-danger f16 m-lr-xs"}),"查看历史")),v["default"].createElement(V.VpMenuItem,null,v["default"].createElement("a",{href:"javaScript:void(0)",onClick:this.renameDocRightBox.bind(this)},v["default"].createElement(V.VpIcon,{type:"desktop",className:"cursor text-danger f16 m-lr-xs"}),"重命名"))),n=[{title:"序号",dataIndex:"row_id",key:"row_id"},{title:"需求文档名称",dataIndex:"docname",key:"docname",render:function(e,t,a){return v["default"].createElement("span",null,v["default"].createElement(V.VpIcon,{style:{padding:"5 5px",width:"20px"},type:"file-text"}),e)}},{title:"版本",dataIndex:"docver",key:"docver"},{title:"类型",dataIndex:"docfileext",key:"docfileext"},{title:"所有者",dataIndex:"creusername",key:"creusername",onFilter:function(e,t){return 0===t.creusername.indexOf(e)},filterMultiple:!0,filters:[{text:"李赛男",value:"李赛男"},{text:"李四",value:"李四"},{text:"admin",value:"admin"}],sorter:function(e,t){return e.creusername.length-t.creusername.length}},{title:"创建时间",dataIndex:"credttm",key:"credttm",render:function(e,t,a){return e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)+" "+e.substring(8,10)+":"+e.substring(10,12)},sorter:function(e,t){return e.credttm-t.credttm}},{title:"操作",key:"operation",fixed:"right",width:"100",render:function(e,n,l){return v["default"].createElement(V.VpDropdown,{overlay:a,onVisibleChange:function(e){return t.handleVisibleChange(e,n)}},v["default"].createElement(V.VpButton,{type:"ghost",shape:"circle",className:"m-l-xs"},v["default"].createElement(V.VpIcon,{type:"bars"})))}}];this.setState({table_headers:n})}},{key:"handleMenuClick",value:function(e){alert(123)}},{key:"getData",value:function(e){var t=this;this.setState({spinStatus:!0});var a=this.state,n=a.cur_page,l=a.limit,o=a.docName,r=a.group;(0,V.vpQuery)("{vpodm}/odm/doc/listAllDoc",{docName:o,currentPage:n,numPerPage:l,group:r}).then(function(e){var a=e.data,n=function(){return"共"+a.totalRows+"条"};t.setState({table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{total:a.totalRows,pageSize:parseInt(a.numPerPage),current:a.currentPage,showSizeChanger:!0,showQuickJumper:!0,showTotal:n},spinStatus:!1})})["catch"](function(e){t.setState({spinStatus:!1});var a=(0,V.VpMError)({title:"提示",content:"请求失败！请检查网络连接..."});setTimeout(function(){return a.destroy()},3e3)})}},{key:"VpPopconfirmfunction",value:function(e){var t=this;t.setState({spinStatus:!0}),(0,V.VpConfirm)({title:"您是否确认要删除这条记录?",onOk:function(){(0,V.vpRemove)("{vpodm}/odm/doc/deleteDoc/"+t.state.record.docid,"","",5e9).then(function(e){t.setState({spinStatus:!1}),t.getData();var a=(0,V.VpMSuccess)({title:"提示",content:"删除成功！"});setTimeout(function(){return a.destroy()},3e3)})},onCancel:function(){t.setState({spinStatus:!1})}})}},{key:"getBoxContent",value:function(){return"addDoc"==this.state.rightBox_type?this.addNewTemp():"showDocVer"==this.state.rightBox_type?this.listDocVer():"renameDoc"==this.state.rightBox_type?this.renameDoc():"showDownload"==this.state.rightBox_type?this.listDownloadOutline():void 0}},{key:"saveDocVer",value:function(e){var t=this;t.setState({spinStatus:!0}),(0,V.vpAdd)("{vpodm}/odm/docVer/saveOdmWordDocVer",{docId:t.state.record.docid},"",5e9).then(function(e){t.setState({spinStatus:!1}),t.getData()})}},{key:"docVerRightBox",value:function(){this.state.rightBox_type="showDocVer",this.setState({showRightBox:!0,increaseData:{}})}},{key:"docDownloadRightBox",value:function(){this.state.rightBox_type="showDownload",this.setState({showRightBox:!0,increaseData:{}})}},{key:"renameDocRightBox",value:function(){this.state.rightBox_type="renameDoc",this.setState({showRightBox:!0,increaseData:{}})}},{key:"checkNames",value:function(e,t,a){null==t||""==t.trim()?a(new Error("修改后名字不能为空")):t.trim().length>30?a(new Error("名字长度不能超过30字")):a()}},{key:"renameDoc",value:function(){var e=this.props.form.getFieldProps,t={labelCol:{span:6},wrapperCol:{span:8}},a=e("docName",{rules:[{required:!0,message:"需求文档名称为必输项"},{validator:this.checkNames}]});return v["default"].createElement(V.VpTabs,{defaultActiveKey:"0"},v["default"].createElement(V.VpTabPane,{tab:"重命名",key:"0"},v["default"].createElement("div",{className:"p-sm m-t-lg"},v["default"].createElement(V.VpForm,{horizontal:!0},v["default"].createElement(V.VpFInput,(0,o["default"])({},t,{disabled:!0,label:"修改前需求文档名称",value:this.state.record.docname})),v["default"].createElement(V.VpFInput,(0,o["default"])({},t,a,{label:"修改后需求文档名称"})),v["default"].createElement("div",{className:"ant-row ant-form-item footFixed",style:{marginTop:24}},v["default"].createElement("div",null,v["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},v["default"].createElement(V.VpButton,{style:{marginTop:2},type:"primary",onClick:this.saveRenameDoc},"确定"),v["default"].createElement(V.VpButton,{style:{marginTop:2,marginLeft:10},type:"ghost",onClick:this.handleInput.bind(this)},"取消"))))))))}},{key:"saveRenameDoc",value:function(e){var t=this;this.props.form.validateFields(["docName"],function(e,a){e||(0,V.vpEdit)("{vpodm}/odm/doc/rename",{docId:t.state.record.docid,docName:t.props.form.getFieldsValue().docName}).then(function(e){if(t.setState({showRightBox:!1}),"VP000000"==e.infocode){t.props.form.setFieldsValue({docName:""}),t.getData();var a=(0,V.VpMSuccess)({title:"提示",content:"重命名成功！"});setTimeout(function(){return a.destroy()},3e3)}})["catch"](function(e){t.setState({showRightBox:!1}),t.props.form.setFieldsValue({docName:""}),t.getData();var a=(0,V.VpMError)({title:"提示",content:"重命名失败！"});setTimeout(function(){return a.destroy()},3e3)})})}},{key:"listDocVer",value:function(){var e=this,t=e.state.record.docname+"-版本信息";return v["default"].createElement(V.VpTabs,{defaultActiveKey:"0"},v["default"].createElement(V.VpTabPane,{tab:t,key:"0"},v["default"].createElement(w["default"],{docIdCode:e.state.record.docidcode})))}},{key:"listDownloadOutline",value:function(){var e=this,t=e.state.record.docname+"-文档导出";return v["default"].createElement(C["default"],{docId:e.state.record.docid,docname:t})}},{key:"newIframe",value:function(e){window.open("pages/vrm/vrm-word/index.html?docId="+this.state.record.docid)}},{key:"handlesearch",value:function(){var e=this;this.setState({docName:this.searchValue},function(){e.getData()})}},{key:"handleChange",value:function(e){this.searchValue=e.target.value}},{key:"tableChange",value:function(e,t,a){var n=this;this.setState({cur_page:e.current||this.state.cur_page,limit:e.pageSize||this.state.limit},function(){n.getData()})}},{key:"groupChange",value:function(e){var t=this;this.setState({group:e.target.value},function(){t.getData()})}},{key:"addNewAttr",value:function(){this.state.rightBox_type="addDoc",this.setState({showRightBox:!0,increaseData:{}})}},{key:"closeRightModal",value:function(e){this.setState({showRightBox:!1,rightBox_type:""})}},{key:"addNewTemp",value:function(){var e=this;return v["default"].createElement(V.VpTabs,{defaultActiveKey:"0"},v["default"].createElement(V.VpTabPane,{tab:"在线文档",key:"0"},v["default"].createElement(V.VpRow,{gutter:16,className:"p-md text-center full-height scroll"},v["default"].createElement(V.VpCol,{className:"gutter-row m-b-sm",span:6},v["default"].createElement("div",{className:"p-sm b file-box"},v["default"].createElement("a",{target:"_blank",onClick:e.createNewWord.bind(e)},v["default"].createElement("div",{className:"img text-muted"},v["default"].createElement(V.VpIcon,{type:"file"})),v["default"].createElement("div",{className:"p-t-sm text-overflow"},"空白文档")))))))}},{key:"createNewWord",value:function(){var e=this,t=this;(0,V.vpAdd)("{vpodm}/odm/doc/createNewDoc").then(function(e){if("function"!=typeof e)return e;json()}).then(function(a){"VP000000"==a.infocode?(window.open("pages/vrm/vrm-word/index.html?docId="+a.data.docId,"_blank"),t.getData(),(0,V.VpMsgSuccess)("添加成功！")):(0,V.VpMsgError)("添加失败！"),e.setState({showRightBox:!1})})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldProps;t("name",{rules:[{required:!0,message:"功能名称不能为空"},{validator:this.userExists}]}),v["default"].createElement(V.VpMenu,{onClick:this.handleMenuClick},v["default"].createElement(V.VpMenuItem,{key:"1"},"默认"),v["default"].createElement(V.VpMenuItem,{key:"2"},"更新时间"),v["default"].createElement(V.VpMenuItem,{key:"3"},"创建时间"),v["default"].createElement(V.VpMenuItem,{key:"4"},"文件名"),v["default"].createElement(V.VpMenuItem,{key:"5"},"所有者"));return v["default"].createElement(V.VpSpin,{spinning:this.state.spinStatus},v["default"].createElement("div",{className:"my-word pr full-height"},v["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},v["default"].createElement(V.VpRow,{gutter:10},v["default"].createElement(V.VpCol,{className:"gutter-row",span:4},v["default"].createElement(E.VpSearchInput,{onPressEnter:this.handlesearch,searchButton:this.handlesearch,onChange:this.handleChange,placeholder:"请输入文档名称搜索..."})),v["default"].createElement(V.VpCol,{className:"gutter-row",span:12},v["default"].createElement(V.VpRadioGroup,{defaultValue:"",onChange:this.groupChange},v["default"].createElement(V.VpRadioButton,{value:""},"所有"),v["default"].createElement(V.VpRadioButton,{value:"b"},"我创建的"))),v["default"].createElement(V.VpCol,{className:"text-right",sm:8},v["default"].createElement(V.VpTooltip,{placement:"top",title:"新增文档"},v["default"].createElement(V.VpButton,{type:"primary",shape:"circle",icon:"plus",onClick:e.addNewAttr.bind(e)})),v["default"].createElement(V.VpTooltip,{placement:"top",title:"导入文档"},v["default"].createElement(V.VpButton,{type:"ghost",shape:"circle",icon:"upload",className:"m-l-xs",onClick:this.handleModalUploader})),v["default"].createElement("span",{className:"m-l-xs"},v["default"].createElement(V.VpRadioGroup,{defaultValue:"a",onChange:this.handleClick},v["default"].createElement(V.VpRadioButton,{value:"a"},v["default"].createElement(V.VpTooltip,{placement:"top",title:"列表"},v["default"].createElement(V.VpIcon,{type:"bars"}))),v["default"].createElement(V.VpRadioButton,{value:"b"},v["default"].createElement(V.VpTooltip,{placement:"top",title:"平铺"},v["default"].createElement(V.VpIcon,{type:"appstore"})))))))),v["default"].createElement("div",{className:"content full-height p-t-sm"},v["default"].createElement("div",{className:"p-sm bg-white"},v["default"].createElement(V.VpTable,{columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,resize:!0,size:"middle"}))),v["default"].createElement(E.RightBox,{button:v["default"].createElement("div",{className:"icon p-xs",onClick:e.closeRightModal.bind(e)},v["default"].createElement(V.VpTooltip,{placement:"top",title:b["default"].drawerSpinIcon[window.LOCALE]},v["default"].createElement(V.VpIcon,{type:"right"}))),show:this.state.showRightBox},this.getBoxContent()),v["default"].createElement(V.VpModal,{width:"60%",style:{height:630},title:"导入文档",visible:this.state.modal_visible,onCancel:this.handleModalCancel,footer:v["default"].createElement("div",{className:"text-center"},v["default"].createElement(V.VpButton,{type:"ghost",onClick:this.handleModalCancel},"关闭"))},this.state.uploader)))}}]),t}(v["default"].Component);t["default"]=S=(0,V.VpFormCreate)(S)},961:function(e,t,a){var n=a(962);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},962:function(e,t){}});