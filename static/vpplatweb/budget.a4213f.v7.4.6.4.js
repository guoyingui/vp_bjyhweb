webpackJsonp([11],{974:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){var a=e.length-t.length;return a>=0&&e.lastIndexOf(t)==a}function l(){return[{title:"名称",dataIndex:"sname",key:"sname",width:250,fixed:"",render:function(e,t){switch(t.ientityid){case"7":return x["default"].createElement("div",{className:"inline-display"},x["default"].createElement(V.VpTooltip,{title:"项目"},x["default"].createElement(V.VpIconFont,{type:"vpicon-project m-lr-xs text-success"})),e);case"6":return x["default"].createElement("div",{className:"inline-display"},x["default"].createElement(V.VpTooltip,{title:"项目群"},x["default"].createElement(V.VpIconFont,{type:"vpicon-wenben m-lr-xs text-primary"})),e);case"8":return x["default"].createElement("div",{className:"inline-display"},x["default"].createElement(V.VpTooltip,{title:"子项目"},x["default"].createElement(V.VpIconFont,{type:"vpicon-file-text m-lr-xs text-info"})),e);case"114":return x["default"].createElement("div",{className:"inline-display"},x["default"].createElement(V.VpTooltip,{title:"任务"},x["default"].createElement(V.VpIconFont,{type:"vpicon-file-zip m-lr-xs text-warning"})),e);default:return x["default"].createElement("div",{className:"inline-display"},e)}}},{title:"编号",dataIndex:"scode",key:"scode",width:"",fixed:""},{title:"类别",dataIndex:"iclassid",key:"iclassid",width:"",fixed:""},{title:"状态",dataIndex:"istatusid",key:"istatusid",width:"",fixed:""},{title:"归属部门",dataIndex:"idepartmentid",key:"idepartmentid",width:"",fixed:""},{title:"上级项目群组",dataIndex:"iparent",key:"iparent",width:"",fixed:""},{title:"负责人",dataIndex:"inamerole",key:"inamerole",width:"",fixed:""}]}Object.defineProperty(t,"__esModule",{value:!0});var s=a(363),r=i(s),o=a(802),d=i(o),c=a(14),u=i(c),p=a(688),f=i(p),y=a(54),m=i(y),h=a(55),v=i(h),g=a(59),b=i(g),w=a(93),k=i(w),E=a(8),x=i(E),V=a(4),C=a(835),S=i(C),T=a(824),N=i(T),I=a(836),F=i(I);a(975);var R=a(820),D=a(652),_=function(e){function t(e){(0,m["default"])(this,t);var a=(0,b["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this,e));return a.loadDocType=function(){(0,V.vpQuery)("/{vpplat}/vfrm/entity/doctype",{entityid:a.state.entityid}).then(function(e){a.setState({doctypelist:e.data,selectType:e.data[0].value})})},a.queryEntityType=function(){(0,V.vpQuery)("/{vpplat}/vfrm/entity/entitytype",{entityid:a.state.entityid}).then(function(e){a.setState({entitytype:e.data.entitytype})})},a.querySearchFormData=function(){(0,V.vpQuery)("/{vpplat}/vfrm/entity/searchForm",{entityid:a.state.entityid,scode:"search"}).then(function(e){a.setState({SearchFormData:e.data.form})})},a.chooseModalVisible=function(e){a.chooseVisible=e},a.getEditHeader=function(){var e=a,t={entityid:e.state.entityid,viewcode:"initeditlist"};(0,V.vpQuery)("/{vpplat}/vfrm/entity/initEditGrids",(0,u["default"])({},t)).then(function(t){if(t&&t.hasOwnProperty("data")){var a=[],i=t.data.fields;if(0==i.length)return(0,V.VpAlertMsg)({message:"消息提示",description:"未查询到编辑列表视图！",type:"error",onClose:this.onClose,closeText:"关闭",showIcon:!0},5),void e.setState({table_headers:[]});i.length;i.map(function(t,i){var n=void 0,l=void 0,s=void 0,r=void 0;for(var o in t)"field_label"==o?n=t[o]:"field_name"==o&&(l=t[o]),"fixed"==o&&(r=t[o]),"iwidth"==o&&(s=t[o]);n&&l&&("left"==r||"right"==r?a.push({title:n,dataIndex:l,key:l,width:s,fixed:r}):a.push({title:n,dataIndex:l,width:s,key:l,fixed:r,render:t.edit_col?function(a,i){return x["default"].createElement(D.EditTableCol,{callBack:e.callBack,record:i,widget:t.widget,item:(0,u["default"])({},t.widget,{irelationentityid:t.irelationentityid}),value:a})}:null}))}),a.push({title:"操作",fixed:"right",width:120,key:"operation",render:function(t,a){return x["default"].createElement("span",null,x["default"].createElement(V.VpTooltip,{placement:"top",title:"附件"},x["default"].createElement(V.VpIconFont,{onClick:function(){return e.openupload(a)},className:"text-primary m-lr-xs cursor",type:"vpicon-paperclip"})),"0"!=a.istatusflag||!e.state.entityaddrole||"0"==a.principal&&"2"!=e.state.entityid?null:x["default"].createElement(V.VpTooltip,{placement:"top",title:"删除"},x["default"].createElement(V.VpPopconfirm,{title:"确定要删除这条信息吗？",onConfirm:function(){return e.confirm(a.ientityid,a.iid)},onCancel:e.cancel},x["default"].createElement(V.VpIconFont,{className:"cursor m-lr-xs text-danger",type:"vpicon-shanchu"}))),a.iid>0?x["default"].createElement(V.VpTooltip,{placement:"top",title:"查看详情"},x["default"].createElement(V.VpIconFont,{onClick:function(){return e.onRowClick(a,"")},className:"text-primary m-lr-xs cursor",type:"vpicon-navopen"})):null)}}),e.setState({table_headers:a,tableloading:!1})}})["catch"](function(t){e.setState({tableloading:!1})})},a.openupload=function(e){var t=e.iid;a.state.editrowdata[t]=e,a.setState({VpUploader:!0,currentiid:e.iid,editrowdata:a.state.editrowdata})},a.callBack=function(e){var t=e.iid;a.state.editrowdata[t]=e,a.setState({editrowdata:a.state.editrowdata})},a.handleEditAdd=function(){a.tableRef.addTableRow({iid:a.objectid--});var e=vp.computedHeight(1);a.setState({tableHeight:e})},a.handleEditSave=function(){var e=a.state.editrowdata;if($.isEmptyObject(e))return void(0,V.VpAlertMsg)({message:"消息提示",description:"暂无可保存的数据！",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5);var t=[];for(var i in e)if(e.hasOwnProperty(i)){var l=e[i];delete l.undefined,delete l.className;var s=a.state.filearr[l.iid];""!=s&&s!=undefined&&(l.fileinfo=s);for(var r in l)if(n(r,"val")){var o=r.replace("val","");l[o]=l[r]}l.iid=l.iid>0?l.iid:"",t.push(l)}(0,V.vpAdd)("/{vpplat}/vfrm/entity/saveEditData",{entityid:a.state.entityid,editData:(0,d["default"])(t)}).then(function(e){a.tableRef.getTableData(),a.setState({editrowdata:{},filearr:{}})})},a.handleReload=function(){a.setState({tableloading:!0}),a.tableRef.getTableData()},a.getconfig=function(){var e=a;(0,V.vpQuery)("/{vpplat}/vfrm/entity/getConfig",{entityid:e.state.entityid}).then(function(t){if(t.hasOwnProperty("data")){if(t.data.hasOwnProperty("search")){var a=t.data.lastview;a=""==a||a==undefined?"0":a;var i=t.data.search.filters;i.unshift({value:"like",name:"我关注的"}),e.setState({filtervalue:a,currentkey:"filter",openKeys:["filter"],filters:i,statusFilters:t.data.search.statusFilters,classFilters:t.data.search.classFilters})}t.data.hasOwnProperty("toolbar")&&t.data.hasOwnProperty("entityrole")&&e.setState({entityaddrole:t.data.entityrole})}})},a.sorter=function(e,t){},a.menuClick=function(e,t,i){var n=e.key;"summary"==n?(a.setState({isClickMenu:!0}),(0,V.vpAdd)("/{vpplat}/vfrm/entity/summary",{entityid:t,iid:i}).then(function(e){a.setState({isClickMenu:!1}),(0,V.VpAlertMsg)({message:"消息提示",description:"计算汇总成功!",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5)})):"weekreport"==n?(a.setState({isClickMenu:!0}),(0,V.vpQuery)("/{vpmprovider}/weekport/addweekreport",{projectid:i,startdate:"",enddate:""}).then(function(e){a.setState({isClickMenu:!1}),(0,V.VpAlertMsg)({message:"消息提示",description:"生成周报成功!",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5)})):("7"==t&&"pjtree"==a.state.viewtype&&(i=i.substr(0,i.length-1)),a.jumpTabs(n,t,i))},a.discuss=function(e,t,i){e.stopPropagation();var n="entity"+t+"_discuss";a.jumpTabs(n,t,i)},a.document=function(e,t,i){e.stopPropagation();var n="entity"+t+"_file";a.jumpTabs(n,t,i)},a.jumpTabs=function(e,t,i){a.getDynamicTabs(!0,t,i),a.setState({defaultActiveKey:e+"tab",showRightBox:!0,entityiid:i,row_entityid:t,row_id:i})},a.documentList=function(e,t,i){e.stopPropagation();var n="entity"+t+"_doclist";a.jumpDocListTabs(n,t,i)},a.jumpDocListTabs=function(e,t,i){a.getDynamicTabs(!0,t,i),(0,V.vpQuery)("/{vpmprovider}/project/getProjectBySub",{subiid:i}).then(function(n){a.setState({defaultActiveKey:e+"tab",showRightBox:!0,subItemProjectId:n.data.iprojectid,entityiid:i,row_entityid:t,row_id:i})})},a.getExpandedRowa=function(e,t){var i=a,n=t;if(e.length){var l=[];e.map(function(e){n.push(e.key),e.hasOwnProperty("children")&&(l=i.getExpandedRowa(e.children,n),l.map(function(e){-1==n.findIndex(function(t){return e===t})&&n.push(e)}))})}return n},a.handleSearchForm=function(e){a.setState({searchData:e,s_visible:!1})},a.confirm=function(e,t){var i=a;(0,V.vpAdd)("/{vpplat}/vfrm/entity/deleteData",{iid:t,entityid:e}).then(function(e){i.tableRef.getTableData()})},a.sumCount=function(e,t){(0,V.vpAdd)("/{vpplat}/budget/updateBudgetMount",{entityid:e,iid:t}).then(function(e){})},a.sumpoolCount=function(e,t){(0,V.vpAdd)("/{vpplat}/budget/updateBudgetPool",{entityid:e,iid:t}).then(function(e){})},a.formevent=function(e,t,i){(0,V.vpQuery)("/{vpplat}/vfrm/entity/getformevent",{entityid:e,iid:t,viewtype:i}).then(function(e){a.setState({eventmap:e.data})})},a.queryentityRole=function(e,t){(0,V.vpQuery)("/{vpplat}/vfrm/entity/entityRole",{entityid:e,iid:t}).then(function(e){a.setState({entityrole:e.data.entityRole})})},a.handleStatus=function(e,t,a){},a.uploadSuccess=function(e,t){(0,V.VpAlertMsg)({message:"消息提示",description:"导入成功！",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),a.setState({entityVisible:!1},function(){return a.tableRef.getTableData()})},a.uploadClick=function(){a.inputUploader.upload.on("beforeFileQueued",function(e){a.props.form.setFieldsValue({xls_label:e.name})})},a.inputUploaderChange=function(e){},a.cancelSearch=function(){a.setState({s_visible:!1})},a.handleLike=function(e,t,i){e.stopPropagation(),(0,V.vpAdd)("/{vpplat}/vfrm/entity/handleLike",{ientityid:t,iid:i}).then(function(e){a.tableRef.getTableData()})},a.shrinkLeft=function(e){a.setState({shrinkShow:!a.state.shrinkShow})},a.handleClick=function(e){var t=e.key,i=e.keyPath.slice(1),n=e.keyPath.slice(1)[0];a.state.filtervalue==t&&a.state.currentkey==n||a.setState({filtervalue:t,openKeys:i,currentkey:n,tableloading:!0})},a.onToggle=function(e){a.setState({openKeys:e.open?e.keyPath:e.keyPath.slice(1)})},a.handleViewChange=function(e){a.setState({view:e.target.value,viewtype:e.target.value},function(){a.getHeader()})},a.queryentityList=function(){(0,V.vpQuery)("/{vpplat}/vfrm/entity/entityList",{}).then(function(e){a.setState({entityList:e.data})})},a.handleNewClick=function(e){a.queryentityRole(e.key,""),a.setState({showRightBox:!0,add:!0,entityiid:"",statusList:[],entityid:e.key,defaultActiveKey:"0"})},a.controlAddButton=function(e,t){var i=vp.computedHeight(t.length,".entityTable");"resource"==a.props.fromtype&&(i-=50);var n=a.getExpandedRowa(t,[]);a.setState({tableloading:!1,expandedRowKeys:n,tableHeight:i})},a.onUploadAccept=function(e,t){var i=a,n={fileid:t.data.fileid,doctype:t.data.doctype};i.state.filearr[i.state.currentiid]!=undefined&&null!=i.state.filearr[i.state.currentiid]?i.state.filearr[i.state.currentiid]=[].concat((0,r["default"])(i.state.filearr[i.state.currentiid]),[n]):i.state.filearr[i.state.currentiid]=[n],a.setState({filearr:i.state.filearr})},a.handleFileCancel=function(){a.setState({VpUploader:!1})},a.state={filters:[],visible:!1,showRightBox:!1,table_headers:[],table_array:[],quickvalue:"",increaseData:[],tabs_array:[],filterDropdownVisible:!1,isAdd:!1,entityid:"",iids:"",row_id:"",row_entityid:"",entityiid:"",add:!0,statusList:[],formvalue:{},varilsForm:{},viewtype:"",entityrole:!1,exShow:!1,exList:[],entityVisible:!1,toolbar:{},rowbar:[],SearchFormData:{},searchData:[],loading:!1,expandedRowKeys:[],tableHeight:"",tips:"",defaultActiveKey:"0",shrinkShow:!0,openKeys:["filter"],view:"list",entityList:[],statusFilters:[],classFilters:[],currentkey:"filter",scode:"",sname:"",subItemProjectId:"",entitytype:!1,spinning:!1,editrowdata:{},tableloading:!0,VpUploader:!1,filearr:{},doctypelist:[],selectType:"",isClickMenu:!1},a.objectid=0,a.closeRightModal=a.closeRightModal.bind(a),a.handleOk=a.handleOk.bind(a),a.handlesearch=a.handlesearch.bind(a),a.handleVisibleChange=a.handleVisibleChange.bind(a),a.onRowClick=a.onRowClick.bind(a),a.dropVisbleChange=a.dropVisbleChange.bind(a),a.getHeader=a.getHeader.bind(a),a.addNewDom=a.addNewDom.bind(a),a.getDynamicTabs=a.getDynamicTabs.bind(a),a.cancelModal=a.cancelModal.bind(a),a.exTypeData=a.exTypeData.bind(a),a.handleMenuClick=a.handleMenuClick.bind(a),a.onExpand=a.onExpand.bind(a),a.handleDropDown=a.handleDropDown.bind(a),a}return(0,k["default"])(t,e),(0,v["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;e.params?(e.params.entityid!=this.props.params.entityid&&this.setState({entityid:e.params.entityid,showRightBox:!1,viewtype:e.params.type},function(){t.getHeader(),t.querySearchFormData(),t.getconfig(),t.queryentityList(),t.queryEntityType()}),e.params.type!=this.props.params.type&&this.setState({viewtype:e.params.type,showRightBox:!1},function(){t.getHeader(),t.getconfig(),t.querySearchFormData(),t.queryentityList(),t.queryEntityType()})):this.setState({viewtype:e.viewtype,entityid:e.entityid,toolbar:e.toolbar,rowbar:e.rowbar,showRightBox:!1},function(){t.getHeader(),t.getconfig(),t.queryEntityType()})}},{key:"componentWillMount",value:function(){var e=this;this.setState({entityid:this.props.params?this.props.params.entityid:this.props.entityid,viewtype:this.props.params?this.props.params.type:this.props.type,toolbar:this.props.toolbar,rowbar:this.props.rowbar},function(){e.getHeader(),e.exTypeData(),e.getconfig(),e.querySearchFormData(),e.queryentityList(),e.queryEntityType(),e.loadDocType()})}},{key:"componentDidMount",value:function(){$(".search").find("input").attr("maxlength",400)}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){}}},{key:"getHeader",value:function(){this.setState({tableloading:!0});var e=this;if("edit"==e.state.viewtype)return void this.getEditHeader();(0,V.vpQuery)("/{vpplat}/vfrm/entity/getheaders",{entityid:e.state.entityid}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];if(t.data.grid.hasOwnProperty("fields")){t.data.grid.fields.map(function(e,t){var i=void 0,n=void 0,l=void 0,s=void 0;for(var r in e)"field_label"==r?i=e[r]:"field_name"==r&&(n=e[r]),"fixed"==r&&(s=e[r]),"iwidth"==r&&(l=e[r]);i&&n&&("left"==s||"right"==s?a.push({title:i,dataIndex:n,key:n,width:l,fixed:s}):a.push({title:i,dataIndex:n,key:n,fixed:s,width:l,sorter:"inamerole"!=n}))}),"pjtree"==e.state.view&&(a=l());var i=["bg-success","bg-warning","bg-danger"],n=x["default"].createElement("div",null,x["default"].createElement(V.VpTooltip,{title:"进度"},x["default"].createElement(V.VpIconFont,{type:"vpicon-tip",className:"m-r-xs text-success"})),x["default"].createElement(V.VpTooltip,{title:"成本"},x["default"].createElement(V.VpIconFont,{type:"vpicon-tip",className:"m-r-xs text-primary"})),x["default"].createElement(V.VpTooltip,{title:"质量"},x["default"].createElement(V.VpIconFont,{type:"vpicon-tip",className:"m-r-xs text-warning"})),x["default"].createElement(V.VpTooltip,{title:"风险"},x["default"].createElement(V.VpIconFont,{type:"vpicon-tip",className:"m-r-xs text-danger"}))),s={title:n,width:115,dataIndex:"indicator",key:"indicator",render:function(e,t){var a=t.ischeduleindicator,n=t.icostindicator,l=t.iriskindicator,s=t.iqualityindicator;return x["default"].createElement("div",{className:"indic-wrapper"},x["default"].createElement("span",{key:0,className:i[a]}),x["default"].createElement("span",{key:1,className:i[n]}),x["default"].createElement("span",{key:2,className:i[l]}),x["default"].createElement("span",{key:3,className:i[s]}))}},r=a,o=e.state.entityid;6!=o&&7!=o&&8!=o||r.unshift(s),r.map(function(e,t){if("icontrolmode"==e.key){var a=x["default"].createElement("div",{className:"inline-display"},"管控模式");e.title=a,e.width=100,e.render=function(e,t){return x["default"].createElement("div",{className:"indic-wrapper"},"2"==t.icontroltype?x["default"].createElement(V.VpTag,{color:"blue",className:"vp-btn-br p-lr-lg"},"敏捷"):x["default"].createElement(V.VpTag,{color:"yellow",className:"vp-btn-br p-lr-lg"},"瀑布"))}}else"istatusid"==e.key?e.render=function(e,t){return x["default"].createElement("div",{className:"indic-wrapper"},x["default"].createElement(V.VpIconFont,{type:(t.istatusflag,"vpicon-circle-o text-primary"),className:"m-r-xs"}),e)}:"iclassid"==e.key?e.render=function(e,t){return x["default"].createElement("div",{className:"indic-wrapper"},e)}:"scurrentphase"==e.key&&(e.render=function(e,t){return x["default"].createElement("div",{className:"indic-wrapper"},""!=e?x["default"].createElement(V.VpTag,{color:"1"==t.phasetype?"green":"gray",className:"vp-btn-br p-lr-lg"},e):null)})}),r.push({title:"操作",fixed:"right",width:140,key:"operation",render:function(t,a){return x["default"].createElement("span",null,x["default"].createElement(V.VpTooltip,{placement:"top",title:0==a.ilike?"关注":"取消关注"},x["default"].createElement(V.VpIconFont,{onClick:function(t){return e.handleLike(t,a.ientityid,a.iid)},className:"text-primary m-lr-xs cursor",type:1==a.ilike?"vpicon-star":"vpicon-star-o"})),127!=e.state.entityid?x["default"].createElement(V.VpTooltip,{placement:"top",title:"评论"},x["default"].createElement(V.VpIconFont,{onClick:function(t){return e.discuss(t,a.ientityid,a.iid)},className:"text-primary m-lr-xs cursor",type:"vpicon-pinglun"})):null,"0"!=a.istatusflag||!e.state.entityaddrole||"0"==a.principal&&"2"!=e.state.entityid?null:x["default"].createElement(V.VpTooltip,{placement:"top",title:"删除"},x["default"].createElement(V.VpPopconfirm,{title:"确定要删除这条信息吗？",onConfirm:function(){return e.confirm(a.ientityid,a.iid)},onCancel:e.cancel},x["default"].createElement(V.VpIconFont,{onClick:function(e){return e.stopPropagation()},className:"cursor m-lr-xs text-danger",type:"vpicon-shanchu"}))),a.action||"6"==a.ientityid||"7"==a.ientityid?x["default"].createElement(V.VpTooltip,{placement:"top",title:"更多"},e.state.isClickMenu?"":x["default"].createElement(V.VpDropdown,{overlay:x["default"].createElement(V.VpMenu,{onClick:function(t){return e.menuClick(t,a.ientityid,a.iid)}},"6"==a.ientityid||"7"==a.ientityid?x["default"].createElement(V.VpMenuItem,{key:"summary"},x["default"].createElement(V.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:"vpicon-see-o"}),"计算汇总"):"","7"==a.ientityid?x["default"].createElement(V.VpMenuItem,{key:"weekreport"},x["default"].createElement(V.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:"vpicon-progress"}),"生成周报"):"",a.action?a.action.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.skey},x["default"].createElement(V.VpIconFont,{className:"cursor m-r-xs f16 text-primary",type:e.icontype}),e.sname)}):""),trigger:["click"],getPopupContainer:function(e){return document.getElementById("vp-entity-drown")}},x["default"].createElement(V.VpIconFont,{"data-id":a.iid,className:"cursor m-lr-xs f16",type:"vpicon-wait-x",onClick:function(e){return e.stopPropagation()}}))):"")}}),e.setState({table_headers:r,tableloading:!1})}}})["catch"](function(e){})}},{key:"onExpand",value:function(e,t){if(e)this.setState({expandedRowKeys:[].concat((0,r["default"])(this.state.expandedRowKeys),[t.key])});else{var a=this.state.expandedRowKeys.findIndex(function(e){return t.key===e});this.setState({expandedRowKeys:[].concat((0,r["default"])(this.state.expandedRowKeys.slice(0,a)),(0,r["default"])(this.state.expandedRowKeys.slice(a+1)))})}}},{key:"handleDropDown",value:function(e){e.stopPropagation()}},{key:"exTypeData",value:function(){var e=this;(0,V.vpQuery)("/{vpplat}/vfrm/entity/exListType",{entityid:this.state.entityid}).then(function(t){e.setState({exList:t.data})})}},{key:"getDynamicTabs",value:function(e,t,a){var i=this;e?setTimeout(function(){(0,V.vpAdd)("/{vpplat}/vfrm/entity/dynamicTabs",{entityid:"pjtree"==i.state.viewtype?t:i.state.entityid,iid:a}).then(function(e){var t=e.data.tabs;i.setState({tabs_array:t})})},200):this.setState({tabs_array:[]})}},{key:"dropVisbleChange",value:function(e){this.setState({filterDropdownVisible:e})}},{key:"handlesearch",value:function(e){var t=e.replace(/\s/g,"");this.setState({quickvalue:t,tableloading:!0})}},{key:"onShowSizeChange",value:function(e){}},{key:"showModal",value:function(e){e.target.dataset.id;this.setState({showRightBox:!0,isAdd:!1})}},{key:"closeRightModal",value:function(){var e=this;this.setState({showRightBox:!1,tabs_array:[],add:!1},function(){e.tableRef.getTableData()}),this.props.setBreadCrumb()}},{key:"addNewAttr",value:function(e){this.setState({showRightBox:!0,add:!0,entityiid:"",statusList:[],defaultActiveKey:"0"})}},{key:"addNewAttrparam",value:function(e){var t=e.record.iid;this.setState({showRightBox:!0,add:!0,entityiid:"",row_id:t,statusList:[]})}},{key:"handleStatusCancel",value:function(){this.setState({visible:!1,entityVisible:!1,varilsForm:{}})}},{key:"cancelModal",value:function(){this.setState({visible:!1,entityVisible:!1,varilsForm:{}})}},{key:"handleOk",value:function(){this.setState({showRightBox:!1}),this.saveRowData(this.props.form.getFieldsValue())}},{key:"handleVisibleChange",value:function(){if(!this.chooseVisible){this.state.SearchFormData.groups.length>0?this.setState({s_visible:!this.state.s_visible}):(0,V.VpAlertMsg)({message:"消息提示",description:"暂无可搜索项，请配置搜索表单！",type:"error",onClose:this.onClose,closeText:"关闭",showIcon:!0},5)}}},{key:"onRowClick",value:function(e,t){var a=this,i=e.iid,n=e.sname,l=e.scode,s=e.ientityid;"7"!=s&&"8"!=s||"pjtree"!=this.state.viewtype||(i=i.substr(0,i.length-1)),"163"==s&&this.sumCount(s,i),"168"==s&&this.sumpoolCount(s,i),this.setState({showRightBox:!0,subItemProjectId:e.iprojectid,add:!1,entityiid:i,row_entityid:s,row_id:i,s_visible:!1,defaultActiveKey:"entity7_generaltab",sname:n,scode:l},function(){a.getDynamicTabs(!0,s,i),a.formevent(s,i,"")}),this.props.setBreadCrumb(n)}},{key:"addNewDom",value:function(){var e=this,t={iid:this.state.entityiid,entityrole:this.state.entityrole};return x["default"].createElement(V.VpTabs,{defaultActiveKey:this.state.defaultActiveKey,destroyInactiveTabPane:!0},this.state.tabs_array.length?this.state.tabs_array.map(function(a,i){if(a.staburl){if("1"==a.ilinktype)return x["default"].createElement(V.VpTabPane,{tab:a.sname,key:a.skey+"tab"},x["default"].createElement(V.VpIframe,{url:a.staburl+"?entityid="+e.state.entityid+"&iid="+e.state.entityiid}));var n=a.staburl.split("?"),l=n[0],s="";n.length>1&&(s=n[1]);if(a.skey!="entity"+e.state.entityid+"_doclist"){var r=(0,R.requireFile)(l);return x["default"].createElement(V.VpTabPane,{tab:a.sname,key:a.skey==undefined?i:a.skey+"tab"},x["default"].createElement(r,{entitytype:e.state.entitytype,eventmap:e.state.eventmap,add:!1,params:t,closeRightModal:function(){return e.closeRightModal()},refreshList:function(){return e.tableRef.getTableData()},entityid:e.state.entityid,iid:e.state.entityiid,irelationid:a.iid,imainentity:a.imainentity,irelationentity:a.irelationentity,row_entityid:e.state.row_entityid,skey:a.skey,row_id:e.state.row_id,viewtype:e.state.viewtype,iaccesslevel:a.iaccesslevel,entityrole:"1"==a.iaccesslevel,stabparam:s,doctype:"3"}))}(0,R.requireFile)(l);return x["default"].createElement(V.VpTabPane,{tab:a.sname,key:a.skey==undefined?i:a.skey+"tab"},x["default"].createElement(F["default"],{doctype:"3",iaccesslevel:a.iaccesslevel,entityrole:"1"==a.iaccesslevel,irelentityid:e.state.row_entityid,irelobjectid:e.state.row_id,mainentityid:"7",mainiid:e.state.subItemProjectId}))}return x["default"].createElement(V.VpTabPane,{tab:a.sname,key:i+"tabs"})}):x["default"].createElement(V.VpTabPane,{tab:"属性",key:"0"},this.state.add?x["default"].createElement(N["default"],{entitytype:this.state.entitytype,eventmap:this.state.eventmap,add:!0,entityrole:!0,closeRightModal:function(){return e.closeRightModal()},refreshList:function(){return e.tableRef.getTableData()},row_id:"",row_entityid:this.state.entityid}):""))}},{key:"handleMenuClick",value:function(e){var t=e.item.props.type;e.key;if(5==t)this.setState({entityVisible:!0});else{(0,V.vpDownLoad)("/{vpplat}/vfrm/ent/exportfile",{quickvalue:this.state.quickvalue,ientityid:this.state.entityid,type:"expdata",viewcode:"expexcel",filtervalue:this.state.filtervalue,currentkey:this.state.currentkey,condition:(0,d["default"])(this.state.searchData)})}}},{key:"handleSubmit",value:function(e){"upload"==e?this.inputUploader.upload.upload():(0,V.vpDownLoad)("/{vpplat}/vfrm/ent/exportfile",{ientityid:this.state.entityid,type:""})}},{key:"render",value:function(){var e=this,t=this,a=this.props.form,i=a.getFieldProps,n=(a.getFieldError,a.isFieldValidating,a.setFields,i("name",{rules:[{required:!0,message:"功能名称不能为空"},{validator:this.userExists}]}),[]);"edit"==this.state.viewtype&&this.state.entityaddrole&&(n=[{title:"新增",tooltip:!1,className:"cursor blue",type:"plus-circle-o",iconClickFunction:this.handleEditAdd},{title:"保存",tooltip:!1,className:"cursor green",type:"save",iconClickFunction:this.handleEditSave},{title:"刷新",tooltip:!1,className:"cursor sky_blue",type:"reload",iconClickFunction:this.handleReload}]);var l=x["default"].createElement(V.VpMenu,{onClick:this.handleMenuClick},t.state.exList.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.iid,type:e.iviewtype},e.sname)})),s=x["default"].createElement("div",{className:"search-form bg-white ant-dropdown-menu"},x["default"].createElement(S["default"],{chooseModalVisible:this.chooseModalVisible,cancelSearch:this.cancelSearch,handleSearchForm:this.handleSearchForm,formData:this.state.SearchFormData})),r=x["default"].createElement(V.VpMenu,{onClick:this.handleNewClick},this.state.entityList.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.entityid},e.sname)})),o=this.state,c=o.viewtype,u=o.entityid;return x["default"].createElement("div",{className:"business-container pr full-height entity"},x["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},x["default"].createElement(V.VpRow,{gutter:10},x["default"].createElement(V.VpCol,{className:"gutter-row",span:4},x["default"].createElement("div",{className:"m-b-sm search"},x["default"].createElement(D.SeachInput,{onSearch:this.handlesearch}))),x["default"].createElement(V.VpCol,{className:"gutter-row text-right",span:20},this.state.entityaddrole?"pjtree"==c?this.state.entityList.length>0?x["default"].createElement(V.VpTooltip,{placement:"top",title:"快速创建"},x["default"].createElement(V.VpDropdown,{trigger:["click"],overlay:r},x["default"].createElement("div",{style:{display:"inline-block"}},x["default"].createElement(V.VpButton,{type:"primary",shape:"circle",icon:"plus",className:"m-l-xs"})))):"":x["default"].createElement("div",{style:{display:"inline-block"},onClick:t.addNewAttr.bind(t)},x["default"].createElement(D.QuickCreate,null)):"",this.state.entityaddrole?x["default"].createElement(V.VpDropdown,{trigger:["click"],overlay:l},x["default"].createElement("div",{style:{display:"inline-block"}},x["default"].createElement(V.VpTooltip,{placement:"top",title:"导入导出"},x["default"].createElement(V.VpButton,{type:"ghost",shape:"circle",className:"m-l-xs"},x["default"].createElement(V.VpIcon,{type:"cloud-upload"}))))):null,t.state.toolbar?t.state.toolbar.hasOwnProperty("left")&&t.state.toolbar.left.advanced?x["default"].createElement(V.VpDropdown,{onClick:this.handleVisibleChange,trigger:["click"],overlay:s,onVisibleChange:this.handleVisibleChange,visible:this.state.s_visible},x["default"].createElement("div",{style:{display:"inline-block"},id:"searchbox"},x["default"].createElement(D.FindCheckbox,null))):"":x["default"].createElement(V.VpDropdown,{onClick:this.handleVisibleChange,trigger:["click"],overlay:s,onVisibleChange:this.handleVisibleChange,visible:this.state.s_visible},x["default"].createElement("div",{style:{display:"inline-block"},id:"searchbox"},x["default"].createElement(D.FindCheckbox,null))),x["default"].createElement("div",{className:"fr m-l-xs"},x["default"].createElement(V.VpRadioGroup,{defaultValue:"list",className:"radio-tab",onChange:this.handleViewChange},"6"==this.state.entityid||"7"==this.state.entityid||"8"==this.state.entityid?x["default"].createElement(V.VpRadioButton,{value:"pjtree"},x["default"].createElement(V.VpTooltip,{placement:"top",title:"树表视图"},x["default"].createElement(V.VpIconFont,{type:"vpicon-file-tree"}))):null,x["default"].createElement(V.VpRadioButton,{value:1==this.state.entityid?"tree":"list"},x["default"].createElement(V.VpTooltip,{placement:"top",title:"列表视图"},x["default"].createElement(V.VpIconFont,{type:"vpicon-navlist"}))),"6"==this.state.entityid?null:x["default"].createElement(V.VpRadioButton,{value:"edit"},x["default"].createElement(V.VpTooltip,{placement:"top",title:"编辑视图"},x["default"].createElement(V.VpIconFont,{type:"vpicon-fenlei"})))))))),x["default"].createElement("div",{className:"business-wrapper p-t-sm full-height",id:"table"},x["default"].createElement("div",{className:"bg-white p-sm entity-list full-height"},x["default"].createElement(V.VpRow,{gutter:16,className:"full-height"},x["default"].createElement(V.VpCol,{span:this.state.shrinkShow?"4":"0",className:"full-height pr menuleft"},x["default"].createElement(V.VpMenu,{className:"full-height scroll-y entity-left-css",onClick:this.handleClick,openKeys:this.state.openKeys,onOpen:this.onToggle,onClose:this.onToggle,selectedKeys:[this.state.filtervalue],mode:"inline"},x["default"].createElement(V.VpSubMenu,{key:"filter",title:x["default"].createElement("span",null,x["default"].createElement(V.VpIconFont,{type:"vpicon-filter",className:"m-r-xs"}),x["default"].createElement("span",null,"过滤器"))},this.state.filters.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.value,className:"menu-text-overflow"},e.name)})),x["default"].createElement(V.VpSubMenu,{key:"status",title:x["default"].createElement("span",null,x["default"].createElement(V.VpIconFont,{type:"vpicon-loading",className:"m-r-xs"}),x["default"].createElement("span",null,"状态"))},this.state.statusFilters.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.value,className:"menu-text-overflow"},e.name)}),x["default"].createElement(V.VpMenuItem,{key:"0"},"全部")),x["default"].createElement(V.VpSubMenu,{key:"class",title:x["default"].createElement("span",null,x["default"].createElement(V.VpIconFont,{type:"vpicon-fenlei",className:"m-r-xs"}),x["default"].createElement("span",null,"类别"))},this.state.classFilters.map(function(e,t){return x["default"].createElement(V.VpMenuItem,{key:e.value,className:"menu-text-overflow"},e.name)}),x["default"].createElement(V.VpMenuItem,{key:"0"},"全部"))),this.state.shrinkShow?x["default"].createElement("div",{className:"navswitch cursor text-center",onClick:this.shrinkLeft},x["default"].createElement(V.VpIconFont,{type:"vpicon-navclose"})):null),x["default"].createElement(V.VpCol,{span:this.state.shrinkShow?"20":"24",className:"full-height scroll-y"},this.state.shrinkShow?null:x["default"].createElement("div",{className:"shrink p-tb-sm cursor text-center",onClick:this.shrinkLeft},x["default"].createElement(V.VpIconFont,{type:"vpicon-navopen"})),x["default"].createElement(V.VpSpin,{spinning:this.state.spinning,size:"large"},this.state.filtervalue!=undefined?x["default"].createElement("div",{id:"vp-entity-drown",className:"edit"==this.state.viewtype?"batch-table":""},x["default"].createElement(D.VpDTable,{loading:this.state.tableloading,ref:function(t){return e.tableRef=t},queryMethod:"POST",onExpand:this.onExpand,expandedRowKeys:this.state.expandedRowKeys,controlAddButton:function(t,a){e.controlAddButton(t,a)},dataUrl:"/{vpplat}/vfrm/entity/dynamicListData",params:{entityid:this.state.entityid,currentkey:this.state.currentkey,condition:(0,d["default"])(this.state.searchData),filtervalue:this.state.filtervalue,quickSearch:this.state.quickvalue,viewtype:"edit"==this.state.viewtype?"initeditlist":this.state.viewtype,datafilter:"auth"},className:"entityTable",expandIconColumnIndex:6==u||7==u||8==u||114==u?1:0,columns:this.state.table_headers,onRowClick:"edit"==this.state.viewtype?null:this.onRowClick,tableOptions:n,bindThis:this,rowKey:"iid",showTotal:"tree"==this.state.viewtype||"pjtree"==this.state.viewtype,resize:!0,scroll:{y:this.state.tableHeight}})):null))))),x["default"].createElement("div",{className:"drawer-fixed p-sm hide"},x["default"].createElement("div",{className:"pr full-height"},x["default"].createElement("div",{className:"spin-icon",onclick:"closeDrawer"},x["default"].createElement(V.VpIcon,{type:"verticle-left"})),x["default"].createElement("div",{className:"drawer-box"}))),x["default"].createElement(D.RightBox,{max:!this.state.isAdd,button:x["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},x["default"].createElement(V.VpTooltip,{placement:"top",title:""},x["default"].createElement(V.VpIcon,{type:"right"}))),tips:x["default"].createElement("div",{className:"tips p-xs"},x["default"].createElement(V.VpTooltip,{placement:"top",title:this.state.sname+"("+this.state.scode+")"+("138"==this.state.entityid?" license导航特别说明：生成导航功能提供统一设置用户数的输入框，默认为10个用户，可自行设置；已存在的导航点击行进入编辑页面支持单独修改每个功能的用户数！":"")},x["default"].createElement(V.VpIcon,{type:"exclamation-circle text-muted m-r-xs"}))),show:this.state.showRightBox},this.state.showRightBox?this.addNewDom():null),x["default"].createElement(V.VpModal,{title:"实体导入",visible:this.state.entityVisible,onCancel:function(){return e.cancelModal()},width:"70%",footer:null,wrapClassName:"modal-no-footer"},this.state.entityVisible?x["default"].createElement("div",{onClick:this.uploadClick},x["default"].createElement(V.VpInputUploader,{form:this.props.form,item:{field_name:"xls",widget_type:"inputupload",field_label:"选择文件",all_line:2,tips:"请选择文件（*.xls,*.xlsx)",auto:!1,widget:{accept:{title:"Xls",extensions:"xlsx,xls"},upload_url:window.vp.config.URL.localHost+"/zuul/{vpplat}/vfrm/ent/importfile?entityid="+this.state.entityid}},ref:function(t){return e.inputUploader=t},onUploadAccept:this.uploadSuccess})):null,x["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},x["default"].createElement(V.VpButton,{type:"primary",onClick:function(){return e.handleSubmit("upload")}},"导入数据"),x["default"].createElement(V.VpButton,{style:{marginLeft:"10px"},type:"primary",onClick:function(){return e.handleSubmit("download")}},"下载模板"))),x["default"].createElement(V.VpModal,{title:"选择附件",visible:this.state.VpUploader,onOk:this.handleFileCancel,onCancel:this.handleFileCancel,width:"70%",height:"80%",wrapClassName:"modal-no-footer dynamic-modal"},this.state.VpUploader?x["default"].createElement(V.VpUploader,{server:"/zuul/{vpplat}/file/uploadfile",onUploadAccept:this.onUploadAccept,fileTypes:this.state.doctypelist,selectType:this.state.selectType}):null))}}]),t}(E.Component);t["default"]=_=(0,V.VpFormCreate)(_)},975:function(e,t,a){var i=a(976);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(439)(i,n);i.locals&&(e.exports=i.locals)},976:function(e,t){}});