webpackJsonp([31],{1043:function(e,t,a){var l=a(1044);"string"==typeof l&&(l=[[e.id,l,""]]);var i={hmr:!0};i.transform=void 0;a(439)(l,i);l.locals&&(e.exports=l.locals)},1044:function(e,t){},1045:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}function i(){return[{title:"流程名称",dataIndex:"sname",key:"sname",width:100},{title:"版本号",dataIndex:"iversion",key:"iversion",width:100}]}Object.defineProperty(t,"__esModule",{value:!0});var s=a(363),n=l(s),o=a(802),r=l(o),c=a(688),d=l(c),p=a(54),u=l(p),f=a(55),m=l(f),h=a(59),y=l(h),v=a(93),g=l(v),b=a(8),w=l(b),C=a(4),E=a(652),x=a(567);a(1043);var S=function(e){function t(e){(0,u["default"])(this,t);var a=(0,y["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));return a.addExaevalTabs=function(){window.app.addTabs("exaeval","考核评价","/exaeval")},a.getHeader=function(){var e=a,t={listType:"exaevalBat"};(0,C.vpAdd)("/{vpplat}/exaeval/getListHeader",{sparam:(0,r["default"])(t)}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];t.data.grid.hasOwnProperty("fields")&&(t.data.grid.fields.map(function(e,t){var l=void 0,i=void 0,s=void 0,n=void 0;for(var o in e)"field_label"==o?l=e[o]:"field_name"==o&&(i=e[o]),"fixed"==o&&(n=e[o]),"field_width"==o&&(s=e[o]);l&&i&&("left"==n||"right"==n?a.push({title:l,dataIndex:i,key:i,width:s,fixed:n}):a.push({title:l,dataIndex:i,key:i,fixed:n}))}),a.push({title:"操作",fixed:"right",width:140,key:"operation",render:function(t,a){return w["default"].createElement("span",null,w["default"].createElement(x.Link,{to:{pathname:"/exaeval/list/"+a.iid+"/98/-1",state:{address:"pages/vfm/dynamic/VpExaeval/exaeval",currentkey:"sub1"}},"data-key":"gotoExaeval",className:"block ant-col-24",onClick:e.addExaevalTabs},w["default"].createElement(C.VpTooltip,{placement:"top",title:"查看详情"},w["default"].createElement(C.VpIconFont,{className:"text-primary m-lr-xs cursor",type:"vpicon-tip"}))))}}),e.setState({table_headers:a}))}})["catch"](function(e){})},a.getData=function(){var e=a,t={listType:"exaevalBat",quicktext:a.state.quicktext,curr:a.state.cur_page,limit:a.state.num_perpage};(0,C.vpAdd)("/{vpplat}/exaeval/getListData",{sparam:(0,r["default"])(t)}).then(function(t){var a=t.data,l=function(){return"共"+a.totalRows+"条"},i=vp.computedHeight(a.totalRows,".dataTable");e.setState({tableHeight:i,table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{total:a.totalRows,showTotal:l,pageSize:a.numPerPage,onShowSizeChange:e.onShowSizeChange,showSizeChanger:!0,showQuickJumper:!0}})})["catch"](function(e){"function"!=typeof e||e()})},a.getBatList=function(){var e=a,t={listType:"unBatList"};(0,C.vpAdd)("/{vpplat}/exaeval/getListData",{sparam:(0,r["default"])(t)}).then(function(t){if(t.data.data){var a=t.data.data;e.setState({batTemplate:a,ibatid:""},function(){e.handleBatChange("",e.state.fyear)})}})["catch"](function(e){"function"!=typeof e||e()})},a.handleBatChange=function(e,t){var l=[],i="";a.setState({options:l,ibatid:"",snameValue:i,fyear:"",yearDisabled:!1},function(){var s=!1;""==e?(a.setState({fyear:t}),l=a.state.batTemplate.map(function(e){return w["default"].createElement(C.VpOption,{key:e.sname},e.sname)}),s=!0):(i=e,a.state.batTemplate.map(function(t){if(-1!=t.sname.indexOf(e)){s=!0;var a=w["default"].createElement(C.VpOption,{key:t.sname},t.sname);l.push(a)}})),s?a.setState({options:l,snameValue:i}):(i=e,a.setState({options:l,snameValue:i}))})},a.selectBat=function(e,t){var l=[],i="",s="",n=!1;a.setState({options:l,ibatid:i,snameValue:"",fyear:s,yearDisabled:n},function(){var t=!1;a.state.batTemplate.map(function(a){if(e==a.sname){i=a.iid,s=a.fyear,n=!0,t=!0;var o=w["default"].createElement(C.VpOption,{key:a.sname},a.sname);l.push(o)}}),t&&a.setState({options:l,ibatid:i,snameValue:"",fyear:s,yearDisabled:n})})},a.getYearList=function(){for(var e=(0,C.vpFormatDate)(new Date,"YYYY"),t=[],l=0;l<5;l++)t.push({value:parseInt(e)-l,label:parseInt(e)-l});a.setState({yearTemplate:t,fyear:e})},a.handleYearChange=function(e){a.setState({fyear:e})},a.getEaxevalClassList=function(){var e=a,t={listType:"eaxevalClass"};(0,C.vpAdd)("/{vpplat}/exaeval/getListData",{sparam:(0,r["default"])(t)}).then(function(t){t.data.data&&e.setState({eaxevalClassTemplate:t.data.data,flowtype:t.data.flowtype})})["catch"](function(e){"function"!=typeof e||e()})},a.handleEaxevalClassChange=function(e){a.setState({ieaxevalClassid:e})},a.getEntityList=function(){var e=a,t={listType:"entity",conditon:"bat"};(0,C.vpAdd)("/{vpplat}/exaeval/getListData",{sparam:(0,r["default"])(t)}).then(function(t){t.data.data&&e.setState({entityTemplate:t.data.data})})["catch"](function(e){"function"!=typeof e||e()})},a.handleEntityChange=function(e){var t=!0;e>0&&(t=!1),a.setState({ientityid:e,classDisabled:t,iclassid:0,classTemplate:[],libraryDisabled:!0},function(){a.getClassList()})},a.getClassList=function(){var e=a,t={listType:"allclass",ientityid:a.state.ientityid};(0,C.vpAdd)("/{vpplat}/exaeval/getListData",{sparam:(0,r["default"])(t)}).then(function(t){t.data.data&&e.setState({classTemplate:t.data.data,iclassid:0})})["catch"](function(e){"function"!=typeof e||e()})},a.handleClassChange=function(e){var t=!0;e>0&&(t=!1),a.setState({iclassid:e,libraryDisabled:t,ilibraryid:0,libraryTemplate:[]},function(){a.getLibraryList()})},a.getLibraryList=function(){var e=a,t={listType:"quotaLibraryList",iclassid:a.state.iclassid};(0,C.vpAdd)("/{vpplat}/exaeval/getExaevalSetDetailList",{sparam:(0,r["default"])(t)}).then(function(t){var a=0,l=t.data.data;l.map(function(e){"1"==e.idefault&&(a=e.iid)}),e.setState({libraryTemplate:l,ilibraryid:a})})},a.handleLibraryChange=function(e){a.setState({ilibraryid:e})},a.quickSearch=function(e){var t=e.replace(/\s/g,"");a.setState({quicktext:t},function(){a.getData()})},a.startExaeval=function(){var e={ibatid:a.state.ibatid,snameValue:a.state.snameValue,fyear:a.state.fyear,ieaxevalClassid:a.state.ieaxevalClassid,ientityid:a.state.ientityid,iclassid:a.state.iclassid,ilibraryid:a.state.ilibraryid,iflowid:a.state.iflowid};""==e.ibatid&&""==e.snameValue?(0,C.VpAlertMsg)({message:"消息提示",description:"请输入或选择考核批次！",type:"error",closeText:"关闭",showIcon:!0},5):0==e.fyear?(0,C.VpAlertMsg)({message:"消息提示",description:"请选择考核年份！",type:"error",closeText:"关闭",showIcon:!0},5):0==e.ieaxevalClassid?(0,C.VpAlertMsg)({message:"消息提示",description:"请选择考核类型！",type:"error",closeText:"关闭",showIcon:!0},5):0==e.ientityid?(0,C.VpAlertMsg)({message:"消息提示",description:"请选择考核对象！",type:"error",closeText:"关闭",showIcon:!0},5):0==e.iclassid?(0,C.VpAlertMsg)({message:"消息提示",description:"请选择考核对象类别！",type:"error",closeText:"关闭",showIcon:!0},5):0==e.ilibraryid?(0,C.VpAlertMsg)({message:"消息提示",description:"请选择指标库！",type:"error",closeText:"关闭",showIcon:!0},5):3==a.state.flowtype?(0,C.vpQuery)("/{vpplat}/exaeval/flowlist",{ientityid:98,iclassid:a.state.ieaxevalClassid}).then(function(t){var l=t.data;1==l.length?(e.iflowid=l[0].iid,a.saveData(e)):0==l.length?(0,C.VpAlertMsg)({message:"消息提示",description:"暂无可发起的流程！",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5):a.setState({flowArray:l,modalvisible:!0,selectFlowid:0,formData:e})}):a.saveData(e)},a.saveData=function(e){var t=a;(0,C.vpAdd)("/{vpplat}/exaeval/saveBatData",e).then(function(e){e.data.success?((0,C.VpAlertMsg)({message:"操作提示",description:e.data.msg,type:"success",closeText:"关闭",showIcon:!0},10),t.setState({ientityid:0,iclassid:0,ieaxevalClassid:0,snameValue:"",ibatid:"",fyear:"",ilibraryid:0,yearDisabled:!1,entityDisabled:!1,classDisabled:!1,modalvisible:!1,flowArray:[],formData:{},selectFlowid:0},function(){t.cancelModal(),t.getData()})):((0,C.VpAlertMsg)({message:"操作提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},10),t.setState({visible:!1,ientityid:0,iclassid:0,ieaxevalClassid:0,snameValue:"",ibatid:"",fyear:"",ilibraryid:0,yearDisabled:!1,entityDisabled:!1,classDisabled:!1,modalvisible:!1,flowArray:[],formData:{},selectFlowid:0},function(){t.getData()}))})},a.okflowModal=function(){if(0==a.state.selectFlowid)return void(0,C.VpAlertMsg)({message:"消息提示",description:"请选择相关流程！",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5);var e=a.state.formData;e.iflowid=a.state.selectFlowid,a.saveData(e)},a.cancelflowModal=function(){a.setState({modalvisible:!1,flowArray:[],formData:{},selectFlowid:0})},a.handleFlowSelect=function(e,t,l){t&&a.setState({selectItem:[e],selectFlowid:[e.iid]})},a.onSelectFlowChange=function(e){a.setState({selectFlowid:e})},a.onFlowRowClick=function(e){a.setState({selectItem:[e],selectFlowid:[e.iid]})},a.onFlowRowDoubleClick=function(e,t){var l=a.state.formData;l.iflowid=e.iid,a.saveData(l)},a.state={filters:[],table_headers:[],table_array:[],cur_page:1,num_perpage:10,pagination:{},formData:[],visible:!1,modaltitle:"",listtitle:"",selectiid:"",selectItem:[],selectedRowKeys:[],selectRowArr:[],tableHeight:"",batTemplate:[],ibatid:"",batDisabled:!1,yearTemplate:[],fyear:0,eaxevalClassDisabled:!1,eaxevalClassTemplate:[],ieaxevalClassid:0,yearDisabled:!1,entityTemplate:[],ientityid:0,entityDisabled:!1,classTemplate:[],iclassid:0,classDisabled:!0,libraryTemplate:[],ilibraryid:0,libraryDisabled:!0,snameValue:"",options:[],iflowid:0,flowtype:1,flowArray:[],flowHeader:[],selectFlowid:0,modalvisible:!1},a.tableChange=a.tableChange.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.cancelModal=a.cancelModal.bind(a),a.onExpand=a.onExpand.bind(a),a.toolBarClick=a.toolBarClick.bind(a),a.onRowClick=a.onRowClick.bind(a),a.handleSelect=a.handleSelect.bind(a),a.handleSelectAll=a.handleSelectAll.bind(a),a.onSelectChange=a.onSelectChange.bind(a),a}return(0,g["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){this.getHeader(),this.getData(),this.setState({flowHeader:i()})}},{key:"componentDidMount",value:function(){var e=vp.computedHeight(this.state.table_array.length,".dataTable");this.setState({tableHeight:e})}},{key:"onShowSizeChange",value:function(e){}},{key:"tableChange",value:function(e,t,a){var l=this;this.setState({cur_page:e.current||this.state.cur_page,num_perpage:e.pageSize||this.state.num_perpage},function(){l.getData()})}},{key:"cancelModal",value:function(){this.setState({visible:!1,ientityid:0,entityTemplate:[],entityDisabled:!1,iclassid:0,classTemplate:[],classDisabled:!1})}},{key:"toolBarClick",value:function(e){var t=this;"add"==e?this.setState({modaltitle:"批量考核",iid:0,ibatid:"",snameValue:"",ieaxevalClassid:0,ientityid:0,iclassid:0,ilibraryid:0,yearDisabled:!1,eaxevalClassDisabled:!1,classDisabled:!0,libraryDisabled:!0,visible:!0,iflowid:0,flowtype:1,formData:{}},function(){t.getYearList(),t.getBatList(),t.getEaxevalClassList(),t.getEntityList()}):"del"==e&&(this.state.selectedRowKeys.length?(0,C.vpAdd)("/{vpplat}/exaeval/deleteBat",{iids:this.state.selectedRowKeys.join()}).then(function(e){t.getData()}):(0,C.VpAlertMsg)({message:"消息提示",description:"请选择需要删除的数据！",type:"info",closeText:"关闭",showIcon:!0},5))}},{key:"onRowClick",value:function(e){}},{key:"handleSelect",value:function(e,t,a){var l=0;t?this.setState({selectedRowKeys:[].concat((0,n["default"])(this.state.selectedRowKeys),[e.iid])}):(this.state.selectedRowKeys.forEach(function(t,a){t===e.iid&&(l=a)}),this.setState({selectedRowKeys:[].concat((0,n["default"])(this.state.selectedRowKeys.slice(0,l)),(0,n["default"])(this.state.selectedRowKeys.slice(l+1)))}))}},{key:"onSelectChange",value:function(e){this.setState({selectedRowKeys:e})}},{key:"handleSelectAll",value:function(e,t,a){this.setState({selectItem:t})}},{key:"onExpand",value:function(e,t){}},{key:"render",value:function(){var e=this,t=this.state.selectedRowKeys,a={type:"checkbox",selectedRowKeys:t,onSelect:this.handleSelect,onSelectAll:this.handleSelectAll,onChange:this.onSelectChange},l={type:"radio",selectedRowKeys:this.state.selectFlowid,onSelect:this.handleFlowSelect,onChange:this.onSelectFlowChange};return w["default"].createElement("div",{className:"business-container pr full-height"},w["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},w["default"].createElement(C.VpRow,{gutter:1},w["default"].createElement(C.VpCol,{className:"gutter-row text-right",span:4},w["default"].createElement(E.SeachInput,{onSearch:this.quickSearch,placeholder:"输入名称或年份查找"})),w["default"].createElement(C.VpCol,{className:"gutter-row text-right",span:20},w["default"].createElement(C.VpTooltip,{placement:"top",title:"添加"},w["default"].createElement(C.VpButton,{type:"primary",style:{margin:"0 3px"},shape:"circle",icon:"plus",onClick:function(){return e.toolBarClick("add")}})),w["default"].createElement(C.VpTooltip,{placement:"top",title:"删除"},w["default"].createElement(C.VpPopconfirm,{placement:"bottomLeft",title:"确认删除所选记录?",onConfirm:function(){return e.toolBarClick("del")},onCancel:this.cancel},w["default"].createElement(C.VpButton,{type:"ghost",style:{margin:"0 3px"},shape:"circle",icon:"cross"})))))),w["default"].createElement("div",{className:"business-wrapper p-t-sm full-height overflow"},w["default"].createElement("div",{className:"p-sm bg-white full-height scroll-y"},w["default"].createElement(C.VpTable,{className:"dataTable",onExpand:this.onExpand,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,rowSelection:a,rowKey:function(e){return e.iid},resize:!0,scroll:{y:this.state.tableHeight}}))),w["default"].createElement(C.VpModal,{title:this.state.modaltitle,visible:this.state.visible,onOk:function(){return e.cancelModal()},onCancel:function(){return e.cancelModal()},width:"60%",height:"100%",maskClosable:!1,footer:null,wrapClassName:"modal-no-footer"},this.state.visible?w["default"].createElement("div",{className:"business-container scroll full-height exaevalbat"},w["default"].createElement("div",{className:"baseDiv",key:"baseDiv"},w["default"].createElement(C.VpForm,null,w["default"].createElement(C.VpRow,null,w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"考核批次:")),w["default"].createElement(C.VpCol,{span:19},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,combobox:!0,value:this.state.snameValue,onChange:this.handleBatChange,onSelect:this.selectBat,optionFilterProp:"children",disabled:this.state.batDisabled,placeholder:"请输入或选择考核批次"},this.state.options))),w["default"].createElement(C.VpRow,{style:{marginTop:25}},w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"考核年份:")),w["default"].createElement(C.VpCol,{span:19},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,value:this.state.fyear,onChange:this.handleYearChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.yearDisabled},w["default"].createElement(C.VpOption,{value:0},"请选择考核年份"),this.state.yearTemplate.map(function(e,t){return w["default"].createElement(C.VpOption,{key:"fyear"+t,value:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")})))),w["default"].createElement(C.VpRow,{style:{marginTop:25}},w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"考核类型:")),w["default"].createElement(C.VpCol,{span:19},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,value:this.state.ieaxevalClassid,onChange:this.handleEaxevalClassChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.eaxevalClassDisabled},w["default"].createElement(C.VpOption,{value:0},"请选择考核类型"),this.state.eaxevalClassTemplate.map(function(e,t){return w["default"].createElement(C.VpOption,{key:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")})))),w["default"].createElement(C.VpRow,{style:{marginTop:25}},w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"考核对象:")),w["default"].createElement(C.VpCol,{className:"gutter-row",span:19,id:"entityCol"},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,value:this.state.ientityid,onChange:this.handleEntityChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.entityDisabled,getPopupContainer:function(){return document.getElementById("entityCol")}},w["default"].createElement(C.VpOption,{value:0},"请选择考核对象"),this.state.entityTemplate.map(function(e,t){return w["default"].createElement(C.VpOption,{key:"entity"+t,value:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")})))),w["default"].createElement(C.VpRow,{style:{marginTop:25}},w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"对象类别:")),w["default"].createElement(C.VpCol,{span:19},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,value:this.state.iclassid,onChange:this.handleClassChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.classDisabled},w["default"].createElement(C.VpOption,{value:0},"请选择考核对象类别"),this.state.classTemplate.map(function(e,t){return w["default"].createElement(C.VpOption,{key:"class"+t,value:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")})))),w["default"].createElement(C.VpRow,{style:{marginTop:25}},w["default"].createElement(C.VpCol,{span:3,className:"text-right p-lr-sm"},w["default"].createElement("h4",{className:"ant-form-item-required color-black"},"指标库:")),w["default"].createElement(C.VpCol,{span:19},w["default"].createElement(C.VpSelect,{size:"large",style:{marginTop:-4},showSearch:!0,value:this.state.ilibraryid,onChange:this.handleLibraryChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.libraryDisabled},w["default"].createElement(C.VpOption,{value:0},"请选择指标库"),this.state.libraryTemplate.map(function(e,t){return w["default"].createElement(C.VpOption,{key:"quotalibrary"+t,value:e.hasOwnProperty("iid")?e.iid:""},e.hasOwnProperty("sname")?e.sname:"")})))))),w["default"].createElement("div",{className:"bg-white p-sm",style:{marginTop:25}}),w["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{position:"absolute"}},w["default"].createElement(C.VpButton,{key:"saveBat",type:"primary",size:"large",onClick:function(){return e.startExaeval()}},"发起考核"))):""),w["default"].createElement(C.VpModal,{title:"发起流程",visible:this.state.modalvisible,onOk:function(){return e.okflowModal()},onCancel:function(){return e.cancelflowModal()},width:"70%"},w["default"].createElement(C.VpTable,{className:"flowTable",onExpand:this.onExpand,columns:this.state.flowHeader,dataSource:this.state.flowArray,onChange:this.tableChange,onRowClick:this.onFlowRowClick,onDoubleClick:this.onFlowRowDoubleClick,rowSelection:l,rowKey:function(e){return e.iid},resize:!0})))}}]),t}(b.Component);t["default"]=S=(0,C.VpFormCreate)(S)}});