webpackJsonp([20],{1018:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(363),l=i(s),n=a(802),c=i(n),o=a(688),r=i(o),d=a(54),u=i(d),f=a(55),p=i(f),h=a(59),m=i(h),g=a(93),y=i(g),v=a(8),b=i(v),w=a(4),k=a(1019),C=i(k),S=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.systemRole=function(){var e=a;(0,w.vpQuery)("/{vpplat}/api/pur/point",{saccesskey:"system"}).then(function(t){var a=!0;t.data.system>0&&(a=!1),e.setState({disabled:a})})},a.getHeader=function(){var e=a,t={listType:"statusProcess",quicktext:a.state.quicktext};(0,w.vpAdd)("/{vpplat}/status/process/getListHeader",{sparam:(0,c["default"])(t)}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];t.data.grid.hasOwnProperty("fields")&&(t.data.grid.fields.map(function(e,t){var i=void 0,s=void 0,l=void 0,n=void 0;for(var c in e)"field_label"==c?i=e[c]:"field_name"==c&&(s=e[c]),"fixed"==c&&(n=e[c]),"field_width"==c&&(l=e[c]);i&&s&&("left"==n||"right"==n?a.push({title:i,dataIndex:s,key:s,width:l,fixed:n}):a.push({title:i,dataIndex:s,key:s,fixed:n}))}),e.setState({table_headers:a}))}})["catch"](function(e){})},a.getData=function(){var e=a,t={listType:"statusProcess",quicktext:a.state.quicktext,curr:a.state.cur_page,limit:a.state.num_perpage};(0,w.vpAdd)("/{vpplat}/status/process/getListData",{sparam:(0,c["default"])(t)}).then(function(t){var a=t.data,i=function(){return"共"+a.totalRows+"条"},s=vp.computedHeight(a.totalRows,".navTable");e.setState({tableHeight:s,table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{total:a.totalRows,showTotal:i,pageSize:a.numPerPage,onShowSizeChange:e.onShowSizeChange,showSizeChanger:!0,showQuickJumper:!0}})})["catch"](function(e){"function"!=typeof e||e()})},a.getEntityList=function(){var e=a,t={listType:"entity"};(0,w.vpAdd)("/{vpplat}/status/process/getListData",{sparam:(0,c["default"])(t)}).then(function(t){t.data.data&&e.setState({entityTemplate:[{label:"任务",value:"114"}]})})["catch"](function(e){"function"!=typeof e||e()})},a.handleEntityChange=function(e){a.setState({ientityid:e,istatusid:0,statusTemplate:[]},function(){a.getStatusList()})},a.getStatusList=function(){var e=a,t={listType:"status",ientityid:a.state.ientityid};(0,w.vpAdd)("/{vpplat}/status/process/getListData",{sparam:(0,c["default"])(t)}).then(function(t){t.data.data&&e.setState({statusTemplate:t.data.data,istatusid:0})})["catch"](function(e){"function"!=typeof e||e()})},a.handleStatusChange=function(e){a.setState({istatusid:e})},a.loadFunctionList=function(e){var t=a,i={listType:"processList",iid:e};(0,w.vpAdd)("/{vpplat}/status/process/getFunctionList",{sparam:(0,c["default"])(i)}).then(function(e){var a=[],i="0";e.data.data.map(function(e){a.push({itabid:e.itabid,iaccesslevel:e.iaccesslevel}),"1"==e.idefault&&(i=e.itabid)}),t.setState({functionList:e.data.data,iaccessArr:a,checkDefaultId:i},function(){$("#moveArea").sortable({update:function(e,t){$("#moveArea").sortable("toArray").shift()}})})})},a.onChangeDefault=function(e,t){e[0]||!e[0]&&e.length>1?a.setState({checkDefaultId:t}):a.setState({checkDefaultId:"0"})},a.onChangeWrite=function(e,t){var i=a.state.iaccessArr,s={itabid:0,iaccesslevel:"0"};s=e[0]||!e[0]&&e.length>1?{itabid:t,iaccesslevel:"1"}:{itabid:t,iaccesslevel:"0"};var l=!1;i.map(function(e){e.itabid==s.itabid&&(l=!0,e.iaccesslevel=s.iaccesslevel)}),l||i.push(s);for(var n=a.state.functionList,c=0;c<n.length;c++)n[c].iid==s.itabid&&(n[c].iaccesslevel=s.iaccesslevel);a.setState({functionList:n,iaccessArr:i},function(){})},a.onChangeRead=function(e,t){var i=a.state.iaccessArr,s={itabid:0,iaccesslevel:"0"};s=e[0]||!e[0]&&e.length>1?{itabid:t,iaccesslevel:"0"}:{itabid:t,iaccesslevel:""};var l=!1;i.map(function(e){e.itabid==s.itabid&&(l=!0,e.iaccesslevel=s.iaccesslevel)}),l||i.push(s);for(var n=a.state.functionList,c=0;c<n.length;c++)n[c].iid==s.itabid&&(n[c].iaccesslevel=s.iaccesslevel);a.setState({functionList:n,iaccessArr:i},function(){})},a.saveBat=function(){var e=a,t={iid:a.state.iid,ientityid:a.state.ientityid,istatusid:a.state.istatusid};if(0==t.ientityid)(0,w.VpAlertMsg)({message:"消息提示",description:"请选择实体！",type:"error",closeText:"关闭",showIcon:!0},5);else if(0==t.istatusid)(0,w.VpAlertMsg)({message:"消息提示",description:"请选择实体状态！",type:"error",closeText:"关闭",showIcon:!0},5);else{var i=[],s={},l=0,n=!0;$("#moveArea").find(".rowdiv").each(function(t,a){l=$(a).attr("data-id");var c={};if(e.state.functionList.map(function(e){if(e.iid==l)return c=e,!1}),s={iid:c.subiid,ifuncid:c.iparent,irelentity:c.ientityid,itabid:c.iid,itabtype:c.isleaf,sname:$("#name"+l).val().replace(/\s/g,""),iindex:t,checkDefaultId:e.state.checkDefaultId,iflag:0},""==s.sname)return n=!1,(0,w.VpAlertMsg)({message:"消息提示",description:"第"+(t+1)+"行，显示名称不能为空！",type:"error",closeText:"关闭",showIcon:!0},5),!1;for(var o=e.state.iaccessArr,r=0;r<o.length;r++)if(o[r].itabid==s.itabid){s.iaccesslevel=o[r].iaccesslevel;break}i.push(s)}),n&&(t["function"]=i,(0,w.vpAdd)("/{vpplat}/status/process/save",{sparam:(0,c["default"])(t)}).then(function(t){e.setState({ientityid:0,istatusid:0,entityDisabled:!1,statusDisabled:!1,visible:!1,iaccessArr:[],functionList:[]},function(){e.getData()})}))}},a.delSelected=function(){var e=[],t={},i=0;a.state.functionList.map(function(s,l){i=s.iid;for(var n=a.state.selectRowArr,c=!1,o=0;o<n.length;o++)if(n[o]==i){c=!0;break}if(!c){t=s,t.displayname=$("#name"+i).val().replace(/\s/g,""),t.iindex=l;for(var r=a.state.iaccessArr,d=0;d<r.length;d++)if(r[d].itabid==t.itabid){t.iaccesslevel=r[d].iaccesslevel;break}e.push(t)}}),a.setState({functionList:e,selectRowArr:[]})},a.btnOptClick=function(e){"saveBat"==e?a.saveBat():"addFun"==e?a.setState({showlist:!0,listtitle:"可选功能列表"}):"delFun"==e?a.delSelected():"delAll"==e&&a.setState({functionList:[]})},a.okListModal=function(e){var t=a.state.functionList,i=0;e.map(function(e){-1==(i=t.findIndex(function(t){return e.iid==="p"+t.iid||e.iid===t.iid}))&&e.isleaf<=0&&t.push(e)}),a.setState({functionList:t,showlist:!1},function(){})},a.cancelListModal=function(){a.setState({showlist:!1,listtitle:""})},a.state={filters:[],showRightBox:!1,table_headers:[],table_array:[],cur_page:1,num_perpage:10,pagination:{},formdata:[],visible:!1,showlist:!1,modaltitle:"",listtitle:"",selectiid:"",selectItem:[],selectedRowKeys:[],iflagValue:0,snameValue:"",surlValue:"",siconValue:"",functionList:[],selectRowArr:[],iflagArr:[],tableHeight:"",entityTemplate:[],ientityid:0,statusTemplate:[],istatusid:0,checkDefaultId:"0",entityDisabled:!1,statusDisabled:!1,iaccessArr:[],disabled:!0},a.tableChange=a.tableChange.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.cancelModal=a.cancelModal.bind(a),a.onExpand=a.onExpand.bind(a),a.toolBarClick=a.toolBarClick.bind(a),a.onRowClick=a.onRowClick.bind(a),a.handleSelect=a.handleSelect.bind(a),a.handleSelectAll=a.handleSelectAll.bind(a),a.onSelectChange=a.onSelectChange.bind(a),a}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.setState({pageType:0,entityid:this.props.entityid,iid:this.props.iid},function(){e.getHeader(),e.getData()})}},{key:"componentDidMount",value:function(){var e=vp.computedHeight(this.state.table_array.length,".navTable");this.setState({tableHeight:e}),this.systemRole()}},{key:"onShowSizeChange",value:function(e){}},{key:"tableChange",value:function(e,t,a){var i=this;this.setState({cur_page:e.current||this.state.cur_page,num_perpage:e.pageSize||this.state.num_perpage},function(){i.getData()})}},{key:"cancelModal",value:function(){this.setState({visible:!1,functionList:[],ientityid:0,entityTemplate:[],entityDisabled:!1,istatusid:0,statusTemplate:[],statusDisabled:!1})}},{key:"toolBarClick",value:function(e){var t=this;"add"==e?this.setState({modaltitle:"新建",iid:0,ientityid:0,istatusid:0,visible:!0,functionList:[]},function(){t.getEntityList(),$("#moveArea").sortable({update:function(e,t){$("#moveArea").sortable("toArray").shift()}})}):"del"==e&&(this.state.selectedRowKeys.length?(0,w.vpAdd)("/{vpplat}/status/process/delete",{sparam:(0,c["default"])({iid:this.state.selectedRowKeys.join()})}).then(function(e){t.getData()}):(0,w.VpAlertMsg)({message:"消息提示",description:"请选择需要删除的数据！",type:"info",closeText:"关闭",showIcon:!0},5))}},{key:"onRowClick",value:function(e){var t=this;this.setState({modaltitle:"编辑>["+e.sentityname+"]"+e.sstatusname,visible:!0,iid:e.iid,ientityid:e.ientityid,entityTemplate:[{value:e.ientityid,label:e.sentityname}],entityDisabled:!0,istatusid:e.istatusid,statusTemplate:[{value:e.istatusid,label:e.sstatusname}],statusDisabled:!0},function(){t.loadFunctionList(e.istatusid)})}},{key:"handleSelect",value:function(e,t,a){var i=0;t?this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys),[e.iid])}):(this.state.selectedRowKeys.forEach(function(t,a){t===e.iid&&(i=a)}),this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys.slice(0,i)),(0,l["default"])(this.state.selectedRowKeys.slice(i+1)))}))}},{key:"onSelectChange",value:function(e){this.setState({selectedRowKeys:e})}},{key:"handleSelectAll",value:function(e,t,a){this.setState({selectItem:t})}},{key:"onExpand",value:function(e,t){}},{key:"selectRow",value:function(e){if(!($(e.target).closest(".writeCol").length+$(e.target).closest(".readCol").length+$(e.target).closest(".defaultCol").length+$(e.target).closest(".displayCol").length>0)){var t=$(e.target).closest(".rowdiv"),a=this.state.selectRowArr,i=$(t).attr("data-id"),s=$.inArray(i,a),l=!0,n=$(e.target).attr("id");n==undefined||0!=n.indexOf("iflag")&&0!=n.indexOf("name")&&0!=n.indexOf("sicon")||(l=!1),l&&(s>=0?(a.splice(s,1),$(t).find(".rowitem").css("background-color","#ffffff"),$(t).find("input").css("background-color","#ffffff")):(a.push(i),$(t).find(".rowitem").css("background-color","#e8e8e8f5"),$(t).find("input").css("background-color","#e8e8e8f5")),this.setState({selectRowArr:a}))}}},{key:"quickSearch",value:function(){var e=this,t=$("#quicktext").val();this.setState({quicktext:t},function(){e.getData()})}},{key:"render",value:function(){var e=this,t=this.state.selectedRowKeys,a={type:"checkbox",selectedRowKeys:t,onSelect:this.handleSelect,onSelectAll:this.handleSelectAll,onChange:this.onSelectChange};return b["default"].createElement("div",{className:"business-container pr full-height"},b["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},b["default"].createElement(w.VpRow,{gutter:1},b["default"].createElement(w.VpCol,{className:"gutter-row text-right",span:4},b["default"].createElement(w.VpInput,{id:"quicktext",placeholder:"输入名称查找",suffix:b["default"].createElement(w.VpIcon,{type:"search",style:{marginTop:7},onClick:function(){e.quickSearch()}}),onPressEnter:function(){e.quickSearch()}})),this.state.disabled?null:b["default"].createElement(w.VpCol,{className:"gutter-row text-right",span:20},b["default"].createElement(w.VpTooltip,{placement:"top",title:"添加"},b["default"].createElement(w.VpButton,{type:"primary",style:{margin:"0 3px"},shape:"circle",icon:"plus",onClick:function(){return e.toolBarClick("add")}})),b["default"].createElement(w.VpTooltip,{placement:"top",title:"删除"},b["default"].createElement(w.VpPopconfirm,{placement:"bottomLeft",title:"确认删除所选记录?",onConfirm:function(){return e.toolBarClick("del")},onCancel:this.cancel},b["default"].createElement(w.VpButton,{type:"ghost",style:{margin:"0 3px"},shape:"circle",icon:"cross"})))))),b["default"].createElement("div",{className:"business-wrapper p-t-sm full-height overflow"},b["default"].createElement("div",{className:"p-sm bg-white full-height scroll-y"},b["default"].createElement(w.VpTable,{className:"navTable",onExpand:this.onExpand,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,rowSelection:a,rowKey:function(e){return e.iid},resize:!0,scroll:{y:this.state.tableHeight}}))),b["default"].createElement(w.VpModal,{title:this.state.modaltitle,visible:this.state.visible,onOk:function(){return e.cancelModal()},onCancel:function(){return e.cancelModal()},width:"80%",height:"120%",style:{top:"5%"},maskClosable:!1,footer:null,wrapClassName:"modal-no-footer"},this.state.visible?b["default"].createElement("div",{className:"business-container scroll full-height"},b["default"].createElement("div",{className:"bg-white p-sm"},b["default"].createElement("h4",{className:"p-b-sm fw b-b",style:{marginTop:-40}},"基本信息")),b["default"].createElement("div",{className:"baseDiv",key:"baseDiv"},b["default"].createElement(w.VpForm,{horizontal:!0},b["default"].createElement(w.VpRow,null,b["default"].createElement(w.VpCol,{span:2,className:"text-right p-lr-sm"},b["default"].createElement("h4",{className:"ant-form-item-required"},"实体:")),b["default"].createElement(w.VpCol,{className:"gutter-row",span:9},b["default"].createElement(w.VpSelect,{showSearch:!0,defaultValue:this.state.ientityid,onChange:this.handleEntityChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.entityDisabled},b["default"].createElement(w.VpOption,{value:0},"请选择实体"),this.state.entityTemplate.map(function(e,t){return b["default"].createElement(w.VpOption,{key:"entity"+t,value:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")}))),b["default"].createElement(w.VpCol,{span:2,className:"text-right p-lr-sm"},b["default"].createElement("h4",{className:"ant-form-item-required"},"状态:")),b["default"].createElement(w.VpCol,{key:"surl",span:9},b["default"].createElement(w.VpSelect,{showSearch:!0,value:this.state.istatusid,onChange:this.handleStatusChange,optionFilterProp:"children",notFoundContent:"无法找到",disabled:this.state.statusDisabled},b["default"].createElement(w.VpOption,{value:0},"请选择实体状态"),this.state.statusTemplate.map(function(e,t){return b["default"].createElement(w.VpOption,{key:"status"+t,value:e.hasOwnProperty("value")?e.value:""},e.hasOwnProperty("label")?e.label:"")})))))),b["default"].createElement("div",{className:"bg-white p-sm"},b["default"].createElement("h4",{className:"p-b-sm fw b-b"},"工序列表")),b["default"].createElement("div",{className:"bg-gray p-sm",key:"titleDiv"},b["default"].createElement(w.VpRow,{key:"titleRow"},b["default"].createElement(w.VpCol,{span:5,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"工序名称")),b["default"].createElement(w.VpCol,{span:4,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"工序图标")),b["default"].createElement(w.VpCol,{span:4,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"工序链接")),b["default"].createElement(w.VpCol,{span:5,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"显示名称")),b["default"].createElement(w.VpCol,{span:2,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"是否默认")),b["default"].createElement(w.VpCol,{span:2,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"读权限")),b["default"].createElement(w.VpCol,{span:2,className:"text-center p-lr-sm"},b["default"].createElement("h4",null,"写权限")))),b["default"].createElement("div",{className:"bg-white moveArea",id:"moveArea"},this.state.functionList.map(function(t){return b["default"].createElement("div",{key:"rowdiv"+t.iid,className:"bg-white rowdiv","data-id":t.iid,onClick:function(t){return e.selectRow(t)}},b["default"].createElement(w.VpRow,{key:"row"+t.iid,style:{marginTop:1,marginBottom:1},className:"b-b rowitem",type:"flex",justify:"center",align:"middle"},b["default"].createElement(w.VpCol,{span:5,className:"text-left cursor"},t.sname),b["default"].createElement(w.VpCol,{span:4,className:"text-left "},b["default"].createElement("div",{id:"sicon"+t.iid},t.sicon)),b["default"].createElement(w.VpCol,{span:4,className:"text-left cursor"},b["default"].createElement("div",{id:"surl"+t.iid},t.surl)),b["default"].createElement(w.VpCol,{span:5,className:"text-left displayCol"},b["default"].createElement(w.VpInput,{id:"name"+t.iid,defaultValue:t.displayname,placeholder:"请输入显示名称"})),b["default"].createElement(w.VpCol,{span:2,className:"text-center cursor defaultCol"},b["default"].createElement(w.VpCheckbox,{id:"idefault"+t.iid,value:[e.state.checkDefaultId==t.iid],options:[{label:"",value:!0}],onChange:function(a){return e.onChangeDefault(a,t.iid)}})),b["default"].createElement(w.VpCol,{span:2,className:"text-center cursor readCol"},b["default"].createElement(w.VpCheckbox,{id:"read"+t.iid,value:["0"==t.iaccesslevel||"1"==t.iaccesslevel],options:[{label:"",value:!0}],onChange:function(a){return e.onChangeRead(a,t.iid)}})),b["default"].createElement(w.VpCol,{span:2,className:"text-center cursor writeCol"},b["default"].createElement(w.VpCheckbox,{id:"write"+t.iid,value:["1"==t.iaccesslevel],options:[{label:"",value:!0}],onChange:function(a){return e.onChangeWrite(a,t.iid)}}))))})),b["default"].createElement("div",{className:"bg-white p-sm",style:{marginTop:25}}),this.state.disabled?null:b["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{position:"absolute"}},b["default"].createElement(w.VpButton,{key:"addFun",type:"ghost",size:"large",onClick:function(){return e.btnOptClick("addFun")}},"添加"),b["default"].createElement(w.VpButton,{key:"delFun",type:"ghost",size:"large",onClick:function(){return e.btnOptClick("delFun")}},"删除"),b["default"].createElement(w.VpButton,{key:"delAll",type:"ghost",size:"large",onClick:function(){return e.btnOptClick("delAll")}},"删除全部"),b["default"].createElement(w.VpButton,{key:"saveBat",type:"primary",size:"large",onClick:function(){return e.btnOptClick("saveBat")}},"保 存"))):""),b["default"].createElement(w.VpModal,{title:this.state.listtitle,visible:this.state.showlist,onOk:function(){return e.cancelListModal()},onCancel:function(){return e.cancelListModal()},width:"60%",height:"100%",maskClosable:!1,footer:null,wrapClassName:"modal-no-footer"},this.state.showlist?b["default"].createElement(C["default"],{iid:this.state.iid,okClick:function(t){return e.okListModal(t)},cancelClick:function(){return e.cancelListModal()}}):""))}}]),t}(v.Component);t["default"]=S=(0,w.VpFormCreate)(S)},1019:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(363),l=i(s),n=a(802),c=i(n),o=a(688),r=i(o),d=a(54),u=i(d),f=a(55),p=i(f),h=a(59),m=i(h),g=a(93),y=i(g),v=a(8),b=i(v),w=a(4),k=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.state={filters:[],table_headers:[],table_array:[],cur_page:1,page:1,pagination:{},limit:10,sortfield:"",sorttype:"",selectItem:[],selectedRowKeys:[],expandedRowKeys:[],tableloading:!0},a.tableChange=a.tableChange.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.onExpand=a.onExpand.bind(a),a.onRowClick=a.onRowClick.bind(a),a.handleSelect=a.handleSelect.bind(a),a.handleSelectAll=a.handleSelectAll.bind(a),a.onSelectChange=a.onSelectChange.bind(a),a}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.setState({relationid:this.props.relationid,navigationid:this.props.navigationid},function(){e.getHeader(),e.getData()})}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({tableloading:!1})},6e3)}},{key:"getHeader",value:function(){var e=this,t={listType:"funlistTree"};(0,w.vpAdd)("/{vpplat}/status/process/getListHeader",{sparam:(0,c["default"])(t)}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];if(t.data.grid.hasOwnProperty("fields")){t.data.grid.fields.map(function(e,t){var i=void 0,s=void 0,l=void 0,n=void 0;for(var c in e)"field_label"==c?i=e[c]:"field_name"==c&&(s=e[c]),"fixed"==c&&(n=e[c]),"field_width"==c&&(l=e[c]);i&&s&&("left"==n||"right"==n?a.push({title:i,dataIndex:s,key:s,width:l,fixed:n}):a.push({title:i,dataIndex:s,key:s,fixed:n}))});var i=[];a.filter(function(e){return"sname"==e.dataIndex}).map(function(e){e.width=280,i.push(e)}),a.map(function(e,t){"sname"!=e.dataIndex&&i.push(e)}),e.setState({table_headers:i})}}})["catch"](function(e){})}},{key:"getData",value:function(){var e=this,t={listType:"funlistTree",iid:this.props.iid};(0,w.vpAdd)("/{vpplat}/status/process/getFunlistTreeData",{sparam:(0,c["default"])(t)}).then(function(t){var a=t.data.page,i=t.data.list,s=function(){return"共"+a.totalRows+"条"};e.setState({table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{showTotal:s,pageSize:a.numPerPage,showSizeChanger:!1,showQuickJumper:!1}});var l=[];i.map(function(t,a){if(0==t.checked&&(e.onRowClick(t),-1==t.isleaf)){-1==l.findIndex(function(e){return t.iparent===e})&&l.push(t.iparent)}1==t.isleaf&&l.push(t.iid)}),e.setState({expandedRowKeys:l})})["catch"](function(e){"function"!=typeof e||e()})}},{key:"tableChange",value:function(e,t,a){var i=this,s="";"descend"===a.order?s="desc":"ascend"===a.order&&(s="asc"),this.setState({cur_page:e.current||this.state.cur_page,sortfield:a.field,sorttype:s,limit:e.pageSize||this.state.limit},function(){i.getData()})}},{key:"onRowClick",value:function(e){var t=this.state.selectedRowKeys.findIndex(function(t){return e.iid===t}),a=!0;-1!=t&&(a=!1),a?this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys),[e.iid]),selectItem:[].concat((0,l["default"])(this.state.selectItem),[e])},function(){e.hasOwnProperty("children")}):this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys.slice(0,t)),(0,l["default"])(this.state.selectedRowKeys.slice(t+1))),selectItem:[].concat((0,l["default"])(this.state.selectItem.slice(0,t)),(0,l["default"])(this.state.selectItem.slice(t+1)))},function(){e.hasOwnProperty("children")})}},{key:"handleSelect",value:function(e,t){var a=0;t?this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys),[e.iid]),selectItem:[].concat((0,l["default"])(this.state.selectItem),[e])},function(){e.hasOwnProperty("children")}):(this.state.selectedRowKeys.forEach(function(t,i){t===e.iid&&(a=i)}),this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys.slice(0,a)),(0,l["default"])(this.state.selectedRowKeys.slice(a+1))),selectItem:[].concat((0,l["default"])(this.state.selectItem.slice(0,a)),(0,l["default"])(this.state.selectItem.slice(a+1)))},function(){e.hasOwnProperty("children")}))}},{key:"cascadeSelect",value:function(e,t){var a=this,i=0,s=[],n=[];if(e.hasOwnProperty("children")&&e.children.forEach(function(e,l){i=a.state.selectedRowKeys.findIndex(function(t){return e.iid===t}),t?-1==i&&(s.push(e.iid),n.push(e)):-1!=i&&(s.push(e.iid),n.push(e))}),t)this.setState({selectedRowKeys:[].concat((0,l["default"])(this.state.selectedRowKeys),s),selectItem:[].concat((0,l["default"])(this.state.selectItem),n)},function(){});else{var c=[],o=[];this.state.selectItem.forEach(function(e,t){-1==(i=s.findIndex(function(t){return e.iid===t}))&&(o.push(e),c.push(e.iid))}),this.setState({selectedRowKeys:c,selectItem:o},function(){})}}},{key:"onSelectChange",value:function(e){this.setState({selectedRowKeys:e})}},{key:"handleSelectAll",value:function(e,t,a){this.setState({selectItem:t})}},{key:"okClick",value:function(){if(this.state.selectItem.length>0){var e=!1;this.state.selectItem.map(function(t){t.isleaf<=0&&(e=!0)}),e?this.props.okClick(this.state.selectItem):(0,w.VpAlertMsg)({message:"消息提示",description:"请至少选择一条类别为功能的数据！",type:"error",closeText:"关闭",showIcon:!0},5)}else(0,w.VpAlertMsg)({message:"消息提示",description:"请至少选择一条数据！",type:"error",closeText:"关闭",showIcon:!0},5)}},{key:"cancelClick",value:function(){this.props.cancelClick()}},{key:"onExpand",value:function(e,t){if(e)this.setState({expandedRowKeys:[].concat((0,l["default"])(this.state.expandedRowKeys),[t.iid])},function(){});else{var a=this.state.expandedRowKeys.findIndex(function(e){return t.iid===e});this.setState({expandedRowKeys:[].concat((0,l["default"])(this.state.expandedRowKeys.slice(0,a)),(0,l["default"])(this.state.expandedRowKeys.slice(a+1)))},function(){})}}},{key:"render",value:function(){var e=this,t=this.state.selectedRowKeys,a={type:"checkbox",selectedRowKeys:t,onSelect:this.handleSelect,onSelectAll:this.handleSelectAll,onChange:this.onSelectChange};return b["default"].createElement("div",{className:"bg-white scroll full-height p-b-xxlg"},b["default"].createElement("div",{className:"p-sm"},b["default"].createElement(w.VpTable,{loading:this.state.tableloading,onExpand:this.onExpand,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,rowSelection:a,rowKey:function(e){return e.iid},expandedRowKeys:this.state.expandedRowKeys,resize:!0})),b["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{position:"absolute"}},b["default"].createElement(w.VpButton,{key:"confirmBtn",type:"primary",size:"large",onClick:function(){return e.okClick()}},"确认"),b["default"].createElement(w.VpButton,{key:"cancelBtn",type:"primary",size:"large",onClick:function(){return e.cancelClick()}},"取消")))}}]),t}(v.Component);t["default"]=k=(0,w.VpFormCreate)(k)}});