webpackJsonp([7],{952:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(155),i=o(n),s=a(688),r=o(s),l=a(54),c=o(l),u=a(55),d=o(u),p=a(59),m=o(p),f=a(93),h=o(f),g=a(8),k=o(g),w=a(4),v=a(826),y=o(v),C=a(919),b=o(C),I=a(652),x=function(e){function t(e){(0,c["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.getHeader=function(){var e=[{title:"状态",dataIndex:"taskState",key:"taskState",width:50,render:function(e,t){return k["default"].createElement("span",null,0==t.taskState?k["default"].createElement(w.VpTooltip,{placement:"top",title:"未超时"},k["default"].createElement(w.VpIcon,{className:"m-r-xs",type:"vpicon-clock"})):k["default"].createElement(w.VpTooltip,{placement:"top",title:"已超时"},k["default"].createElement(w.VpIcon,{className:"m-r-xs",type:"vpicon-handle"})))}},{title:"流程名称",dataIndex:"flowName",key:"flowName",sorter:function(e,t){return e.flowName.localeCompare(t.flowName)}},{title:"流程版本",dataIndex:"version",key:"version",sorter:function(e,t){return e.version.localeCompare(t.version)}},{title:"对象名称",dataIndex:"objectName",key:"objectName",sorter:function(e,t){return e.objectName.localeCompare(t.objectName)}},{title:"当前步骤",dataIndex:"taskName",key:"taskName",sorter:function(e,t){return e.taskName.localeCompare(t.taskName)}},{title:"到达时间",dataIndex:"createTime",key:"createTime",sorter:function(e,t){return e.createTime.localeCompare(t.createTime)}},{title:"发起人",dataIndex:"startUsername",key:"startUsername",sorter:function(e,t){return e.startUsername.localeCompare(t.startUsername)}},{title:"发起时间",dataIndex:"startTime",key:"startTime",sorter:function(e,t){return e.startTime.localeCompare(t.startTime)}}];e.push({title:"操作",fixed:"right",width:120,key:"operation",render:function(e,t){return k["default"].createElement("div",{className:"full-height"},k["default"].createElement(w.VpTooltip,{placement:"top",title:"查看"},k["default"].createElement(w.VpIconFont,{onClick:function(e){return a.viewTaskClick(e,t)},className:"cursor text-primary m-lr-xs",type:"vpicon-see-o"})),null==t.assign||""==t.assign?"":k["default"].createElement(w.VpTooltip,{placement:"top",title:"归还"},k["default"].createElement(w.VpIconFont,{onClick:function(e){return a.returnTaskClick(e,t)},className:"cursor text-primary m-lr-xs",type:"vpicon-chehui"})))}}),a.setState({tableHeader:e})},a.onSelectChange=function(e,t){var o=t.map(function(e){return e.taskId}).join();a.setState({selectedRowKeys:e,selectedRows:t,taskids:o})},a.batchSelect=function(){var e=!0,t="";return 0==a.state.selectedRows.length?void(0,w.VpAlertMsg)({message:"消息提示",description:"请选择相关记录!",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5):(a.state.selectedRows.map(function(a){""==t&&(t=a.pdId+a.stepkey),a.pdId+a.stepkey!=t&&(e=!1)}),e?(a.setState({showFlowBatch:!0}),void a.props.setBreadCrumb(a.state.selectedRows[0].flowName)):void(0,w.VpAlertMsg)({message:"消息提示",description:"请选择相同版本相同步骤批量提交!",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5))},a.getData=function(){(0,w.vpQuery)("/{vpflow}/rest/process/processflow",{curr:a.state.curr,limit:a.state.limit,quickvalue:a.state.quickvalue,filtervalue:a.state.filtervalue}).then(function(e){if(e.data==undefined)return void(0,w.VpAlertMsg)({message:"消息提示",description:e.msg,type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5);var t=e.data,o=function(){return"共"+t.count+"条"},n=vp.computedHeight(t.count,".processflow");a.setState({tableHeight:n,tableData:t.result,curr:t.curr,total_rows:t.count,limit:t.limit,pagination:{total:t.count,showTotal:o,pageSize:t.limit,onShowSizeChange:a.onShowSizeChange,showSizeChanger:!0,showQuickJumper:!0}})})},a.onShowSizeChange=function(e){},a.handlesearch=function(e){var t=e.replace(/\s/g,"");a.setState({quickvalue:t},function(){a.getData()})},a.tableChange=function(e,t,o){var n="";"descend"===o.order?n="desc":"ascend"===o.order&&(n="asc"),a.setState({curr:e.current||a.state.curr,sortfield:o.field,sorttype:n,limit:e.pageSize||a.state.limit},function(){a.getData()})},a.closeRightModal=function(){a.setState({showRightBox:!1,showFlowBatch:!1,increaseData:{}},function(){a.getData()}),a.props.setBreadCrumb()},a.tabsChange=function(e){a.state.tabs_array[e]},a.filterChange=function(e){a.setState({filtervalue:e.target.value},function(){a.getData()})},a.cancelModal=function(){a.setState({visible:!1})},a.closeRight=function(e){a.setState({showFlowBatch:e,showRightBox:e,staskid:""}),a.props.setBreadCrumb2()},a.returnTaskClick=function(e,t){e.stopPropagation(),(0,w.vpAdd)("/{vpflow}/rest/task/return-task",{taskId:t.taskId}).then(function(e){a.getData()})},a.viewTaskClick=function(e,t){a.onRowClick(t)},a.onRowClick=function(e){(0,w.vpQuery)("/{vpflow}/rest/process/task-info",{taskId:e.taskId}).then(function(t){if(t.data==undefined)return void(0,w.VpAlertMsg)({message:"消息提示",description:t.msg,type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5);var o=t.data;a.setState((0,i["default"])({showRightBox:!0,operrole:o.operrole,record:o.record,staskid:o.taskId,iid:o.objectId,usermode:2!=o.usermode,entityid:o.entityId},"iid",o.objectId)),a.props.setBreadCrumb(e.flowName)})},a.addNewDom=function(){var e=a.state.record;return k["default"].createElement(y["default"],{activityName:e.activityName,usermode:a.state.usermode,operrole:a.state.operrole,stepkey:e.activityId,staskid:a.state.staskid,piid:e.piId,pdid:e.pdId,iobjectentityid:a.state.entityid,iobjectid:a.state.iid,entityid:e.iflowentityid,endTime:e.endTime,closeRight:function(e){return a.closeRight(e)},getData:function(){return a.getData()}})},a.state={tableHeader:[],tableData:[],curr:1,limit:10,filtervalue:"",quickvalue:"",showRightBox:!1,showFlowBatch:!1,total_rows:"",pagination:{},visible:!1,staskid:"",entityid:"",iid:"",record:{},usermode:"",tableHeight:"",selectedRowKeys:[],selectedRows:[]},a}return(0,h["default"])(t,e),(0,d["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({filtervalue:e.filtervalue,quickvalue:e.quickvalue},function(){t.getData()})}},{key:"componentWillMount",value:function(){this.getHeader(),this.getData()}},{key:"componentDidMount",value:function(){this.props.batchSelect(this)}},{key:"render",value:function(){var e=this,t={onChange:this.onSelectChange};return k["default"].createElement("div",{className:"full-height"},k["default"].createElement(w.VpTable,{className:"processflow",rowSelection:t,rowKey:function(e){return e.taskId},columns:this.state.tableHeader,dataSource:this.state.tableData,onChange:this.tableChange,pagination:this.state.pagination,onRowClick:this.onRowClick,scroll:{y:this.state.tableHeight},resize:!0}),k["default"].createElement(I.RightBox,{max:!0,button:k["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},k["default"].createElement(w.VpTooltip,{placement:"top",title:""},k["default"].createElement(w.VpIcon,{type:"right"}))),tips:k["default"].createElement("div",{className:"tips p-xs"},k["default"].createElement(w.VpTooltip,{placement:"top",title:"0000"},k["default"].createElement(w.VpIcon,{type:"exclamation-circle text-muted m-r-xs"}))),show:this.state.showRightBox||this.state.showFlowBatch},this.state.showRightBox?this.addNewDom():null,this.state.showFlowBatch?k["default"].createElement(b["default"],{taskids:this.state.taskids,closeRight:function(){return e.closeRightModal()},getData:function(){return e.getData()}}):null))}}]),t}(g.Component);t["default"]=x=(0,w.VpFormCreate)(x)}});