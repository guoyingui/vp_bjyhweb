webpackJsonp([7],{883:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _extends2=__webpack_require__(14),_extends3=_interopRequireDefault(_extends2),_stringify=__webpack_require__(786),_stringify2=_interopRequireDefault(_stringify),_getPrototypeOf=__webpack_require__(688),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=__webpack_require__(54),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(55),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=__webpack_require__(59),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(93),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(8),_react2=_interopRequireDefault(_react),_vpreact=__webpack_require__(4);__webpack_require__(884);var _vpbusiness=__webpack_require__(652),system=function(_React$Component){function system(props){(0,_classCallCheck3["default"])(this,system);var _this2=(0,_possibleConstructorReturn3["default"])(this,(system.__proto__||(0,_getPrototypeOf2["default"])(system)).call(this,props));return _this2.systemRole=function(){var e=_this2;(0,_vpreact.vpQuery)("/{vpplat}/api/pur/point",{saccesskey:"system"}).then(function(t){var a=!0;t.data.system>0&&(a=!1),e.setState({disabled:a})})},_this2.queryHeader=function(){(0,_vpreact.vpQuery)("/{vpmprovider}/indicator/getheader",{tabType:_this2.state.ientityid}).then(function(e){var t=_this2;e.data.headers.map(function(e,a){0==a?_this2.state.tableHeader.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:e.edit_col?function(a,i){return _react2["default"].createElement(_vpbusiness.EditTableCol,{callBack:t.callBack,focus:!0,id:"id",data:t.state.data,record:i,widget:e.widget,value:a})}:null}):length!=a&&_this2.state.tableHeader.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:"minrestrict"==e.field_name||"maxrestrict"==e.field_name?70:"description"==e.field_name?900:300,edit_col:e.edit_col,widget:e.widget,render:e.edit_col?function(a,i){return _react2["default"].createElement(_vpbusiness.EditTableCol,{callBack:t.callBack,id:"id",data:t.state.data,record:i,widget:e.widget,value:a})}:null})}),t.setState({tableHeader:t.state.tableHeader})})},_this2.tabsChange=function(e){_this2.setState({ientityid:e,iclassid:-1,tableHeader:[]},function(){_this2.queryHeader(),_this2.getData()})},_this2.handleSave=function(){var sparam={},validate=[];validate=["iclassid","indicator"],_this2.state.data.map(function(e,t){_this2.state.addTableData.push(e)}),sparam.data=(0,_stringify2["default"])(_this2.state.addTableData),_this2.props.form.validateFields(validate,function(errors,values){if(!errors){6==_this2.state.ientityid||7==_this2.state.ientityid?(sparam.iclassid=values.iclassid,sparam.indicator=values.indicator):(sparam.iclassid=_this2.state.iclassid,sparam.indicator=_this2.state.indicator);var ientityid=_this2.state.ientityid,selectiid=_this2.state.selectiid;"earlyWarning"==_this2.state.ientityid&&(ientityid=_this2.state.indicator,selectiid=_this2.state.selectedRowKeys.length>0?_this2.state.selectedRowKeys[0]:"-1",sparam.iclassid=_this2.state.iclassid,sparam.indicator=_this2.state.indicator,sparam.tabType="earlyWarning"),sparam.selectiid=selectiid,sparam.ientityid=ientityid;var isSave=!0;if(9==sparam.ientityid||10==sparam.ientityid){var obj=eval("("+sparam.data+")");obj.length>0&&obj[0].minrestrict<=0?(isSave=!1,(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"下限值请设置为大于0的数值",type:"error",onClose:_this2.onClose,closeText:"关闭",showIcon:!0},5)):isSave=!0}isSave&&(0,_vpreact.vpAdd)("/{vpmprovider}/indicator/save",{sparam:(0,_stringify2["default"])(sparam)}).then(function(e){(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"保存成功！",type:"success",onClose:_this2.onClose,closeText:"关闭",showIcon:!0},5),_this2.setState({addTableData:[],data:[]})})}})},_this2.callBack=function(e){var t=_this2.state.data,a=t.filter(function(t){return t.id!=e.id});a.push(e),_this2.state.data=a},_this2.handleSelect=function(e,t,a){t&&_this2.setState({selectedRowKeys:[e.id],selectiid:e.id})},_this2.onSelectChange=function(e){_this2.setState({selectedRowKeys:e})},_this2.handleChange=function(e){_this2.getgetindicatorlist(e)},_this2.handleindicatorChange=function(e){_this2.setState({indicator:e})},_this2.handleWarningChange=function(e){_this2.setState({indicator:e},function(){(0,_vpreact.vpQuery)("/{vpmprovider}/indicator/getdata",{ientityid:e,iclassid:"-1",tabType:"earlyWarning"}).then(function(e){_this2.setState({tableData:e.data.indicatorlist,selectiid:e.data.selectiid,selectedRowKeys:[e.data.selectiid],classdata:e.data.classdata,iclassid:e.data.iclassid})})})},_this2.handleWarningClassChange=function(e){_this2.setState({iclassid:e},function(){(0,_vpreact.vpQuery)("/{vpmprovider}/indicator/getdata",{ientityid:_this2.state.indicator,iclassid:e,tabType:"earlyWarning"}).then(function(e){_this2.setState({tableData:e.data.indicatorlist,selectedRowKeys:[e.data.selectiid],selectiid:e.data.selectiid})})})},_this2.state={data:[],visible:!1,ientityid:6,tableHeader:[],tableData:[],addTableData:[],selectedRowKeys:[],selectiid:"",classdata:[],iclassid:-1,indicator:"2",disabled:!0},_this2}return(0,_inherits3["default"])(system,_React$Component),(0,_createClass3["default"])(system,[{key:"componentWillMount",value:function(){this.systemRole(),this.queryHeader(),this.getData()}},{key:"onPanelChange",value:function(e,t){}},{key:"getData",value:function(){var e=this,t="earlyWarning"==this.state.ientityid?"6":this.state.ientityid;(0,_vpreact.vpQuery)("/{vpmprovider}/indicator/getdata",{ientityid:t,iclassid:this.state.iclassid,tabType:this.state.ientityid}).then(function(t){var a="earlyWarning"==e.state.ientityid?"6":t.data.indicator;e.setState({tableData:t.data.indicatorlist,classdata:t.data.classdata,selectiid:t.data.selectiid,selectedRowKeys:[t.data.selectiid],iclassid:t.data.iclassid,indicator:a})})}},{key:"getgetindicatorlist",value:function(e){var t=this;(0,_vpreact.vpQuery)("/{vpmprovider}/indicator/getindicatorlist",{ientityid:this.state.ientityid,iclassid:e}).then(function(a){t.setState({tableData:a.data.indicatorlist,selectiid:a.data.selectiid,selectedRowKeys:[a.data.selectiid],iclassid:e})})}},{key:"handleSelectAll",value:function(e,t,a){this.setState({selectItem:t})}},{key:"render",value:function(){var e=this,t=this.props.form,a=(t.getFieldsValue,t.getFieldValue,t.setFieldsValue,t.setFields,t.getFieldProps),i={labelCol:{span:6},wrapperCol:{span:14}},l=this.state.selectedRowKeys,s={type:"radio",selectedRowKeys:l,onSelect:this.handleSelect,onChange:this.onSelectChange,onSelectAll:this.handleSelectAll},r={type:"checkbox",selectedRowKeys:l,onSelect:this.handleSelect,onChange:this.onSelectChange,onSelectAll:this.handleSelectAll},n=this.state.disabled;return _react2["default"].createElement("div",{className:"approval-box approval sysdefine-container full-height"},_react2["default"].createElement("div",{className:"p-sm bg-white full-height"},_react2["default"].createElement(_vpreact.VpTabs,{className:"full-height",tabPosition:"left",onChange:this.tabsChange},_react2["default"].createElement(_vpreact.VpTabPane,{tab:"项目群",key:"6"},_react2["default"].createElement("div",{className:"p-sm m-t-lg"},_react2["default"].createElement(_vpreact.VpForm,null,_react2["default"].createElement(_vpreact.VpRow,{gutter:10},_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"项目群类型"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("iclassid",{initialValue:this.state.iclassid}),{onChange:this.handleChange}),this.state.classdata.length>0?this.state.classdata.map(function(e,t){return _react2["default"].createElement(_vpreact.VpOption,{key:t,value:e.iid},e.sname)}):""))),_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"指标值来源"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("indicator",{initialValue:this.state.indicator}),{onChange:this.handleindicatorChange}),_react2["default"].createElement(_vpreact.VpOption,{key:"1",value:"2"},"高层计划"),_react2["default"].createElement(_vpreact.VpOption,{key:"2",value:"1",selected:!0},"所包含项目")))))),_react2["default"].createElement(_vpreact.VpTable,{columns:this.state.tableHeader,dataSource:this.state.tableData,pagination:!1,rowSelection:s,scroll:{x:100},resize:!0})),_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},n?null:_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleSave()}},"保存"))),_react2["default"].createElement(_vpreact.VpTabPane,{tab:"项目",key:"7"},_react2["default"].createElement("div",{className:"p-sm m-t-lg"},_react2["default"].createElement(_vpreact.VpForm,null,_react2["default"].createElement(_vpreact.VpRow,{gutter:10},_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"项目类型"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("iclassid",{initialValue:this.state.iclassid}),{onChange:this.handleChange}),this.state.classdata.length>0?this.state.classdata.map(function(e,t){return _react2["default"].createElement(_vpreact.VpOption,{key:t,value:e.iid},e.sname)}):""))),_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"指标值来源"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("indicator",{initialValue:this.state.indicator}),{onChange:this.handleindicatorChange}),_react2["default"].createElement(_vpreact.VpOption,{key:"1",value:"2"},"高层计划"),_react2["default"].createElement(_vpreact.VpOption,{key:"2",value:"3"},"任务计划")))))),_react2["default"].createElement(_vpreact.VpTable,{columns:this.state.tableHeader,dataSource:this.state.tableData,pagination:!1,rowSelection:s,scroll:{x:!0},resize:!0})),_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},n?null:_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleSave()}},"保存"))),_react2["default"].createElement(_vpreact.VpTabPane,{tab:"高层计划",key:"9"},_react2["default"].createElement("div",{className:"p-sm m-t-lg"},_react2["default"].createElement(_vpreact.VpTable,{rowSelection:s,columns:this.state.tableHeader,dataSource:this.state.tableData,pagination:!1,resize:!0})),_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},n?null:_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleSave()}},"保存"))),_react2["default"].createElement(_vpreact.VpTabPane,{tab:"任务计划",key:"10"},_react2["default"].createElement("div",{className:"p-sm m-t-lg"},_react2["default"].createElement(_vpreact.VpTable,{rowSelection:s,columns:this.state.tableHeader,dataSource:this.state.tableData,pagination:!1,resize:!0})),_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},n?null:_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleSave()}},"保存"))),_react2["default"].createElement(_vpreact.VpTabPane,{tab:"预警设置",key:"earlyWarning"},_react2["default"].createElement("div",{className:"p-sm m-t-lg"},_react2["default"].createElement(_vpreact.VpForm,null,_react2["default"].createElement(_vpreact.VpRow,{gutter:10},_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"预警来源"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("warning",{initialValue:this.state.indicator}),{onChange:this.handleWarningChange}),_react2["default"].createElement(_vpreact.VpOption,{key:"warning1",value:"6"},"项目群"),_react2["default"].createElement(_vpreact.VpOption,{key:"warning2",value:"7"},"项目"),_react2["default"].createElement(_vpreact.VpOption,{key:"warning3",value:"9"},"高层计划"),_react2["default"].createElement(_vpreact.VpOption,{key:"warning4",value:"10"},"任务计划")))),_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:10},_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"预警类别"},i),_react2["default"].createElement(_vpreact.VpSelect,(0,_extends3["default"])({},a("iclassid",{initialValue:this.state.iclassid}),{onChange:this.handleWarningClassChange}),this.state.classdata.length>0?this.state.classdata.map(function(e,t){return _react2["default"].createElement(_vpreact.VpOption,{key:t,value:e.iid},e.sname)}):""))))),_react2["default"].createElement(_vpreact.VpTable,{rowSelection:r,columns:this.state.tableHeader,dataSource:this.state.tableData,pagination:!1,resize:!0})),_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},n?null:_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleSave()}},"保存"))))))}}]),system}(_react2["default"].Component);exports["default"]=system=(0,_vpreact.VpFormCreate)(system)},884:function(e,t,a){var i=a(885);"string"==typeof i&&(i=[[e.id,i,""]]);var l={hmr:!0};l.transform=void 0;a(439)(i,l);i.locals&&(e.exports=i.locals)},885:function(e,t){}});