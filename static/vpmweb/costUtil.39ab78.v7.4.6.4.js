webpackJsonp([8,2,3,4],{870:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(363),s=i(n),o=a(786),l=i(o),d=a(395),r=i(d),c=a(688),u=i(c),h=a(54),p=i(h),f=a(55),m=i(f),v=a(59),y=i(v),g=a(93),A=i(g),w=a(8),b=i(w),k=a(4),R=a(652),S=a(871),C=i(S);a(872);var x=function(e){function t(e){(0,p["default"])(this,t);var a=(0,y["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this,e));return a.getExpandedRowa=function(e,t){var i=a,n=t;if(e.length){var s=[];e.map(function(e){n.push(e.iid),e.hasOwnProperty("children")&&(s=i.getExpandedRowa(e.children,n),s.map(function(e){-1==n.findIndex(function(t){return e===t})&&n.push(e)}))})}return n},a.state={filters:[],showRightBox:!1,table_headers:[],table_array:[],cur_page:1,page:1,pagination:{},limit:10,sortfield:"",sorttype:"",increaseData:[],formdata:[],entityid:"",iids:"",row_id:"",entityiid:"",visible:!1,modaltitle:"",selectiid:"",entityrole:!1,expandedRowKeys:[],tableHeight:""},a.handleCancel=a.handleCancel.bind(a),a.handleOk=a.handleOk.bind(a),a.tableChange=a.tableChange.bind(a),a.onRowClick=a.onRowClick.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.queryFormData=a.queryFormData.bind(a),a.saveRowData=a.saveRowData.bind(a),a.okModal=a.okModal.bind(a),a.cancelModal=a.cancelModal.bind(a),a.onExpand=a.onExpand.bind(a),a.menuClick=a.menuClick.bind(a),a.handleDropDown=a.handleDropDown.bind(a),a.toolBarClick=a.toolBarClick.bind(a),a}return(0,A["default"])(t,e),(0,m["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.props.disabled!=e.disabled&&this.getHeader()}},{key:"componentWillMount",value:function(){this.getHeader(),this.getData()}},{key:"componentDidMount",value:function(){$(".costTable").find(".ant-table-body").height($(document).height()-260)}},{key:"getHeader",value:function(){var e=this;(0,k.vpAdd)("/{vpmprovider}/vpm/cost/getTreeHeader",{}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];if(t.data.grid.hasOwnProperty("fields")){t.data.grid.fields.map(function(e,t){var i=void 0,n=void 0,s=void 0,o=void 0;for(var l in e)"field_label"==l?i=e[l]:"field_name"==l&&(n=e[l]),"fixed"==l&&(o=e[l]),"field_width"==l&&(s=e[l]);i&&n&&("left"==o||"right"==o?a.push({title:i,dataIndex:n,key:n,width:s,fixed:o}):a.push({title:i,dataIndex:n,key:n,fixed:o,width:250}))});var i=b["default"].createElement(k.VpMenu,{onClick:e.menuClick},b["default"].createElement(k.VpMenuItem,{key:"new"},b["default"].createElement("a",null,"新建")),b["default"].createElement(k.VpMenuItem,{key:"delete"},b["default"].createElement("a",null,"删除"))),n={title:"操作",key:"menu",width:90,render:function(t,a){return b["default"].createElement("span",{style:{textAlign:"center"}},b["default"].createElement(k.VpDropdown,{overlay:i,trigger:["click"],getPopupContainer:function(){return document.body}},b["default"].createElement(k.VpIcon,{"data-id":a.iid,className:"cursor",type:"vpicon-navlist",onClick:function(t){return e.handleDropDown(t)}})))}};e.props.disabled||a.push(n),e.setState({table_headers:a})}}})["catch"](function(e){})}},{key:"getData",value:function(){var e=this;(0,k.vpAdd)("/{vpmprovider}/vpm/cost/getTreeData",{}).then(function(t){var a=t.data.page,i=function(){return"共"+a.totalRows+"条"},n=vp.computedHeight(a.totalRows,".costTable")-50;e.setState({tableHeight:n,table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{showTotal:i,pageSize:a.numPerPage,showSizeChanger:!1,showQuickJumper:!1}});var s=e.getExpandedRowa(a.resultList,[]);e.setState({expandedRowKeys:s},function(){})})["catch"](function(e){"function"!=typeof e||e()})}},{key:"tableChange",value:function(e,t,a){var i=this,n="";"descend"===a.order?n="desc":"ascend"===a.order&&(n="asc"),this.setState({cur_page:e.current||this.state.cur_page,sortfield:a.field,sorttype:n,limit:e.pageSize||this.state.limit},function(){i.getData()})}},{key:"okModal",value:function(){this.setState({increaseData:{},visible:!1})}},{key:"cancelModal",value:function(){this.setState({increaseData:{},visible:!1})}},{key:"handleDropDown",value:function(e){e.stopPropagation(),this.setState({selectiid:e.target.dataset.id})}},{key:"handleCancel",value:function(){this.setState({increaseData:{},visible:!1})}},{key:"handleOk",value:function(){}},{key:"saveRowData",value:function(e,t){var a=this;(0,r["default"])(e).forEach(function(t,a){e[t]==undefined?e[t]="":null==e[t]&&(e[t]=0)});var i=a.state.newType;e.newType=i,"new"==i?e.iparentid=a.state.selectiid:e.iid=a.state.selectiid,(0,k.vpAdd)("/{vpmprovider}/vpm/cost/save",{sparam:(0,l["default"])(e)}).then(function(e){e.data.success?a.setState({visible:!1,increaseData:{}},a.getData()):(0,k.VpAlertMsg)({message:"消息提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},5)})}},{key:"onRowClick",value:function(e,t){if("false"==e.onclick);else{this.setState({increaseData:{},selectiid:e.iid,visible:!0}),this.queryFormData(e.iid,e.sname,"edit")}}},{key:"queryFormData",value:function(e,t,a){var i=this,n="",s="";"0"==e?(n="新建",s=this.state.selectiid):n="成本科目>"+t,(0,k.vpAdd)("/{vpmprovider}/vpm/cost/getNewForm",{newType:"costaccount",iid:e,iparentid:s}).then(function(e){i.setState({modaltitle:n,increaseData:e.data.form,newType:a,entityrole:!0,visible:!0})})}},{key:"toolBarClick",value:function(e){var t=this;"new"==e&&this.setState({visible:!0,selectiid:"0",increaseData:{}},function(){t.queryFormData("0","",e)})}},{key:"menuClick",value:function(e,t,a){var i=this,n=e.key;if("new"==n)this.setState({visible:!0,increaseData:{}},function(){i.queryFormData("0","",n)});else if("delete"==n){var s=this;(0,k.vpAdd)("/{vpmprovider}/vpm/cost/delete",{deleteType:"costaccount",iid:this.state.selectiid}).then(function(e){e.data.success?s.getData():(0,k.VpAlertMsg)({message:"消息提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},5)})}}},{key:"onExpand",value:function(e,t){if(e)this.setState({expandedRowKeys:[].concat((0,s["default"])(this.state.expandedRowKeys),[t.iid])},function(){});else{var a=this.state.expandedRowKeys.findIndex(function(e){return t.iid===e});this.setState({expandedRowKeys:[].concat((0,s["default"])(this.state.expandedRowKeys.slice(0,a)),(0,s["default"])(this.state.expandedRowKeys.slice(a+1)))},function(){})}}},{key:"render",value:function(){var e=this,t={entityrole:this.state.entityrole};return b["default"].createElement("div",{className:"full-height overflow"},b["default"].createElement("div",{className:"b-b bg-white p-b-sm"},b["default"].createElement(k.VpRow,{gutter:10},b["default"].createElement(k.VpCol,{className:"gutter-row",span:23},b["default"].createElement("span",null,b["default"].createElement("img",{src:C["default"]}),b["default"].createElement("font",{color:"red"}," 注: 必须设置二级科目"))),b["default"].createElement(k.VpCol,{className:"gutter-row",span:1},this.props.disabled?null:b["default"].createElement(k.VpTooltip,{placement:"top",title:"新增"},b["default"].createElement(k.VpButton,{type:"primary",className:"m-r-sm",shape:"circle",icon:"plus",onClick:function(){return e.toolBarClick("new")}}))))),b["default"].createElement("div",{className:"business-wrapper p-t-sm full-height scroll-y",id:"table"},b["default"].createElement("div",{className:" bg-white"},b["default"].createElement(k.VpTable,{className:"costTable",onExpand:this.onExpand,expandedRowKeys:this.state.expandedRowKeys,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,expandIconColumnIndex:0,scroll:{y:this.state.tableHeight},resize:!0}))),this.state.visible?b["default"].createElement(k.VpModal,{title:this.state.modaltitle,visible:this.state.visible,onOk:function(){return e.okModal()},onCancel:function(){return e.cancelModal()},width:"70%",footer:null,wrapClassName:"modal-no-footer"},b["default"].createElement(R.VpDynamicForm,{className:"p-sm full-height scroll p-b-xxlg",formData:this.state.increaseData,handleOk:this.props.disabled?null:this.saveRowData,handleCancel:this.handleCancel,params:t,okText:"提 交"})):"")}}]),t}(w.Component);t["default"]=x=(0,k.VpFormCreate)(x)},871:function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAOYAAAAAAP///+zhl+/lovXvwvbwxvbxzffy0Pjz0uzfk+zgluzgmO3hme3hm+3im+3inPHnrfTtwvTtw/bwyenZiejXierai+vcjunajevcj+vbkevclO3gmvDmsvHntuXQeufSfufUgOjWhOfUg+fVg+nXh/LoveTLdeXNd+XNeeXPeeXOeufSgO7fqOTIceTKcuTKc9y7XuLDauLDa+PEbePFbeTHcd/BbuTHcuLIe+HGfeLIf+bPj+jTlNewUdq0V9q3XOHEetCiP9GjQNiwVMqXMcuYM8uZM8uYNM2bN8ybOc2cO8+fPNChPs6ePtGkSNKlTdSKPtSDPtR5PtRyPv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAFUALAAAAAAQABAAAAeMgFWCgkZFTE2Fg4qCSkQ4NjQyPkWLgk43KylUVBozMUOLRUEVIyxTUxsuMz+Ug0UtFhQlIiEfJy4ySYpHEQwZF5sLKjA1oK4SEAoJpxwgKC5CikUdBQMCUlINISovSIs6BwQDUVEOJB9AS6E9CBPkDxg5T5VVRTseBggmPFD0rkUAW/kbSLCgwYOKAgEAOw=="},872:function(e,t,a){var i=a(873);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(439)(i,n);i.locals&&(e.exports=i.locals)},873:function(e,t){},874:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(395),s=i(n),o=a(786),l=i(o),d=a(688),r=i(d),c=a(54),u=i(c),h=a(55),p=i(h),f=a(59),m=i(f),v=a(93),y=i(v),g=a(8),A=i(g),w=a(4),b=a(652),k=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.icostmodelChange=function(e){var t=a,i=e.target.value,n="";n="2"==i?"1":"3"==i?"11":"0";var s=t.dynamic.getFieldValue,o=s("iresmodel"),d=s("itimemodel"),r={loadType:"costcontrol",init:"false",icostmodel:i,icosttype:n,iresmodel:o,itimemodel:d};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(r)}).then(function(e){t.setState({increaseData:e.data.form,entityrole:!0})})},a.icosttypeChange=function(e){var t=a,i=e.target.value,n=a.dynamic.getFieldValue,s=n("icostmodel"),o=n("iresmodel"),d=n("itimemodel"),r={loadType:"costcontrol",init:"false",icostmodel:s,icosttype:i,iresmodel:o,itimemodel:d};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(r)}).then(function(e){t.setState({increaseData:e.data.form,entityrole:!0})})},a.iresmodelChange=function(e){var t=a,i=e.target.value,n=t.dynamic.getFieldValue,s=n("icostmodel"),o=n("icosttype"),d=n("itimemodel"),r={loadType:"costcontrol",init:"false",icostmodel:s,icosttype:o,iresmodel:i,itimemodel:d};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(r)}).then(function(e){t.setState({increaseData:e.data.form,entityrole:!0})})},a.itimemodelChange=function(e){var t=a,i=e.target.value,n=t.dynamic.getFieldValue,s=n("icostmodel"),o=n("icosttype"),d=n("iresmodel"),r={loadType:"costcontrol",init:"false",icostmodel:s,icosttype:o,iresmodel:d,itimemodel:i};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(r)}).then(function(e){t.setState({increaseData:e.data.form,entityrole:!0})})},a.state={increaseData:[],formdata:[],entityrole:!1},a.handleCancel=a.handleCancel.bind(a),a.handleOk=a.handleOk.bind(a),a.saveRowData=a.saveRowData.bind(a),a.loadForm=a.loadForm.bind(a),a}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.setState({entityid:this.props.entityid,iid:this.props.iid},function(){e.loadForm()})}},{key:"componentDidMount",value:function(){$(".control").height($(window).height()-120)}},{key:"componentDidUpdate",value:function(){$(".control").find("#sdescription").height(200)}},{key:"loadForm",value:function(){var e=this,t={loadType:"costcontrol",init:"true"};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(t)}).then(function(t){e.setState({increaseData:t.data.form,entityrole:!0})})}},{key:"handleCancel",value:function(){var e=this;this.setState({increaseData:[],entityrole:!0},function(){var t=e,a={loadType:"costcontrol",init:"false",icostmodel:"1",icosttype:"0",iresmodel:"1",itimemodel:"1"};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/loadForm",{sparam:(0,l["default"])(a)}).then(function(e){t.setState({increaseData:e.data.form,entityrole:!0})})})}},{key:"handleOk",value:function(){this.saveRowData(this.props.form.getFieldsValue())}},{key:"saveRowData",value:function(e){var t=this;(0,s["default"])(e).forEach(function(t,a){e[t]==undefined?e[t]="":null==e[t]&&(e[t]=0)}),e.newType="costcontrol",(0,w.vpAdd)("/{vpmprovider}/vpm/cost/save",{sparam:(0,l["default"])(e)}).then(function(e){e.data.success?t.setState({entityrole:!1,increaseData:{}},t.loadForm()):(0,w.VpAlertMsg)({message:"消息提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},5)})}},{key:"render",value:function(){var e=this,t={entityrole:this.state.entityrole};return A["default"].createElement("div",{className:"full-height "},A["default"].createElement("div",{className:"p-sm bg-white control"},A["default"].createElement(b.VpDynamicForm,{ref:function(t){return e.dynamic=t},bindThis:this,className:"p-sm full-height p-b-xxlg",formData:this.state.increaseData,handleOk:this.props.disabled?null:this.saveRowData,handleCancel:this.props.disabled?null:this.handleCancel,params:t,okText:"保 存",cancelText:"重置"})))}}]),t}(g.Component);t["default"]=k=(0,w.VpFormCreate)(k)},875:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(395),s=i(n),o=a(786),l=i(o),d=a(688),r=i(d),c=a(54),u=i(c),h=a(55),p=i(h),f=a(59),m=i(f),v=a(93),y=i(v),g=a(8),A=i(g),w=a(4),b=a(652),k=a(876),R=i(k),S=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.state={filters:[],showRightBox:!1,table_headers:[],table_array:[],cur_page:1,page:1,pagination:{},limit:10,sortfield:"",sorttype:"",increaseData:[],formdata:[],visible:!1,modaltitle:"",selectiid:"",tableHeight:0},a.handleCancel=a.handleCancel.bind(a),a.handleOk=a.handleOk.bind(a),a.tableChange=a.tableChange.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.saveRowData=a.saveRowData.bind(a),a.okModal=a.okModal.bind(a),a.cancelModal=a.cancelModal.bind(a),a.onExpand=a.onExpand.bind(a),a.onRowClick=a.onRowClick.bind(a),a.closeRightModal=a.closeRightModal.bind(a),a}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.setState({entityid:this.props.entityid,iid:this.props.iid},function(){e.getHeader(),e.getData()})}},{key:"componentDidMount",value:function(){var e=vp.computedHeight(this.state.table_array.length,".pjcost",195);this.setState({tableHeight:e})}},{key:"getHeader",value:function(){var e=this,t={listType:"pjcost",entityid:this.state.entityid};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/getListHeader",{sparam:(0,l["default"])(t)}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];t.data.grid.hasOwnProperty("fields")&&(t.data.grid.fields.map(function(e,t){var i=void 0,n=void 0,s=void 0,o=void 0;for(var l in e)"field_label"==l?i=e[l]:"field_name"==l&&(n=e[l]),"fixed"==l&&(o=e[l]),"field_width"==l&&(s=e[l]);i&&n&&("left"==o||"right"==o?a.push({title:i,dataIndex:n,key:n,width:s,fixed:o}):a.push({title:i,dataIndex:n,key:n,fixed:o}))}),e.setState({table_headers:a}))}})["catch"](function(e){})}},{key:"getData",value:function(){var e=this,t={listType:"pjcost",currentPage:this.state.cur_page,pageSize:this.state.limit,entityid:this.state.entityid};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/getListData",{sparam:(0,l["default"])(t)}).then(function(t){var a=t.data,i=function(){return"共"+a.totalRows+"条"},n=0;n=vp.computedHeight(a.totalRows,".pjcost",195),e.setState({tableHeight:n,table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{total:a.totalRows,showTotal:i,pageSize:a.numPerPage,onShowSizeChange:e.onShowSizeChange,showSizeChanger:!0,showQuickJumper:!0}})})["catch"](function(e){"function"!=typeof e||e()})}},{key:"onShowSizeChange",value:function(e){}},{key:"tableChange",value:function(e,t,a){var i=this,n="";"descend"===a.order?n="desc":"ascend"===a.order&&(n="asc"),this.setState({cur_page:e.current||this.state.cur_page,sortfield:a.field,sorttype:n,limit:e.pageSize||this.state.limit},function(){i.getData()})}},{key:"okModal",value:function(){this.setState({visible:!1})}},{key:"cancelModal",value:function(){this.setState({visible:!1})}},{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"handleOk",value:function(){this.saveRowData(this.props.form.getFieldsValue())}},{key:"saveRowData",value:function(e){var t=this;(0,s["default"])(e).forEach(function(t,a){e[t]==undefined?e[t]="":null==e[t]&&(e[t]=0)}),e.iid=this.state.selectiid;var a=!0;""==e.dstartday?(a=!1,(0,w.VpAlertMsg)({message:"消息提示",description:"请选择开始日期！",type:"error",closeText:"关闭",showIcon:!0},5)):""==e.dendday?(a=!1,(0,w.VpAlertMsg)({message:"消息提示",description:"请选择结束日期！",type:"error",closeText:"关闭",showIcon:!0},5)):""==e.fhourrate&&(a=!1,(0,w.VpAlertMsg)({message:"消息提示",description:"请选择填写正常工时费率！",type:"error",closeText:"关闭",showIcon:!0},5)),e.dstartday>e.dendday&&(a=!1,(0,w.VpAlertMsg)({message:"消息提示",description:"开始时间必须早于或等于结束时间！",type:"error",closeText:"关闭",showIcon:!0},5)),e.newType="pjcost",e.dstartday=new Date(e.dstartday).Format("yyyy-MM-dd"),e.dendday=new Date(e.dendday).Format("yyyy-MM-dd"),a&&(0,w.vpAdd)("/{vpmprovider}/vpm/cost/save",{sparam:(0,l["default"])(e)}).then(function(e){e.data.success?t.setState({visible:!1,increaseData:{}},t.getData()):(0,w.VpAlertMsg)({message:"消息提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},5)})}},{key:"onRowClick",value:function(e){this.setState({showRightBox:!0,iid:e.iid,rightTitle:"项目类型 > "+e.sname}),this.loadRightWindow()}},{key:"onExpand",value:function(e,t){}},{key:"loadRightWindow",value:function(){return A["default"].createElement(w.VpTabs,{defaultActiveKey:"0",onChange:this.tabsChange},A["default"].createElement(w.VpTabPane,{tab:this.state.rightTitle,key:"0"},A["default"].createElement(R["default"],{disabled:this.props.disabled,iid:this.state.iid})))}},{key:"closeRightModal",value:function(){this.setState({showRightBox:!1})}},{key:"render",value:function(){return A["default"].createElement("div",{className:"overflow"},A["default"].createElement("div",{className:"bg-white p-lr-sm full-height scroll-y"},A["default"].createElement("div",{className:"bg-white"},A["default"].createElement(w.VpTable,{className:"pjcost",onExpand:this.onExpand,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,scroll:{y:this.state.tableHeight},resize:!0}))),A["default"].createElement(b.RightBox,{max:this.state.max,button:A["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},A["default"].createElement(w.VpTooltip,{placement:"top",title:""},A["default"].createElement(w.VpIcon,{type:"right"}))),show:this.state.showRightBox},this.state.showRightBox?this.loadRightWindow():null))}}]),t}(g.Component);t["default"]=S=(0,w.VpFormCreate)(S)},876:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(363),s=i(n),o=a(786),l=i(o),d=a(688),r=i(d),c=a(54),u=i(c),h=a(55),p=i(h),f=a(59),m=i(f),v=a(93),y=i(v),g=a(8),A=i(g),w=a(4),b=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,r["default"])(t)).call(this,e));return a.state={filters:[],showRightBox:!1,table_headers:[],table_array:[],cur_page:1,page:1,pagination:{},limit:10,sortfield:"",sorttype:"",increaseData:[],formdata:[],entityid:"",iids:"",row_id:"",entityiid:"",entityrole:!1,selectItem:[],selectedRowKeys:[],expandedRowKeys:[]},a.tableChange=a.tableChange.bind(a),a.getHeader=a.getHeader.bind(a),a.getData=a.getData.bind(a),a.onExpand=a.onExpand.bind(a),a.toolBarClick=a.toolBarClick.bind(a),a.onRowClick=a.onRowClick.bind(a),a.handleSelect=a.handleSelect.bind(a),a.handleSelectAll=a.handleSelectAll.bind(a),a.onSelectChange=a.onSelectChange.bind(a),a}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;e.entityid==this.state.entityid&&e.iid==this.state.iid||this.setState({entityid:e.entityid,iid:e.iid},function(){t.getHeader(),t.getData()})}},{key:"componentWillMount",value:function(){var e=this;this.setState({entityid:this.props.entityid,iid:this.props.iid},function(){e.getHeader(),e.getData()})}},{key:"componentDidMount",value:function(){}},{key:"getHeader",value:function(){var e=this,t={listType:"pjcost",classid:this.state.iid};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/getTreeHeader",{sparam:(0,l["default"])(t)}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1}),t.data.hasOwnProperty("grid"))){var a=[];if(t.data.grid.hasOwnProperty("fields")){t.data.grid.fields.map(function(e,t){var i=void 0,n=void 0,s=void 0,o=void 0;for(var l in e)"field_label"==l?i=e[l]:"field_name"==l&&(n=e[l]),"fixed"==l&&(o=e[l]),"field_width"==l&&(s=e[l]);i&&n&&("left"==o||"right"==o?a.push({title:i,dataIndex:n,key:n,width:s,fixed:o}):a.push({title:i,dataIndex:n,key:n,fixed:o}))});var i=[];a.filter(function(e){return"sname"==e.dataIndex}).map(function(e){e.width=280,i.push(e)}),a.map(function(e,t){"sname"!=e.dataIndex&&i.push(e)}),e.setState({table_headers:i})}}})["catch"](function(e){})}},{key:"getData",value:function(){var e=this,t={listType:"pjcost",classid:this.state.iid};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/getTreeData",{sparam:(0,l["default"])(t)}).then(function(t){var a=t.data.page,i=t.data.list,n=function(){return"共"+a.totalRows+"条"};e.setState({table_array:a.resultList,cur_page:a.currentPage,total_rows:a.totalRows,num_perpage:a.numPerPage,pagination:{showTotal:n,pageSize:a.numPerPage,showSizeChanger:!1,showQuickJumper:!1}});var s=[],o=[];i.map(function(e,t){"true"==e.ischecked&&o.push(e.iid),s.push(e.iid)}),e.setState({selectedRowKeys:o,expandedRowKeys:s})})["catch"](function(e){"function"!=typeof e||e()})}},{key:"tableChange",value:function(e,t,a){var i=this,n="";"descend"===a.order?n="desc":"ascend"===a.order&&(n="asc"),this.setState({cur_page:e.current||this.state.cur_page,sortfield:a.field,sorttype:n,limit:e.pageSize||this.state.limit},function(){i.getData()})}},{key:"onRowClick",value:function(e){var t=this,a=this.state.selectedRowKeys.findIndex(function(t){return e.iid===t}),i=!0;-1!=a&&(i=!1),i?this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys),[e.iid])},function(){e.pid>0&&t.cascadeSelectParent(e.pid),e.hasOwnProperty("children")&&t.cascadeSelect(e,i)}):this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys.slice(0,a)),(0,s["default"])(this.state.selectedRowKeys.slice(a+1)))},function(){e.hasOwnProperty("children")&&t.cascadeSelect(e,i)})}},{key:"handleSelect",value:function(e,t){var a=this,i=0;t?this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys),[e.iid])},function(){e.pid>0&&a.cascadeSelectParent(e.pid),e.hasOwnProperty("children")&&a.cascadeSelect(e,t)}):(this.state.selectedRowKeys.forEach(function(t,a){t===e.iid&&(i=a)}),this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys.slice(0,i)),(0,s["default"])(this.state.selectedRowKeys.slice(i+1)))},function(){e.hasOwnProperty("children")&&a.cascadeSelect(e,t)}))}},{key:"cascadeSelectParent",value:function(e){-1==this.state.selectedRowKeys.findIndex(function(t){return e===t})&&this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys),[e])})}},{key:"cascadeSelect",value:function(e,t){var a=this,i=0,n=[];if(e.hasOwnProperty("children")&&e.children.forEach(function(e,s){i=a.state.selectedRowKeys.findIndex(function(t){return e.iid===t}),t?-1==i&&n.push(e.iid):-1!=i&&n.push(e.iid)}),t)this.setState({selectedRowKeys:[].concat((0,s["default"])(this.state.selectedRowKeys),n)},function(){});else{var o=[];this.state.selectedRowKeys.forEach(function(e,t){-1==(i=n.findIndex(function(t){return e===t}))&&o.push(e)}),this.setState({selectedRowKeys:o},function(){})}}},{key:"onSelectChange",value:function(e){this.setState({selectedRowKeys:e})}},{key:"handleSelectAll",value:function(e,t,a){this.setState({selectItem:t})}},{key:"toolBarClick",value:function(e){if("save"==e){var t={newType:"pjcost",classid:this.state.iid,ids:this.state.selectedRowKeys};(0,w.vpAdd)("/{vpmprovider}/vpm/cost/save",{sparam:(0,l["default"])(t)}).then(function(e){e.data.success?(0,w.VpAlertMsg)({message:"消息提示",description:"保存成功！",type:"success",closeText:"关闭",showIcon:!0},5):(0,w.VpAlertMsg)({message:"消息提示",description:e.data.msg,type:"error",closeText:"关闭",showIcon:!0},5)})}}},{key:"onExpand",value:function(e,t){if(e)this.setState({expandedRowKeys:[].concat((0,s["default"])(this.state.expandedRowKeys),[t.iid])},function(){});else{var a=this.state.expandedRowKeys.findIndex(function(e){return t.iid===e});this.setState({expandedRowKeys:[].concat((0,s["default"])(this.state.expandedRowKeys.slice(0,a)),(0,s["default"])(this.state.expandedRowKeys.slice(a+1)))},function(){})}}},{key:"render",value:function(){var e=this,t=this.state.selectedRowKeys,a={type:"checkbox",selectedRowKeys:t,onSelect:this.handleSelect,onSelectAll:this.handleSelectAll,onChange:this.onSelectChange};return A["default"].createElement("div",{className:"bg-white scroll full-height p-b-xxlg"},A["default"].createElement("div",{className:"p-sm"},A["default"].createElement(w.VpTable,{onExpand:this.onExpand,columns:this.state.table_headers,dataSource:this.state.table_array,onChange:this.tableChange,onRowClick:this.onRowClick,pagination:this.state.pagination,rowSelection:a,rowKey:function(e){return e.iid},expandedRowKeys:this.state.expandedRowKeys,resize:!0})),A["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{position:"absolute"}},this.props.disabled?null:A["default"].createElement(w.VpButton,{className:"vp-btn-br",type:"primary",icon:"",onClick:function(){return e.toolBarClick("save")}},"保存")))}}]),t}(g.Component);t["default"]=b=(0,w.VpFormCreate)(b)},886:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(688),s=i(n),o=a(54),l=i(o),d=a(55),r=i(d),c=a(59),u=i(c),h=a(93),p=i(h),f=a(8),m=i(f),v=a(4);a(872);var y=a(870),g=i(y),A=a(875),w=i(A),b=a(874),k=i(b),R=function(e){function t(e){(0,l["default"])(this,t);var a=(0,u["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return a.systemRole=function(){var e=a;(0,v.vpQuery)("/{vpplat}/api/pur/point",{saccesskey:"system"}).then(function(t){var a=!0;t.data.system>0&&(a=!1),e.setState({disabled:a})})},a.state={tabs:"1",disabled:!0},a}return(0,p["default"])(t,e),(0,r["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.systemRole(),vpapp.routes.map(function(t,a){"entity"==t.code&&(e.Resource=t.file)})}},{key:"componentDidMount",value:function(){}},{key:"tabsChange",value:function(e){}},{key:"render",value:function(){var e=this.Resource;return m["default"].createElement("div",{className:"sysdefine-container full-height"},m["default"].createElement("div",{className:"p-sm bg-white full-height costUtil"},m["default"].createElement(v.VpTabs,{className:"full-height",tabPosition:"left",onChange:this.tabsChange},m["default"].createElement(v.VpTabPane,{className:"utiltabs",tab:"成本科目",key:"1"},m["default"].createElement(g["default"],{disabled:this.state.disabled})),m["default"].createElement(v.VpTabPane,{className:"utiltabs",tab:"项目成本科目",key:"2"},m["default"].createElement(w["default"],{disabled:this.state.disabled})),m["default"].createElement(v.VpTabPane,{className:"utiltabs",tab:"成本控制",key:"3"},m["default"].createElement(k["default"],{disabled:this.state.disabled})),m["default"].createElement(v.VpTabPane,{className:"utiltabs",tab:"资源管理",key:"4"},m["default"].createElement("div",{className:"resourceTabs"},m["default"].createElement(e,{entityid:127,viewtype:"list",fromtype:"resource"}))))))}}]),t}(m["default"].Component);t["default"]=R=(0,v.VpFormCreate)(R)}});