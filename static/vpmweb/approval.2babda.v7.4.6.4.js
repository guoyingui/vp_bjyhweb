webpackJsonp([6],{880:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function l(){return[{name:"待审批",value:"0"},{name:"已审批",value:"1"},{name:"已拒绝",value:"2"}]}function r(e,t){var a=new Date(Date.parse(e.replace(/-/g,"/")));a.setDate(a.getDate()+t);var n=a.getMonth()+1;return a.getFullYear()+"-"+n+"-"+a.getDate()}Object.defineProperty(t,"__esModule",{value:!0});var s=a(786),o=n(s),i=a(688),c=n(i),u=a(54),d=n(u),p=a(55),f=n(p),h=a(59),m=n(h),g=a(93),v=n(g),w=a(8),y=n(w),b=a(4),C=a(652);a(881),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var E=function(e){function t(e){(0,d["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this,e));return a.listProject=function(){(0,b.vpQuery)("/{vpmprovider}/approval/listProject",{}).then(function(e){a.setState({listProject:e.data})})},a.listPerson=function(){(0,b.vpQuery)("/{vpmprovider}/approval/listPerson",{entityid:7,iid:a.state.projectid}).then(function(e){a.setState({listPerson:e.data})})},a.querytimesheet=function(){a.state.tableData=[];var e=a.state,t=e.projectid,n=e.userid,l=e.cDate,r=e.currentPage,s=e.numPerPage,o=e.filtervalue;(0,b.vpQuery)("/{vpmprovider}/approval/getapprovaldata",{entityid:7,projectid:t,userid:n,date:l,currentPage:r,numPerPage:s,filterid:o}).then(function(e){var t=e.data,n=function(){return"共"+t.totalRows+"条"},l=vp.computedHeight(t.totalRows,".appTable",220)-50;a.setState({tableHeight:l,tableData:t.resultList,currentPage:t.currentPage,numPerPage:t.numPerPage,pagination:{total:t.totalRows,showTotal:n,pageSize:t.numPerPage,onShowSizeChange:a.onShowSizeChange,showSizeChanger:!0,showQuickJumper:!0}})})},a.queryApprovalHeader=function(){(0,b.vpQuery)("/{vpmprovider}/approval/getheader",{}).then(function(e){var t=[];e.data.headers.fields.map(function(e,n){"ipercent"==e.field_name?t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:function(t,n){return y["default"].createElement(C.EditTableCol,{callBack:a.callBack,record:n,widget:e.widget,value:t})}}):"taskname"==e.field_name?t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:function(e,t){return y["default"].createElement(b.VpTooltip,{placement:"top",title:e},y["default"].createElement("div",{className:"text-hidden"},e))}}):"iactivityidval"==e.field_name?t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,widget:e.widget,render:function(t,n){return n.edit_col=!0,y["default"].createElement(C.EditTableCol,{callBack:a.callBack,record:n,widget:e.widget,value:t})}}):"username"==e.field_name?t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,render:function(e,t,n){var l=0,r=[0],s={children:e,props:{}};return a.state.tableData.map(function(e,a){if(e.username!=t.username)return l=0;l++,s.props.rowSpan=l,r.push(a-l+1),n!=r[r.length-1]&&l>1&&(s.props.rowSpan=0)}),s}}):t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150})}),t.push({title:"操作",width:150,fixed:"right",className:"text-center",render:function(e,t){return y["default"].createElement("div",null,y["default"].createElement(b.VpTooltip,{placement:"top",title:"批准"},y["default"].createElement(b.VpIcon,{className:"cursor m-lr-xs f16 text-success",type:"check",onClick:function(){return a.handlebutton(t,"submit")}})),y["default"].createElement(b.VpTooltip,{placement:"top",title:"拒绝"},y["default"].createElement(b.VpIcon,{className:"cursor m-lr-xs f16 text-danger",type:"cross",onClick:function(){return a.showRefused(t,"refused")}})))}}),a.setState({tableHeader:t})})},a.onShowSizeChange=function(e){},a.showRefused=function(e,t){a.setState({showmodal:!0,currentRecord:e,type:t})},a.tableChange=function(e,t,n){var l="";"descend"===n.order?l="desc":"ascend"===n.order&&(l="asc"),a.setState({currentPage:e.current||a.state.currentPage,sortfield:n.field,sorttype:l,numPerPage:e.pageSize||a.state.numPerPage},function(){a.querytimesheet()})},a.changeDate=function(e){var t="",n=a.state.cDate?a.state.cDate:(new Date).Format("yyyy-MM-dd");t="up"==e?r(n,1):r(n,-1),a.setState({cDate:t},function(){a.querytimesheet()})},a.handlebutton=function(e,t){"refusedList"==t&&(t="refused");e.iid;e.saudittext=$("#advice").val();var n=[];n.push(e),(0,b.vpAdd)("/{vpmprovider}/approval/approval",{data:(0,o["default"])(n),type:t}).then(function(e){(0,b.VpAlertMsg)({message:"消息提示",description:"审批成功！",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),a.setState({showmodal:!1,currentRecord:{},type:""},function(){a.querytimesheet(),$("#advice").val("")})})},a.handleCancel=function(){a.setState({showmodal:!1,currentRecord:{},type:""},function(){$("#advice").val("")})},a.handleOk=function(){var e="";"refused"==a.state.type?(e=a.state.currentRecord,a.handlebutton(e,a.state.type)):(e=a.state.selectedRows,a.handlesubmit(e,a.state.type))},a.sliderChange=function(e,t){var n={};n[t]=e,a.setState(n)},a.callBack=function(e){a.state.data.push(e)},a.filterChange=function(e){a.setState({filtervalue:e.target.value},function(){a.querytimesheet()})},a.onDatePickerChange=function(e,t){a.setState({cDate:t},function(){a.querytimesheet()})},a.handleSelectChange=function(e){a.setState({projectid:e},function(){a.listPerson(),a.querytimesheet()})},a.handleUserChange=function(e){a.setState({userid:e},function(){a.querytimesheet()})},a.getalldata=function(e){"refused"==e?a.state.selectedRowKeys.length>0?a.setState({showmodal:!0,type:"refusedList"}):(0,b.VpAlertMsg)({message:"消息提示",description:"请选择审批数据！",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5):a.handlesubmit(a.state.selectedRows,e)},a.handlesubmit=function(e,t){e.length>0?(0,b.vpAdd)("/{vpmprovider}/approval/approval",{data:(0,o["default"])(e),type:t}).then(function(e){(0,b.VpAlertMsg)({message:"消息提示",description:"审批成功！",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),a.setState({selectedRowKeys:[],selectedRows:[],showmodal:!1},function(){a.querytimesheet(),$("#advice").val("")})}):(0,b.VpAlertMsg)({message:"消息提示",description:"请选择审批数据！",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5)},a.state={tableHeader:[],tableData:[],filtervalue:"0",filter_data:[],data:[],visible:!1,cDate:(new Date).Format("yyyy-MM-dd"),listProject:[],listPerson:[],projectid:"-1",userid:"-1",currentPage:1,numPerPage:10,pagination:{},selectedRows:[],selectedRowKeys:[],showmodal:!1,currentRecord:{},type:"",tableHeight:null},a}return(0,v["default"])(t,e),(0,f["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=l();this.setState({filter_data:t,filtervalue:"0"},function(){e.listProject(),e.listPerson(),e.querytimesheet(),e.queryApprovalHeader()})}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this,a=this.state.selectedRowKeys,n={onChange:function(e,a){t.setState({selectedRows:a,selectedRowKeys:e})},onSelect:function(e,t,a){},onSelectAll:function(e,t,a){},selectedRowKeys:a};return y["default"].createElement("div",{className:"approval full-height pr",style:{paddingTop:40}},y["default"].createElement("div",{className:"subAssembly b-b bg-white"},y["default"].createElement(b.VpRow,{gutter:10},y["default"].createElement(b.VpCol,{className:"gutter-row pr",span:4},y["default"].createElement("div",{className:"fl date-picker"},y["default"].createElement(b.VpIcon,{onClick:function(){return e.changeDate("up")},type:"up",className:"cursor f12"}),y["default"].createElement(b.VpIcon,{onClick:function(){return e.changeDate("down")},type:"down",className:"cursor f12"})),y["default"].createElement("div",{className:"fr date-picker-input"},y["default"].createElement(b.VpDatePicker,{defaultValue:new Date,value:this.state.cDate,onChange:this.onDatePickerChange}))),y["default"].createElement(b.VpCol,{className:"gutter-row",span:4},y["default"].createElement(b.VpSelect,{showSearch:!0,defaultValue:"-1",placeholder:"请选择人员",className:"block",optionFilterProp:"children",notFoundContent:"无法找到",onChange:this.handleSelectChange},y["default"].createElement(b.VpOption,{value:"-1"},"请选择项目"),this.state.listProject.map(function(e,t){return y["default"].createElement(b.VpOption,{key:t,value:e.iid.toString()},e.sname)}))),y["default"].createElement(b.VpCol,{className:"gutter-row",span:4},y["default"].createElement(b.VpSelect,{showSearch:!0,defaultValue:"-1",placeholder:"选择人员",className:"block",optionFilterProp:"children",notFoundContent:"无法找到",onChange:this.handleUserChange},y["default"].createElement(b.VpOption,{value:"-1"},"请选择人员"),this.state.listPerson.map(function(e,t){return y["default"].createElement(b.VpOption,{key:t,value:e.iid.toString()},e.sname)}))),y["default"].createElement(b.VpCol,{className:"gutter-row",span:5},y["default"].createElement(C.CheckRadio,{filterData:this.state.filter_data,defaultValue:this.state.filtervalue,onChange:this.filterChange})),y["default"].createElement(b.VpCol,{className:"gutter-row text-right text",span:7},y["default"].createElement("span",null,"灰色"),"--待审批  ",y["default"].createElement("span",{className:"text-info"},"蓝色"),"--已批准   ",y["default"].createElement("span",{className:"text-danger"},"红色"),"--已拒绝"))),y["default"].createElement("div",{className:"full-height p-b-xxlg"},y["default"].createElement("div",{className:"table-content bg-white p-sm full-height scroll-y"},y["default"].createElement(b.VpTable,{className:"appTable",columns:this.state.tableHeader,dataSource:this.state.tableData,rowSelection:n,pagination:this.state.pagination,onChange:this.tableChange,scroll:{y:this.state.tableHeight},resize:!0})),y["default"].createElement("div",null,y["default"].createElement(b.VpModal,{width:"340",style:{height:340},title:"审批意见",visible:this.state.showmodal,onCancel:function(){return e.handleCancel()},footer:y["default"].createElement("div",{className:"text-center"},y["default"].createElement(b.VpButton,{className:"vp-btn-br",type:"primary",onClick:function(){return e.handleOk()}},"确定"),y["default"].createElement(b.VpButton,{className:"vp-btn-br",type:"ghost",onClick:function(){return e.handleCancel()}},"取消"))},y["default"].createElement(b.VpInput,{id:"advice",type:"textarea",rows:5,defaultValue:""}))),y["default"].createElement("div",{className:"footer-button-wrap ant-modal-footer",style:{bottom:"-10px",zIndex:10}},y["default"].createElement(b.VpButton,{className:"m-r-xs vp-btn-br",type:"primary",onClick:function(){return e.getalldata("submit")}},"批准"),y["default"].createElement(b.VpButton,{className:"m-r-xs vp-btn-br",onClick:function(){return e.getalldata("refused")}},"拒绝"))))}}]),t}(y["default"].Component);t["default"]=E},881:function(e,t,a){var n=a(882);"string"==typeof n&&(n=[[e.id,n,""]]);var l={hmr:!0};l.transform=void 0;a(439)(n,l);n.locals&&(e.exports=n.locals)},882:function(e,t){}});